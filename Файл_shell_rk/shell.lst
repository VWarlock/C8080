0001   0000             .include "stdlib8080.inc"
0001+  0000               .org 0
0002+  0000             start:
0003+  0000 C3 03 00      jmp main
0004+  0003             
0005+  0003             
0006+  0003             
0007+  0003             
0002   0003             ; --------------------------------------------------------------
0003   0003             main:
0004   0003 C5            push b
0005   0004             ;825 fs_init();
0006   0004 CD A7 01      call fs_init
0007   0007             ;828 maxFiles = fs_getMemTop() - START_FILE_BUFFER;
0008   0007 CD A8 01      call fs_getMemTop
0009   000A 11 00 C0      lxi d, -16384
0010   000D 19            dad d
0011   000E             ;829 maxFiles /= sizeof(FileInfo)*2;
0012   000E 11 28 00      lxi d, 40
0013   0011 CD FC 29      call op_div16_swap
0014   0014             ;830 panelA.files1 = ((FileInfo*)START_FILE_BUFFER);
0015   0014 22 D5 30      shld maxFiles
0016   0017 21 00 40      lxi h, 16384
0017   001A             ;831 panelB.files1 = ((FileInfo*)START_FILE_BUFFER)+maxFiles;
0018   001A 22 C1 2D      shld panelA
0019   001D 2A D5 30      lhld maxFiles
0020   0020 54            mov d, h
0021   0021 5D            mov e, l
0022   0022 29            dad h
0023   0023 29            dad h
0024   0024 19            dad d
0025   0025 29            dad h
0026   0026 29            dad h
0027   0027 11 00 40      lxi d, 16384
0028   002A 19            dad d
0029   002B             ;834 panelA.path1[0] = 0;
0030   002B AF            xra a
0031   002C             ;835 panelB.path1[0] = 0;
0032   002C 32 C3 2D      sta (panelA)+(2)
0033   002F             ;838 cmdline[0] = 0;
0034   002F 32 CD 2E      sta (panelB)+(2)
0035   0032             ;841 drawInit();  
0036   0032 32 D5 2F      sta cmdline
0037   0035 22 CB 2E      shld panelB
0038   0038 CD AC 01      call drawInit
0039   003B             ;842 drawScreenInt();
0040   003B CD 1C 02      call drawScreenInt
0041   003E             ;843 drawCmdLineWithPath();
0042   003E CD 6E 02      call drawCmdLineWithPath
0043   0041             ;846 loadState();
0044   0041 CD 15 03      call loadState
0045   0044             ;849 getFiles();
0046   0044 CD 90 03      call getFiles
0047   0047             ;852 dupFiles(1);
0048   0047 3E 01         mvi a, 1
0049   0049 CD A7 04      call dupFiles
0050   004C             ;855 selectFile(cmdline);
0051   004C 21 D5 2F      lxi h, cmdline
0052   004F CD F0 04      call selectFile
0053   0052             ;856 cmdline[0] = 0;
0054   0052 AF            xra a
0055   0053             ;859 drawScreenInt();
0056   0053 32 D5 2F      sta cmdline
0057   0056 CD 1C 02      call drawScreenInt
0058   0059             ;860 drawFiles2();
0059   0059 CD 78 05      call drawFiles2
0060   005C             ;861 drawCmdLineWithPath();
0061   005C CD 6E 02      call drawCmdLineWithPath
0062   005F             ;864 while(1) {
0063   005F             l67:
0064   005F             ;864 {
0065   005F AF            xra a
0066   0060 CD 98 05      call fs_bioskey
0067   0063             ;867 switch(c) {
0068   0063 47            mov b, a
0069   0064 B7            ora a
0070   0065 CA 96 00      jz l69
0071   0068 3D            dcr a
0072   0069 CA 9C 00      jz l70
0073   006C 3D            dcr a
0074   006D CA A3 00      jz l71
0075   0070 3D            dcr a
0076   0071 CA AC 00      jz l72
0077   0074 D6 05         sui 5
0078   0076 CA C1 00      jz l75
0079   0079 3D            dcr a
0080   007A CA D9 00      jz l79
0081   007D D6 04         sui 4
0082   007F CA B5 00      jz l73
0083   0082 D6 0B         sui 11
0084   0084 CA C7 00      jz l76
0085   0087 3D            dcr a
0086   0088 CA D3 00      jz l78
0087   008B 3D            dcr a
0088   008C CA CD 00      jz l77
0089   008F 3D            dcr a
0090   0090 CA BB 00      jz l74
0091   0093 C3 DF 00      jmp l68
0092   0096             ;868 case KEY_F1:    cmd_freespace();         continue;
0093   0096             l69:
0094   0096             ;868 cmd_freespace();         continue;
0095   0096 CD A7 05      call cmd_freespace
0096   0099             ;868 continue;
0097   0099 C3 5F 00      jmp l67
0098   009C             ;869 case KEY_F2:    cmd_new(0);              continue;
0099   009C             l70:
0100   009C             ;869 cmd_new(0);              continue;
0101   009C AF            xra a
0102   009D CD FB 05      call cmd_new
0103   00A0             ;869 continue;
0104   00A0 C3 5F 00      jmp l67
0105   00A3             ;870 case KEY_F3:    cmd_editview(viewerApp); continue;
0106   00A3             l71:
0107   00A3             ;870 cmd_editview(viewerApp); continue;
0108   00A3 21 B4 2D      lxi h, viewerApp
0109   00A6 CD 0E 06      call cmd_editview
0110   00A9             ;870 continue;
0111   00A9 C3 5F 00      jmp l67
0112   00AC             ;871 case KEY_F4:    cmd_editview(editorApp); continue;
0113   00AC             l72:
0114   00AC             ;871 cmd_editview(editorApp); continue;
0115   00AC 21 A7 2D      lxi h, editorApp
0116   00AF CD 0E 06      call cmd_editview
0117   00B2             ;871 continue;
0118   00B2 C3 5F 00      jmp l67
0119   00B5             ;872 case KEY_ENTER: cmd_enter();             continue;
0120   00B5             l73:
0121   00B5             ;872 cmd_enter();             continue;
0122   00B5 CD 4B 06      call cmd_enter
0123   00B8             ;872 continue;
0124   00B8 C3 5F 00      jmp l67
0125   00BB             ;873 case KEY_ESC:   cmd_esc();               continue;
0126   00BB             l74:
0127   00BB             ;873 cmd_esc();               continue;
0128   00BB CD B3 06      call cmd_esc
0129   00BE             ;873 continue;
0130   00BE C3 5F 00      jmp l67
0131   00C1             ;874 case KEY_LEFT:  cursor_left();           continue;
0132   00C1             l75:
0133   00C1             ;874 cursor_left();           continue;
0134   00C1 CD C6 06      call cursor_left
0135   00C4             ;874 continue;
0136   00C4 C3 5F 00      jmp l67
0137   00C7             ;875 case KEY_RIGHT: cursor_right();          continue; 
0138   00C7             l76:
0139   00C7             ;875 cursor_right();          continue; 
0140   00C7 CD 1B 07      call cursor_right
0141   00CA             ;875 continue; 
0142   00CA C3 5F 00      jmp l67
0143   00CD             ;876 case KEY_DOWN:  cursor_down();           continue;
0144   00CD             l77:
0145   00CD             ;876 cursor_down();           continue;
0146   00CD CD DB 07      call cursor_down
0147   00D0             ;876 continue;
0148   00D0 C3 5F 00      jmp l67
0149   00D3             ;877 case KEY_UP:    cursor_up();             continue; 
0150   00D3             l78:
0151   00D3             ;877 cursor_up();             continue; 
0152   00D3 CD 3E 08      call cursor_up
0153   00D6             ;877 continue; 
0154   00D6 C3 5F 00      jmp l67
0155   00D9             ;878 case KEY_TAB:   cmd_tab();               continue; 
0156   00D9             l79:
0157   00D9             ;878 cmd_tab();               continue; 
0158   00D9 CD 74 08      call cmd_tab
0159   00DC             ;878 continue; 
0160   00DC C3 5F 00      jmp l67
0161   00DF             l68:
0162   00DF             ;882 if(!cmdLine[0]) {
0163   00DF 3A D5 2F      lda cmdline
0164   00E2 B7            ora a
0165   00E3 C2 9B 01      jnz l181
0166   00E6             ;882 {
0167   00E6 78            mov a, b
0168   00E7 D6 20         sui 32
0169   00E9 CA 80 01      jz l91
0170   00EC D6 05         sui 5
0171   00EE CA 46 01      jz l85
0172   00F1 3D            dcr a
0173   00F2 CA 5D 01      jz l87
0174   00F5 D6 07         sui 7
0175   00F7 CA 94 01      jz l94
0176   00FA D6 04         sui 4
0177   00FC CA 27 01      jz l81
0178   00FF 3D            dcr a
0179   0100 CA 2D 01      jz l82
0180   0103 3D            dcr a
0181   0104 CA 34 01      jz l83
0182   0107 3D            dcr a
0183   0108 CA 3D 01      jz l84
0184   010B 3D            dcr a
0185   010C CA 51 01      jz l86
0186   010F 3D            dcr a
0187   0110 CA 68 01      jz l88
0188   0113 3D            dcr a
0189   0114 CA 72 01      jz l89
0190   0117 3D            dcr a
0191   0118 CA 7A 01      jz l90
0192   011B D6 02         sui 2
0193   011D CA 86 01      jz l92
0194   0120 3D            dcr a
0195   0121 CA 8C 01      jz l93
0196   0124 C3 9B 01      jmp l80
0197   0127             ;884 case '1': cmd_freespace();         continue;
0198   0127             l81:
0199   0127             ;884 cmd_freespace();         continue;
0200   0127 CD A7 05      call cmd_freespace
0201   012A             ;884 continue;
0202   012A C3 5F 00      jmp l67
0203   012D             ;885 case '2': cmd_new(0);              continue;
0204   012D             l82:
0205   012D             ;885 cmd_new(0);              continue;
0206   012D AF            xra a
0207   012E CD FB 05      call cmd_new
0208   0131             ;885 continue;
0209   0131 C3 5F 00      jmp l67
0210   0134             ;886 case '3': cmd_editview(viewerApp); continue;
0211   0134             l83:
0212   0134             ;886 cmd_editview(viewerApp); continue;
0213   0134 21 B4 2D      lxi h, viewerApp
0214   0137 CD 0E 06      call cmd_editview
0215   013A             ;886 continue;
0216   013A C3 5F 00      jmp l67
0217   013D             ;887 case '4': cmd_editview(editorApp); continue;
0218   013D             l84:
0219   013D             ;887 cmd_editview(editorApp); continue;
0220   013D 21 A7 2D      lxi h, editorApp
0221   0140 CD 0E 06      call cmd_editview
0222   0143             ;887 continue;
0223   0143 C3 5F 00      jmp l67
0224   0146             ;888 case '%': cmd_copymove(1, 1);      continue;
0225   0146             l85:
0226   0146             ;888 cmd_copymove(1, 1);      continue;
0227   0146 3E 01         mvi a, 1
0228   0148 32 5F 31      sta cmd_copymove_1
0229   014B CD 96 08      call cmd_copymove
0230   014E             ;888 continue;
0231   014E C3 5F 00      jmp l67
0232   0151             ;889 case '5': cmd_copymove(1, 0);      continue;
0233   0151             l86:
0234   0151             ;889 cmd_copymove(1, 0);      continue;
0235   0151 3E 01         mvi a, 1
0236   0153 32 5F 31      sta cmd_copymove_1
0237   0156 AF            xra a
0238   0157 CD 96 08      call cmd_copymove
0239   015A             ;889 continue;
0240   015A C3 5F 00      jmp l67
0241   015D             ;890 case '&': cmd_copymove(0, 1);      continue;
0242   015D             l87:
0243   015D             ;890 cmd_copymove(0, 1);      continue;
0244   015D AF            xra a
0245   015E 32 5F 31      sta cmd_copymove_1
0246   0161 3C            inr a
0247   0162 CD 96 08      call cmd_copymove
0248   0165             ;890 continue;
0249   0165 C3 5F 00      jmp l67
0250   0168             ;891 case '6': cmd_copymove(0, 0);      continue;
0251   0168             l88:
0252   0168             ;891 cmd_copymove(0, 0);      continue;
0253   0168 AF            xra a
0254   0169 32 5F 31      sta cmd_copymove_1
0255   016C CD 96 08      call cmd_copymove
0256   016F             ;891 continue;
0257   016F C3 5F 00      jmp l67
0258   0172             ;892 case '7': cmd_new(1);              continue;
0259   0172             l89:
0260   0172             ;892 cmd_new(1);              continue;
0261   0172 3E 01         mvi a, 1
0262   0174 CD FB 05      call cmd_new
0263   0177             ;892 continue;
0264   0177 C3 5F 00      jmp l67
0265   017A             ;893 case '8': cmd_delete();            continue;
0266   017A             l90:
0267   017A             ;893 cmd_delete();            continue;
0268   017A CD BC 08      call cmd_delete
0269   017D             ;893 continue;
0270   017D C3 5F 00      jmp l67
0271   0180             ;894 case ' ': cmd_inverseOne();        continue;
0272   0180             l91:
0273   0180             ;894 cmd_inverseOne();        continue;
0274   0180 CD 23 09      call cmd_inverseOne
0275   0183             ;894 continue;
0276   0183 C3 5F 00      jmp l67
0277   0186             ;895 case ':': cmd_inverseAll();        continue; // *
0278   0186             l92:
0279   0186             ;895 cmd_inverseAll();        continue; // *
0280   0186 CD 4E 09      call cmd_inverseAll
0281   0189             ;895 continue; // *
0282   0189 C3 5F 00      jmp l67
0283   018C             ;896 case ';': cmd_sel(1);              continue; // +
0284   018C             l93:
0285   018C             ;896 cmd_sel(1);              continue; // +
0286   018C 3E 01         mvi a, 1
0287   018E CD 97 09      call cmd_sel
0288   0191             ;896 continue; // +
0289   0191 C3 5F 00      jmp l67
0290   0194             ;897 case '-': cmd_sel(0);              continue;
0291   0194             l94:
0292   0194             ;897 cmd_sel(0);              continue;
0293   0194 AF            xra a
0294   0195 CD 97 09      call cmd_sel
0295   0198             ;897 continue;
0296   0198 C3 5F 00      jmp l67
0297   019B             l80:
0298   019B             l181:
0299   019B             ;902 processInput(c);
0300   019B 78            mov a, b
0301   019C CD 25 0A      call processInput
0302   019F             ;903 drawCmdLine();
0303   019F CD 6C 0A      call drawCmdLine
0304   01A2 C3 5F 00      jmp l67
0305   01A5             l66:
0306   01A5 C1            pop b
0307   01A6 C9            ret
0308   01A7             ; --------------------------------------------------------------
0309   01A7             fs_init:
0310   01A7 C9            ret
0311   01A8             ; --------------------------------------------------------------
0312   01A8             fs_getMemTop:
0313   01A8             ;186 return getMemTop();  
0314   01A8 CD 30 F8      call 63536
0315   01AB C9            ret
0316   01AC             ; --------------------------------------------------------------
0317   01AC             drawInit:
0318   01AC             ;18 fs_initScreen();
0319   01AC CD 8B 0A      call fs_initScreen
0320   01AF             ;19 window = fs_window();
0321   01AF CD D4 0A      call fs_window
0322   01B2             ;20 rowsCnt = fs_screenHeight - 8;
0323   01B2 3A 12 31      lda fs_screenHeight
0324   01B5 C6 F8         adi 248
0325   01B7             ;21 fileCursorX = 0;
0326   01B7 32 D7 30      sta rowsCnt
0327   01BA AF            xra a
0328   01BB             ;22 fileCursorY = 0;  
0329   01BB 32 F5 30      sta fileCursorX
0330   01BE             ;23 windowX = (fs_screenWidth - 32) / 2;
0331   01BE 22 FA 30      shld window
0332   01C1 2A 11 31      lhld fs_screenWidth
0333   01C4 26 00         mvi h, 0
0334   01C6 11 E0 FF      lxi d, -32
0335   01C9 19            dad d
0336   01CA 11 02 00      lxi d, 2
0337   01CD 32 F6 30      sta fileCursorY
0338   01D0 CD FC 29      call op_div16_swap
0339   01D3 7D            mov a, l
0340   01D4             ;24 windowY = (fs_screenHeight - 10) / 2;
0341   01D4 2A 12 31      lhld fs_screenHeight
0342   01D7 26 00         mvi h, 0
0343   01D9 11 F6 FF      lxi d, -10
0344   01DC 19            dad d
0345   01DD 11 02 00      lxi d, 2
0346   01E0 32 F7 30      sta windowX
0347   01E3 CD FC 29      call op_div16_swap
0348   01E6 7D            mov a, l
0349   01E7             ;25 onePanel = fs_screenWidth < 64;
0350   01E7 32 F8 30      sta windowY
0351   01EA 3A 11 31      lda fs_screenWidth
0352   01ED FE 40         cpi 64
0353   01EF D2 F7 01      jnc l390
0354   01F2 3E 01         mvi a, 1
0355   01F4 C3 F8 01      jmp l391
0356   01F7             ; label1
0357   01F7             l390:
0358   01F7 AF            xra a
0359   01F8             ; label1
0360   01F8             l391:
0361   01F8             ;26 activePanel0 = onePanel ? 0 : (fs_screenWidth - 31 * 2) / 2;
0362   01F8 B7            ora a
0363   01F9 32 F9 30      sta onePanel
0364   01FC CA 05 02      jz l397
0365   01FF 21 00 00      lxi h, 0
0366   0202 C3 14 02      jmp l396
0367   0205             ; label1
0368   0205             l397:
0369   0205 2A 11 31      lhld fs_screenWidth
0370   0208 26 00         mvi h, 0
0371   020A 11 C2 FF      lxi d, -62
0372   020D 19            dad d
0373   020E 11 02 00      lxi d, 2
0374   0211 CD FC 29      call op_div16_swap
0375   0214             ; label1
0376   0214             l396:
0377   0214 7D            mov a, l
0378   0215             ;27 activePanel = activePanel0;
0379   0215 32 F4 30      sta activePanel0
0380   0218 32 F2 30      sta activePanel
0381   021B C9            ret
0382   021C             ; --------------------------------------------------------------
0383   021C             drawScreenInt:
0384   021C             ;124 fs_clearScreen();
0385   021C CD D8 0A      call fs_clearScreen
0386   021F             ;127 fs_print(activePanel0, fs_screenHeight - 1, fs_screenWidth - activePanel0, "1 FREE 2 NEW  3 VIEW  4 EDIT 5 COPY 6 REN  7 DIR  8 DEL", 0); 
0387   021F 3A F4 30      lda activePanel0
0388   0222 32 7C 31      sta fs_print_1
0389   0225 3A 12 31      lda fs_screenHeight
0390   0228 3D            dcr a
0391   0229 32 7D 31      sta fs_print_2
0392   022C 3A F4 30      lda activePanel0
0393   022F 57            mov d, a
0394   0230 3A 11 31      lda fs_screenWidth
0395   0233 92            sub d
0396   0234 32 7E 31      sta fs_print_3
0397   0237 21 51 2B      lxi h, str53
0398   023A 22 7F 31      shld fs_print_4
0399   023D AF            xra a
0400   023E CD FE 0A      call fs_print
0401   0241             ;130 drawPanel();
0402   0241 CD 48 0B      call drawPanel
0403   0244             ;131 drawPanelTitle(1, panelA.path1);
0404   0244 3E 01         mvi a, 1
0405   0246 32 82 31      sta drawPanelTitle_1
0406   0249 21 C3 2D      lxi h, (panelA)+(2)
0407   024C CD D4 0B      call drawPanelTitle
0408   024F             ;132 if(!onePanel) {
0409   024F 3A F9 30      lda onePanel
0410   0252 B7            ora a
0411   0253 C2 69 02      jnz l398
0412   0256             ;132 {
0413   0256 CD 93 0C      call drawSwapPanels
0414   0259             ;134 drawPanel();
0415   0259 CD 48 0B      call drawPanel
0416   025C             ;135 drawPanelTitle(0, panelB.path1);
0417   025C AF            xra a
0418   025D 32 82 31      sta drawPanelTitle_1
0419   0260 21 CD 2E      lxi h, (panelB)+(2)
0420   0263 CD D4 0B      call drawPanelTitle
0421   0266             ;136 drawSwapPanels();
0422   0266 CD 93 0C      call drawSwapPanels
0423   0269             l398:
0424   0269             ;140 fileCursorX = 0;
0425   0269 AF            xra a
0426   026A 32 F5 30      sta fileCursorX
0427   026D C9            ret
0428   026E             ; --------------------------------------------------------------
0429   026E             drawCmdLineWithPath:
0430   026E C5            push b
0431   026F             ;223 uchar max = fs_screenWidth/2;
0432   026F 2A 11 31      lhld fs_screenWidth
0433   0272 26 00         mvi h, 0
0434   0274 11 02 00      lxi d, 2
0435   0277 CD FC 29      call op_div16_swap
0436   027A 7D            mov a, l
0437   027B             ;226 fs_print(0, rowsCnt+6, 1, "/", 0);
0438   027B 32 26 31      sta drawCmdLineWithPath_max
0439   027E 3A D7 30      lda rowsCnt
0440   0281 C6 06         adi 6
0441   0283 32 7D 31      sta fs_print_2
0442   0286 21 3E 2B      lxi h, str23
0443   0289 22 7F 31      shld fs_print_4
0444   028C AF            xra a
0445   028D 32 7C 31      sta fs_print_1
0446   0290 3C            inr a
0447   0291 32 7E 31      sta fs_print_3
0448   0294 AF            xra a
0449   0295 CD FE 0A      call fs_print
0450   0298             ;227 l = strlen(panelA.path1);
0451   0298 21 C3 2D      lxi h, (panelA)+(2)
0452   029B CD B7 0C      call strlen
0453   029E             ;228 if(l>=max) o=l-max, l=max; else o=0;
0454   029E 44            mov b, h
0455   029F 4D            mov c, l
0456   02A0 EB            xchg
0457   02A1 2A 26 31      lhld drawCmdLineWithPath_max
0458   02A4 26 00         mvi h, 0
0459   02A6 CD CD 29      call op_cmp16
0460   02A9 CA AF 02      jz $+6
0461   02AC D2 C4 02      jnc l401
0462   02AF             ;228 o=l-max, l=max; else o=0;
0463   02AF 26 00         mvi h, 0
0464   02B1 EB            xchg
0465   02B2 60            mov h, b
0466   02B3 69            mov l, c
0467   02B4 CD 40 2A      call op_sub16_swap
0468   02B7 22 20 31      shld drawCmdLineWithPath_o
0469   02BA 2A 26 31      lhld drawCmdLineWithPath_max
0470   02BD 26 00         mvi h, 0
0471   02BF 44            mov b, h
0472   02C0 4D            mov c, l
0473   02C1 C3 CA 02      jmp l423
0474   02C4             l401:
0475   02C4             ;228 o=0;
0476   02C4 21 00 00      lxi h, 0
0477   02C7 22 20 31      shld drawCmdLineWithPath_o
0478   02CA             ; label1
0479   02CA             l423:
0480   02CA             ;229 fs_print(1, rowsCnt+6, l, panelA.path1+o, 0);
0481   02CA 3A D7 30      lda rowsCnt
0482   02CD C6 06         adi 6
0483   02CF 32 7D 31      sta fs_print_2
0484   02D2 60            mov h, b
0485   02D3 69            mov l, c
0486   02D4 7D            mov a, l
0487   02D5 32 7E 31      sta fs_print_3
0488   02D8 2A 20 31      lhld drawCmdLineWithPath_o
0489   02DB 11 C3 2D      lxi d, (panelA)+(2)
0490   02DE 19            dad d
0491   02DF 22 7F 31      shld fs_print_4
0492   02E2 3E 01         mvi a, 1
0493   02E4 32 7C 31      sta fs_print_1
0494   02E7 AF            xra a
0495   02E8 CD FE 0A      call fs_print
0496   02EB             ;230 fs_print(l+1, rowsCnt+6, 1, ">", 0);
0497   02EB 60            mov h, b
0498   02EC 69            mov l, c
0499   02ED 23            inx h
0500   02EE 7D            mov a, l
0501   02EF 32 7C 31      sta fs_print_1
0502   02F2 3A D7 30      lda rowsCnt
0503   02F5 C6 06         adi 6
0504   02F7 32 7D 31      sta fs_print_2
0505   02FA 21 8B 2B      lxi h, str55
0506   02FD 22 7F 31      shld fs_print_4
0507   0300 3E 01         mvi a, 1
0508   0302 32 7E 31      sta fs_print_3
0509   0305 AF            xra a
0510   0306 CD FE 0A      call fs_print
0511   0309             ;233 panelA.cmdLineOff = l+2;
0512   0309 21 02 00      lxi h, 2
0513   030C 09            dad b
0514   030D             ;236 drawCmdLine();
0515   030D 22 C9 2E      shld (panelA)+(264)
0516   0310 CD 6C 0A      call drawCmdLine
0517   0313 C1            pop b
0518   0314 C9            ret
0519   0315             ; --------------------------------------------------------------
0520   0315             loadState:
0521   0315 C5            push b
0522   0316             ;697 i = strlen(fs_selfName);
0523   0316 2A 02 31      lhld fs_selfName
0524   0319 CD B7 0C      call strlen
0525   031C             ;698 if(i < 4) return;
0526   031C 11 04 00      lxi d, 4
0527   031F CD CD 29      call op_cmp16
0528   0322 D2 27 03      jnc l424
0529   0325             ;698 return;
0530   0325 C1            pop b
0531   0326 C9            ret
0532   0327             l424:
0533   0327             ;699 i -= 3;
0534   0327 2B            dcx h
0535   0328 2B            dcx h
0536   0329 2B            dcx h
0537   032A             ;700 if(0 != strcmp(fs_selfName + i, ".RK")) return;
0538   032A 44            mov b, h
0539   032B 4D            mov c, l
0540   032C 2A 02 31      lhld fs_selfName
0541   032F 09            dad b
0542   0330 22 8A 31      shld strcmp_1
0543   0333 21 3A 2B      lxi h, str16
0544   0336 CD C6 0C      call strcmp
0545   0339 B7            ora a
0546   033A CA 3F 03      jz l427
0547   033D             ;700 return;
0548   033D C1            pop b
0549   033E C9            ret
0550   033F             l427:
0551   033F             ;701 strcpy(fs_selfName + i, ".IN");
0552   033F 2A 02 31      lhld fs_selfName
0553   0342 09            dad b
0554   0343 22 90 31      shld strcpy_1
0555   0346 21 36 2B      lxi h, str17
0556   0349 CD 07 0D      call strcpy
0557   034C             ;703 if(fs_open(fs_selfName)) return;
0558   034C 2A 02 31      lhld fs_selfName
0559   034F CD 18 0D      call fs_open
0560   0352 B7            ora a
0561   0353 CA 58 03      jz l430
0562   0356             ;703 return;
0563   0356 C1            pop b
0564   0357 C9            ret
0565   0358             l430:
0566   0358             ;704 fs_read(cmdline, 12);
0567   0358 21 D5 2F      lxi h, cmdline
0568   035B 22 96 31      shld fs_read_1
0569   035E 21 0C 00      lxi h, 12
0570   0361 CD 29 0D      call fs_read
0571   0364             ;705 if(cmdline[11]) swapPanels();
0572   0364 3A E0 2F      lda (cmdline)+(11)
0573   0367 B7            ora a
0574   0368 CA 6E 03      jz l431
0575   036B             ;705 swapPanels();
0576   036B CD 5B 0D      call swapPanels
0577   036E             l431:
0578   036E             ;706 fs_read(panelA.path1, 256); panelA.path1[255] = 0;
0579   036E 21 C3 2D      lxi h, (panelA)+(2)
0580   0371 22 96 31      shld fs_read_1
0581   0374 21 00 01      lxi h, 256
0582   0377 CD 29 0D      call fs_read
0583   037A             ;706 panelA.path1[255] = 0;
0584   037A AF            xra a
0585   037B             ;707 fs_read(panelB.path1, 256); panelB.path1[255] = 0;
0586   037B 21 CD 2E      lxi h, (panelB)+(2)
0587   037E 22 96 31      shld fs_read_1
0588   0381 21 00 01      lxi h, 256
0589   0384 32 C2 2E      sta ((panelA)+(2))+(255)
0590   0387 CD 29 0D      call fs_read
0591   038A             ;707 panelB.path1[255] = 0;
0592   038A AF            xra a
0593   038B 32 CC 2F      sta ((panelB)+(2))+(255)
0594   038E C1            pop b
0595   038F C9            ret
0596   0390             ; --------------------------------------------------------------
0597   0390             getFiles:
0598   0390 C5            push b
0599   0391             ;387 fs_hideCursor();
0600   0391 CD 8A 0D      call fs_hideCursor
0601   0394             ;390 panelA.cnt = 0;
0602   0394 21 00 00      lxi h, 0
0603   0397             ;391 panelA.offset = 0;
0604   0397 22 C7 2E      shld (panelA)+(262)
0605   039A             ;392 panelA.cursorX = 0;
0606   039A AF            xra a
0607   039B             ;393 panelA.cursorY = 0;
0608   039B 32 C3 2E      sta (panelA)+(258)
0609   039E             ;395 f = panelA.files1;
0610   039E 22 C5 2E      shld (panelA)+(260)
0611   03A1 2A C1 2D      lhld panelA
0612   03A4             ;398 if(panelA.path1[0]) {
0613   03A4 32 C4 2E      sta (panelA)+(259)
0614   03A7 3A C3 2D      lda (panelA)+(2)
0615   03AA B7            ora a
0616   03AB 44            mov b, h
0617   03AC 4D            mov c, l
0618   03AD CA CC 03      jz l432
0619   03B0             ;398 {
0620   03B0 22 9A 31      shld memcpy_1
0621   03B3 21 D8 30      lxi h, parentDir
0622   03B6 22 9C 31      shld memcpy_2
0623   03B9 21 14 00      lxi h, 20
0624   03BC CD 93 0D      call memcpy
0625   03BF             ;400 ++f;
0626   03BF 21 14 00      lxi h, 20
0627   03C2 09            dad b
0628   03C3             ;401 ++panelA.cnt;    
0629   03C3 44            mov b, h
0630   03C4 4D            mov c, l
0631   03C5 2A C7 2E      lhld (panelA)+(262)
0632   03C8 23            inx h
0633   03C9 22 C7 2E      shld (panelA)+(262)
0634   03CC             l432:
0635   03CC             ;404 st = f;
0636   03CC 60            mov h, b
0637   03CD 69            mov l, c
0638   03CE             ;405 for(;;) {
0639   03CE 22 2B 31      shld getFiles_st
0640   03D1             l44:
0641   03D1             l43:
0642   03D1             ;405 {
0643   03D1 21 C3 2D      lxi h, (panelA)+(2)
0644   03D4 22 A0 31      shld fs_findfirst_1
0645   03D7 60            mov h, b
0646   03D8 69            mov l, c
0647   03D9 22 A2 31      shld fs_findfirst_2
0648   03DC 2A C7 2E      lhld (panelA)+(262)
0649   03DF EB            xchg
0650   03E0 2A D5 30      lhld maxFiles
0651   03E3 CD 40 2A      call op_sub16_swap
0652   03E6 CD B7 0D      call fs_findfirst
0653   03E9             ;407 if(i==ERR_MAX_FILES) i=0; //! Вывести бы ошибки
0654   03E9 FE 0A         cpi 10
0655   03EB C2 EF 03      jnz l435
0656   03EE             ;407 i=0; //! Вывести бы ошибки
0657   03EE AF            xra a
0658   03EF             l435:
0659   03EF             ;408 if(i==0) break;    
0660   03EF B7            ora a
0661   03F0 32 2F 31      sta getFiles_i
0662   03F3 C2 F9 03      jnz l444
0663   03F6             ;408 break;    
0664   03F6 C3 09 04      jmp l42
0665   03F9             l444:
0666   03F9             ;409 if(panelA.path1[0]==0) return; //! Вывести бы ошибки
0667   03F9 3A C3 2D      lda (panelA)+(2)
0668   03FC B7            ora a
0669   03FD C2 02 04      jnz l453
0670   0400             ;409 return; //! Вывести бы ошибки
0671   0400 C1            pop b
0672   0401 C9            ret
0673   0402             l453:
0674   0402             ;410 panelA.path1[0] = 0;
0675   0402 AF            xra a
0676   0403 32 C3 2D      sta (panelA)+(2)
0677   0406 C3 D1 03      jmp l44
0678   0409             l42:
0679   0409             ;413 f += fs_low;
0680   0409 2A 0D 31      lhld fs_low
0681   040C 54            mov d, h
0682   040D 5D            mov e, l
0683   040E 29            dad h
0684   040F 29            dad h
0685   0410 19            dad d
0686   0411 29            dad h
0687   0412 29            dad h
0688   0413 09            dad b
0689   0414             ;414 panelA.cnt += fs_low;
0690   0414 44            mov b, h
0691   0415 4D            mov c, l
0692   0416 2A 0D 31      lhld fs_low
0693   0419 EB            xchg
0694   041A 2A C7 2E      lhld (panelA)+(262)
0695   041D 19            dad d
0696   041E             ;416 for(j=panelA.cnt, f=panelA.files1; j; --j, ++f) { 
0697   041E 22 C7 2E      shld (panelA)+(262)
0698   0421 22 30 31      shld getFiles_j
0699   0424 2A C1 2D      lhld panelA
0700   0427 44            mov b, h
0701   0428 4D            mov c, l
0702   0429             l48:
0703   0429 2A 30 31      lhld getFiles_j
0704   042C 7C            mov a, h
0705   042D B5            ora l
0706   042E CA 7D 04      jz l46
0707   0431             ;416 { 
0708   0431 60            mov h, b
0709   0432 69            mov l, c
0710   0433 11 0B 00      lxi d, 11
0711   0436 19            dad d
0712   0437 7E            mov a, m
0713   0438 E6 7F         ani 127
0714   043A 77            mov m, a
0715   043B             ;418 n=f->fname;
0716   043B 60            mov h, b
0717   043C 69            mov l, c
0718   043D             ;419 for(i=12; i; --i, ++n)
0719   043D 3E 0C         mvi a, 12
0720   043F 32 2F 31      sta getFiles_i
0721   0442 22 2D 31      shld getFiles_n
0722   0445             l52:
0723   0445             ;420 if((uchar)*n>='a' && (uchar)*n<='z')
0724   0445 2A 2D 31      lhld getFiles_n
0725   0448 7E            mov a, m
0726   0449 FE 61         cpi 97
0727   044B DA 5B 04      jc l454
0728   044E 7E            mov a, m
0729   044F FE 7A         cpi 122
0730   0451 CA 57 04      jz $+6
0731   0454 D2 5B 04      jnc l454
0732   0457             ;421 *n = *n-('a'-'A');
0733   0457 7E            mov a, m
0734   0458 C6 E0         adi 224
0735   045A 77            mov m, a
0736   045B             l454:
0737   045B             l51:
0738   045B 3A 2F 31      lda getFiles_i
0739   045E 3D            dcr a
0740   045F 2A 2D 31      lhld getFiles_n
0741   0462 23            inx h
0742   0463 22 2D 31      shld getFiles_n
0743   0466 32 2F 31      sta getFiles_i
0744   0469 B7            ora a
0745   046A C2 45 04      jnz l52
0746   046D             l47:
0747   046D 2A 30 31      lhld getFiles_j
0748   0470 2B            dcx h
0749   0471 22 30 31      shld getFiles_j
0750   0474 21 14 00      lxi h, 20
0751   0477 09            dad b
0752   0478 44            mov b, h
0753   0479 4D            mov c, l
0754   047A C3 29 04      jmp l48
0755   047D             l46:
0756   047D             ;424 if(panelA.cnt > 1)
0757   047D 2A C7 2E      lhld (panelA)+(262)
0758   0480 11 01 00      lxi d, 1
0759   0483 CD CD 29      call op_cmp16
0760   0486 CA A5 04      jz l1848
0761   0489 DA A5 04      jc l1848
0762   048C             ;425 sort(st, ((FileInfo*)panelA.files1) + (panelA.cnt-1));
0763   048C 2A 2B 31      lhld getFiles_st
0764   048F 22 A8 31      shld sort_1
0765   0492 2A C7 2E      lhld (panelA)+(262)
0766   0495 2B            dcx h
0767   0496 54            mov d, h
0768   0497 5D            mov e, l
0769   0498 29            dad h
0770   0499 29            dad h
0771   049A 19            dad d
0772   049B 29            dad h
0773   049C 29            dad h
0774   049D EB            xchg
0775   049E 2A C1 2D      lhld panelA
0776   04A1 19            dad d
0777   04A2 CD 1F 0F      call sort
0778   04A5             l1848:
0779   04A5 C1            pop b
0780   04A6 C9            ret
0781   04A7             ; --------------------------------------------------------------
0782   04A7             dupFiles:
0783   04A7             ;679 swapPanels();
0784   04A7 32 46 31      sta dupFiles_1
0785   04AA CD 5B 0D      call swapPanels
0786   04AD             ;681 if(0==strcmp(panelA.path1, panelB.path1)) {
0787   04AD 21 C3 2D      lxi h, (panelA)+(2)
0788   04B0 22 8A 31      shld strcmp_1
0789   04B3 21 CD 2E      lxi h, (panelB)+(2)
0790   04B6 CD C6 0C      call strcmp
0791   04B9 B7            ora a
0792   04BA C2 DF 04      jnz l1849
0793   04BD             ;681 {
0794   04BD 2A C1 2D      lhld panelA
0795   04C0 22 9A 31      shld memcpy_1
0796   04C3 2A CB 2E      lhld panelB
0797   04C6 22 9C 31      shld memcpy_2
0798   04C9 2A D5 30      lhld maxFiles
0799   04CC 54            mov d, h
0800   04CD 5D            mov e, l
0801   04CE 29            dad h
0802   04CF 29            dad h
0803   04D0 19            dad d
0804   04D1 29            dad h
0805   04D2 29            dad h
0806   04D3 CD 93 0D      call memcpy
0807   04D6             ;683 panelA.cnt = panelB.cnt;    
0808   04D6 2A D1 2F      lhld (panelB)+(262)
0809   04D9 22 C7 2E      shld (panelA)+(262)
0810   04DC C3 E9 04      jmp l1873
0811   04DF             l1849:
0812   04DF             ;684 {
0813   04DF 3A 46 31      lda dupFiles_1
0814   04E2 B7            ora a
0815   04E3 CA E9 04      jz l1874
0816   04E6             ;686 getFiles();
0817   04E6 CD 90 03      call getFiles
0818   04E9             l1874:
0819   04E9             ; label1
0820   04E9             l1873:
0821   04E9             ;689 getSel();
0822   04E9 CD 85 10      call getSel
0823   04EC             ;690 swapPanels();
0824   04EC CD 5B 0D      call swapPanels
0825   04EF C9            ret
0826   04F0             ; --------------------------------------------------------------
0827   04F0             selectFile:
0828   04F0 C5            push b
0829   04F1             ;433 for(l=0, f=panelA.files1; l<panelA.cnt; ++l, ++f) {
0830   04F1 01 00 00      lxi b, 0
0831   04F4 22 47 31      shld selectFile_1
0832   04F7 2A C1 2D      lhld panelA
0833   04FA 22 4B 31      shld selectFile_f
0834   04FD             l56:
0835   04FD 2A C7 2E      lhld (panelA)+(262)
0836   0500 EB            xchg
0837   0501 60            mov h, b
0838   0502 69            mov l, c
0839   0503 CD CD 29      call op_cmp16
0840   0506 D2 76 05      jnc l54
0841   0509             ;433 {
0842   0509 2A 4B 31      lhld selectFile_f
0843   050C 22 37 32      shld memcmp_1
0844   050F 2A 47 31      lhld selectFile_1
0845   0512 22 39 32      shld memcmp_2
0846   0515 21 0B 00      lxi h, 11
0847   0518 CD DC 10      call memcmp
0848   051B B7            ora a
0849   051C C2 68 05      jnz l1893
0850   051F             ;434 {
0851   051F 2A D7 30      lhld rowsCnt
0852   0522 26 00         mvi h, 0
0853   0524 29            dad h
0854   0525 EB            xchg
0855   0526 60            mov h, b
0856   0527 69            mov l, c
0857   0528 CD CD 29      call op_cmp16
0858   052B DA 50 05      jc l1901
0859   052E             ;436 {
0860   052E EB            xchg
0861   052F 2A D7 30      lhld rowsCnt
0862   0532 26 00         mvi h, 0
0863   0534 CD 37 2A      call op_mod16
0864   0537 E5            push h
0865   0538 2A D7 30      lhld rowsCnt
0866   053B 26 00         mvi h, 0
0867   053D EB            xchg
0868   053E 60            mov h, b
0869   053F 69            mov l, c
0870   0540 CD 40 2A      call op_sub16_swap
0871   0543 D1            pop d
0872   0544 CD 40 2A      call op_sub16_swap
0873   0547             ;438 l-=panelA.offset;
0874   0547 22 C5 2E      shld (panelA)+(260)
0875   054A EB            xchg
0876   054B 60            mov h, b
0877   054C 69            mov l, c
0878   054D CD 40 2A      call op_sub16_swap
0879   0550             l1901:
0880   0550             ;441 panelA.cursorX = l/rowsCnt;
0881   0550 44            mov b, h
0882   0551 4D            mov c, l
0883   0552 EB            xchg
0884   0553 2A D7 30      lhld rowsCnt
0885   0556 26 00         mvi h, 0
0886   0558 CD FB 29      call op_div16
0887   055B 7D            mov a, l
0888   055C             ;442 panelA.cursorY = op_div16_mod;
0889   055C 32 C3 2E      sta (panelA)+(258)
0890   055F 3A F9 29      lda op_div16_mod
0891   0562             ;443 break;
0892   0562 32 C4 2E      sta (panelA)+(259)
0893   0565 C3 76 05      jmp l54
0894   0568             l1893:
0895   0568             l55:
0896   0568 03            inx b
0897   0569 2A 4B 31      lhld selectFile_f
0898   056C 11 14 00      lxi d, 20
0899   056F 19            dad d
0900   0570 22 4B 31      shld selectFile_f
0901   0573 C3 FD 04      jmp l56
0902   0576             l54:
0903   0576 C1            pop b
0904   0577 C9            ret
0905   0578             ; --------------------------------------------------------------
0906   0578             drawFiles2:
0907   0578             ;110 drawFiles();
0908   0578 CD 01 11      call drawFiles
0909   057B             ;111 drawFilesCount();
0910   057B CD 0E 11      call drawFilesCount
0911   057E             ;112 if(!onePanel) {
0912   057E 3A F9 30      lda onePanel
0913   0581 B7            ora a
0914   0582 C2 94 05      jnz l1902
0915   0585             ;112 {
0916   0585 CD 5B 0D      call swapPanels
0917   0588             ;114 drawFiles();
0918   0588 CD 01 11      call drawFiles
0919   058B             ;115 drawFilesCount();
0920   058B CD 0E 11      call drawFilesCount
0921   058E             ;116 drawFileInfo();
0922   058E CD 6A 11      call drawFileInfo
0923   0591             ;117 swapPanels();
0924   0591 CD 5B 0D      call swapPanels
0925   0594             l1902:
0926   0594             ;119 showFileCursorAndDrawFileInfo();
0927   0594 CD 95 12      call showFileCursorAndDrawFileInfo
0928   0597 C9            ret
0929   0598             ; --------------------------------------------------------------
0930   0598             fs_bioskey:
0931   0598             ;20 if(c) return bioskey();
0932   0598 B7            ora a
0933   0599 32 4D 31      sta fs_bioskey_1
0934   059C CA A3 05      jz l1903
0935   059F             ;20 return bioskey();
0936   059F CD 1B F8      call 63515
0937   05A2 C9            ret
0938   05A3             l1903:
0939   05A3             ;21 return getch();
0940   05A3 CD 03 F8      call 63491
0941   05A6 C9            ret
0942   05A7             ; --------------------------------------------------------------
0943   05A7             cmd_freespace:
0944   05A7 C5            push b
0945   05A8             ;30 drawWindow(" nakopitelx ");
0946   05A8 21 9E 2A      lxi h, str33
0947   05AB CD 9C 12      call drawWindow
0948   05AE             ;31 drawWindowText(6, 2, "prowerka...");  
0949   05AE 3E 02         mvi a, 2
0950   05B0 32 5F 32      sta drawWindowText_2
0951   05B3 3E 06         mvi a, 6
0952   05B5 32 5E 32      sta drawWindowText_1
0953   05B8 21 1C 2D      lxi h, str34
0954   05BB CD C9 12      call drawWindowText
0955   05BE             ;34 if(e = fs_getfree()) { 
0956   05BE CD 05 13      call fs_getfree
0957   05C1 B7            ora a
0958   05C2 47            mov b, a
0959   05C3 CA D2 05      jz l1904
0960   05C6             ;34 { 
0961   05C6 21 E8 2C      lxi h, str35
0962   05C9 22 62 32      shld drawError_1
0963   05CC CD 13 13      call drawError
0964   05CF C3 F6 05      jmp l1912
0965   05D2             l1904:
0966   05D2             ;36 {
0967   05D2 3E 02         mvi a, 2
0968   05D4 32 69 32      sta cmd_freespace_1_1
0969   05D7 21 77 2D      lxi h, str36
0970   05DA CD CC 13      call cmd_freespace_1
0971   05DD             ;41 if(!fs_gettotal()) cmd_freespace_1(1, "wsego:");
0972   05DD CD 5A 14      call fs_gettotal
0973   05E0 B7            ora a
0974   05E1 C2 EF 05      jnz l1913
0975   05E4             ;41 cmd_freespace_1(1, "wsego:");
0976   05E4 3E 01         mvi a, 1
0977   05E6 32 69 32      sta cmd_freespace_1_1
0978   05E9 21 85 2D      lxi h, str37
0979   05EC CD CC 13      call cmd_freespace_1
0980   05EF             l1913:
0981   05EF             ;44 drawAnyKeyButton();
0982   05EF CD 68 14      call drawAnyKeyButton
0983   05F2             ;45 fs_bioskey(0);
0984   05F2 AF            xra a
0985   05F3 CD 98 05      call fs_bioskey
0986   05F6             ; label1
0987   05F6             l1912:
0988   05F6             ;48 drawScreen();
0989   05F6 CD 74 14      call drawScreen
0990   05F9 C1            pop b
0991   05FA C9            ret
0992   05FB             ; --------------------------------------------------------------
0993   05FB             cmd_new:
0994   05FB             ;41 drawError("o{ibka sozdaniq papki", cmd_new1(dir));
0995   05FB 21 C2 2C      lxi h, str31
0996   05FE 22 62 32      shld drawError_1
0997   0601 32 4F 31      sta cmd_new_1
0998   0604 CD 82 14      call cmd_new1
0999   0607 CD 13 13      call drawError
1000   060A             ;43 drawScreen();
1001   060A CD 74 14      call drawScreen
1002   060D C9            ret
1003   060E             ; --------------------------------------------------------------
1004   060E             cmd_editview:
1005   060E C5            push b
1006   060F             ;733 FileInfo* f = getSel();
1007   060F 22 50 31      shld cmd_editview_1
1008   0612 CD 85 10      call getSel
1009   0615             ;734 if(f->fattrib & 0x10) return;
1010   0615 44            mov b, h
1011   0616 4D            mov c, l
1012   0617 21 0B 00      lxi h, 11
1013   061A 09            dad b
1014   061B 7E            mov a, m
1015   061C E6 10         ani 16
1016   061E CA 23 06      jz l1914
1017   0621             ;734 return;
1018   0621 C1            pop b
1019   0622 C9            ret
1020   0623             l1914:
1021   0623             ;735 unpackName(cmdLine, f->fname);
1022   0623 21 D5 2F      lxi h, cmdline
1023   0626 22 7E 32      shld unpackName_1
1024   0629 60            mov h, b
1025   062A 69            mov l, c
1026   062B CD 0C 15      call unpackName
1027   062E             ;736 if(!absolutePath(cmdLine)) {
1028   062E 21 D5 2F      lxi h, cmdline
1029   0631 CD 59 15      call absolutePath
1030   0634 B7            ora a
1031   0635 C2 3D 06      jnz l1915
1032   0638             ;736 {
1033   0638 CD 74 14      call drawScreen
1034   063B             ;738 return;
1035   063B C1            pop b
1036   063C C9            ret
1037   063D             l1915:
1038   063D             ;740 run(app, cmdLine);
1039   063D 2A 50 31      lhld cmd_editview_1
1040   0640 22 87 32      shld run_1
1041   0643 21 D5 2F      lxi h, cmdline
1042   0646 CD CC 15      call run
1043   0649 C1            pop b
1044   064A C9            ret
1045   064B             ; --------------------------------------------------------------
1046   064B             cmd_enter:
1047   064B C5            push b
1048   064C             ;751 if(cmdLine[0]) {
1049   064C 3A D5 2F      lda cmdline
1050   064F B7            ora a
1051   0650 CA 58 06      jz l1916
1052   0653             ;751 {
1053   0653 CD E8 15      call runCmdLine
1054   0656             ;753 return;
1055   0656 C1            pop b
1056   0657 C9            ret
1057   0658             l1916:
1058   0658             ;757 f = getSelNoBack();
1059   0658 CD 1F 16      call getSelNoBack
1060   065B             ;760 if(f == 0) { 
1061   065B 7C            mov a, h
1062   065C B5            ora l
1063   065D C2 67 06      jnz l1917
1064   0660             ;760 { 
1065   0660 44            mov b, h
1066   0661 4D            mov c, l
1067   0662 CD 32 16      call dropPath
1068   0665             ;762 return; 
1069   0665 C1            pop b
1070   0666 C9            ret
1071   0667             l1917:
1072   0667             ;766 unpackName(cmdLine, f->fname);
1073   0667 44            mov b, h
1074   0668 4D            mov c, l
1075   0669 21 D5 2F      lxi h, cmdline
1076   066C 22 7E 32      shld unpackName_1
1077   066F 60            mov h, b
1078   0670 69            mov l, c
1079   0671 CD 0C 15      call unpackName
1080   0674             ;767 if(!absolutePath(cmdLine)) { drawScreen(); return; }
1081   0674 21 D5 2F      lxi h, cmdline
1082   0677 CD 59 15      call absolutePath
1083   067A B7            ora a
1084   067B C2 83 06      jnz l1918
1085   067E             ;767 { drawScreen(); return; }
1086   067E CD 74 14      call drawScreen
1087   0681             ;767 return; }
1088   0681 C1            pop b
1089   0682 C9            ret
1090   0683             l1918:
1091   0683             ;770 if((f->fattrib & 0x10) != 0) { 
1092   0683 21 0B 00      lxi h, 11
1093   0686 09            dad b
1094   0687 7E            mov a, m
1095   0688 E6 10         ani 16
1096   068A CA A5 06      jz l1919
1097   068D             ;770 { 
1098   068D 21 C3 2D      lxi h, (panelA)+(2)
1099   0690 22 90 31      shld strcpy_1
1100   0693 21 D5 2F      lxi h, cmdline
1101   0696 CD 07 0D      call strcpy
1102   0699             ;772 cmdline[0] = 0;
1103   0699 AF            xra a
1104   069A             ;773 reloadFiles(0);
1105   069A 21 00 00      lxi h, 0
1106   069D 32 D5 2F      sta cmdline
1107   06A0 CD 45 16      call reloadFiles
1108   06A3             ;774 return;
1109   06A3 C1            pop b
1110   06A4 C9            ret
1111   06A5             l1919:
1112   06A5             ;778 run(cmdline, "");
1113   06A5 21 D5 2F      lxi h, cmdline
1114   06A8 22 87 32      shld run_1
1115   06AB 21 5C 2A      lxi h, str15
1116   06AE CD CC 15      call run
1117   06B1 C1            pop b
1118   06B2 C9            ret
1119   06B3             ; --------------------------------------------------------------
1120   06B3             cmd_esc:
1121   06B3             ;784 if(cmdLine[0]) {
1122   06B3 3A D5 2F      lda cmdline
1123   06B6 B7            ora a
1124   06B7 CA C2 06      jz l1920
1125   06BA             ;784 {
1126   06BA AF            xra a
1127   06BB             ;786 drawCmdLine();
1128   06BB 32 D5 2F      sta cmdline
1129   06BE CD 6C 0A      call drawCmdLine
1130   06C1             ;787 return;
1131   06C1 C9            ret
1132   06C2             l1920:
1133   06C2             ;789 dropPath();
1134   06C2 CD 32 16      call dropPath
1135   06C5 C9            ret
1136   06C6             ; --------------------------------------------------------------
1137   06C6             cursor_left:
1138   06C6             ;548 if(panelA.cursorX) { 
1139   06C6 3A C3 2E      lda (panelA)+(258)
1140   06C9 B7            ora a
1141   06CA CA D4 06      jz l1921
1142   06CD             ;548 { 
1143   06CD 3D            dcr a
1144   06CE 32 C3 2E      sta (panelA)+(258)
1145   06D1 C3 17 07      jmp l1936
1146   06D4             l1921:
1147   06D4             ;551 if(panelA.offset) { 
1148   06D4 2A C5 2E      lhld (panelA)+(260)
1149   06D7 7C            mov a, h
1150   06D8 B5            ora l
1151   06D9 CA 0C 07      jz l1937
1152   06DC             ;551 { 
1153   06DC EB            xchg
1154   06DD 2A D7 30      lhld rowsCnt
1155   06E0 26 00         mvi h, 0
1156   06E2 CD CD 29      call op_cmp16
1157   06E5 CA F7 06      jz l1945
1158   06E8 DA F7 06      jc l1945
1159   06EB             ;552 { 
1160   06EB 21 00 00      lxi h, 0
1161   06EE             ;554 drawFiles();
1162   06EE 22 C5 2E      shld (panelA)+(260)
1163   06F1 CD 01 11      call drawFiles
1164   06F4 C3 09 07      jmp l1953
1165   06F7             l1945:
1166   06F7             ;555 {
1167   06F7 2A D7 30      lhld rowsCnt
1168   06FA 26 00         mvi h, 0
1169   06FC EB            xchg
1170   06FD 2A C5 2E      lhld (panelA)+(260)
1171   0700 CD 40 2A      call op_sub16_swap
1172   0703             ;557 drawFiles();
1173   0703 22 C5 2E      shld (panelA)+(260)
1174   0706 CD 01 11      call drawFiles
1175   0709             ; label1
1176   0709             l1953:
1177   0709 C3 17 07      jmp l1958
1178   070C             l1937:
1179   070C             ;560 if(panelA.cursorY) {
1180   070C 3A C4 2E      lda (panelA)+(259)
1181   070F B7            ora a
1182   0710 CA 14 07      jz l1959
1183   0713             ;560 {
1184   0713 AF            xra a
1185   0714             l1959:
1186   0714 32 C4 2E      sta (panelA)+(259)
1187   0717             ; label1
1188   0717             l1958:
1189   0717             ; label1
1190   0717             l1936:
1191   0717             ;564 showFileCursorAndDrawFileInfo();
1192   0717 CD 95 12      call showFileCursorAndDrawFileInfo
1193   071A C9            ret
1194   071B             ; --------------------------------------------------------------
1195   071B             cursor_right:
1196   071B C5            push b
1197   071C             ;574 w = panelA.offset + panelA.cursorY + panelA.cursorX*22;
1198   071C 2A C3 2E      lhld (panelA)+(258)
1199   071F 26 00         mvi h, 0
1200   0721 54            mov d, h
1201   0722 5D            mov e, l
1202   0723 29            dad h
1203   0724 29            dad h
1204   0725 19            dad d
1205   0726 29            dad h
1206   0727 19            dad d
1207   0728 29            dad h
1208   0729 E5            push h
1209   072A 2A C4 2E      lhld (panelA)+(259)
1210   072D 26 00         mvi h, 0
1211   072F EB            xchg
1212   0730 2A C5 2E      lhld (panelA)+(260)
1213   0733 19            dad d
1214   0734 D1            pop d
1215   0735 19            dad d
1216   0736             ;575 if(w + rowsCnt >= panelA.cnt) { //! перепутаны > и >=
1217   0736 44            mov b, h
1218   0737 4D            mov c, l
1219   0738 2A D7 30      lhld rowsCnt
1220   073B 26 00         mvi h, 0
1221   073D 09            dad b
1222   073E EB            xchg
1223   073F 2A C7 2E      lhld (panelA)+(262)
1224   0742 CD CD 29      call op_cmp16
1225   0745 CA 4B 07      jz $+6
1226   0748 D2 B5 07      jnc l2558
1227   074B             ;575 { //! перепутаны > и >=
1228   074B EB            xchg
1229   074C 60            mov h, b
1230   074D 69            mov l, c
1231   074E 23            inx h
1232   074F CD CD 29      call op_cmp16
1233   0752 DA 57 07      jc l2580
1234   0755             ;577 { 
1235   0755 C1            pop b
1236   0756 C9            ret
1237   0757             l2580:
1238   0757             ;581 panelA.cursorY = panelA.cnt - (panelA.offset + panelA.cursorX*rowsCnt + 1);
1239   0757 2A D7 30      lhld rowsCnt
1240   075A 26 00         mvi h, 0
1241   075C EB            xchg
1242   075D 2A C3 2E      lhld (panelA)+(258)
1243   0760 26 00         mvi h, 0
1244   0762 CD D3 29      call op_mul16
1245   0765 EB            xchg
1246   0766 2A C5 2E      lhld (panelA)+(260)
1247   0769 19            dad d
1248   076A 23            inx h
1249   076B EB            xchg
1250   076C 2A C7 2E      lhld (panelA)+(262)
1251   076F CD 40 2A      call op_sub16_swap
1252   0772 7D            mov a, l
1253   0773             ;583 if(panelA.cursorY > rowsCnt-1) {
1254   0773 6F            mov l, a
1255   0774 26 00         mvi h, 0
1256   0776 EB            xchg
1257   0777 2A D7 30      lhld rowsCnt
1258   077A 26 00         mvi h, 0
1259   077C 2B            dcx h
1260   077D 32 C4 2E      sta (panelA)+(259)
1261   0780 CD CD 29      call op_cmp16
1262   0783 D2 B2 07      jnc l2661
1263   0786             ;583 {
1264   0786 3A D7 30      lda rowsCnt
1265   0789 57            mov d, a
1266   078A 3A C4 2E      lda (panelA)+(259)
1267   078D 92            sub d
1268   078E             ;585 if(panelA.cursorX == 1) { 
1269   078E 32 C4 2E      sta (panelA)+(259)
1270   0791 3A C3 2E      lda (panelA)+(258)
1271   0794 3D            dcr a
1272   0795 C2 AB 07      jnz l2683
1273   0798             ;585 { 
1274   0798 2A D7 30      lhld rowsCnt
1275   079B 26 00         mvi h, 0
1276   079D EB            xchg
1277   079E 2A C5 2E      lhld (panelA)+(260)
1278   07A1 19            dad d
1279   07A2             ;587 drawFiles();
1280   07A2 22 C5 2E      shld (panelA)+(260)
1281   07A5 CD 01 11      call drawFiles
1282   07A8 C3 B2 07      jmp l2707
1283   07AB             l2683:
1284   07AB             ;588 {
1285   07AB 3A C3 2E      lda (panelA)+(258)
1286   07AE 3C            inr a
1287   07AF 32 C3 2E      sta (panelA)+(258)
1288   07B2             ; label1
1289   07B2             l2707:
1290   07B2             l2661:
1291   07B2 C3 D6 07      jmp l2708
1292   07B5             l2558:
1293   07B5             ;593 if(panelA.cursorX == 1) { 
1294   07B5 3A C3 2E      lda (panelA)+(258)
1295   07B8 3D            dcr a
1296   07B9 C2 CF 07      jnz l2709
1297   07BC             ;593 { 
1298   07BC 2A D7 30      lhld rowsCnt
1299   07BF 26 00         mvi h, 0
1300   07C1 EB            xchg
1301   07C2 2A C5 2E      lhld (panelA)+(260)
1302   07C5 19            dad d
1303   07C6             ;595 drawFiles();
1304   07C6 22 C5 2E      shld (panelA)+(260)
1305   07C9 CD 01 11      call drawFiles
1306   07CC C3 D6 07      jmp l2731
1307   07CF             l2709:
1308   07CF             ;596 {
1309   07CF 3A C3 2E      lda (panelA)+(258)
1310   07D2 3C            inr a
1311   07D3 32 C3 2E      sta (panelA)+(258)
1312   07D6             ; label1
1313   07D6             l2731:
1314   07D6             ; label1
1315   07D6             l2708:
1316   07D6             ;600 showFileCursorAndDrawFileInfo();
1317   07D6 CD 95 12      call showFileCursorAndDrawFileInfo
1318   07D9 C1            pop b
1319   07DA C9            ret
1320   07DB             ; --------------------------------------------------------------
1321   07DB             cursor_down:
1322   07DB             ;626 if(panelA.offset + panelA.cursorX*rowsCnt + panelA.cursorY + 1 >= panelA.cnt) return;
1323   07DB 2A C7 2E      lhld (panelA)+(262)
1324   07DE E5            push h
1325   07DF 2A D7 30      lhld rowsCnt
1326   07E2 26 00         mvi h, 0
1327   07E4 EB            xchg
1328   07E5 2A C3 2E      lhld (panelA)+(258)
1329   07E8 26 00         mvi h, 0
1330   07EA CD D3 29      call op_mul16
1331   07ED EB            xchg
1332   07EE 2A C5 2E      lhld (panelA)+(260)
1333   07F1 19            dad d
1334   07F2 EB            xchg
1335   07F3 2A C4 2E      lhld (panelA)+(259)
1336   07F6 26 00         mvi h, 0
1337   07F8 19            dad d
1338   07F9 23            inx h
1339   07FA D1            pop d
1340   07FB CD CD 29      call op_cmp16
1341   07FE D0            rnc
1342   07FF             ;626 return;
1343   07FF             l2732:
1344   07FF             ;628 if(panelA.cursorY < rowsCnt-1) {
1345   07FF 2A D7 30      lhld rowsCnt
1346   0802 26 00         mvi h, 0
1347   0804 2B            dcx h
1348   0805 EB            xchg
1349   0806 2A C4 2E      lhld (panelA)+(259)
1350   0809 26 00         mvi h, 0
1351   080B CD CD 29      call op_cmp16
1352   080E D2 1B 08      jnc l3250
1353   0811             ;628 {
1354   0811 3A C4 2E      lda (panelA)+(259)
1355   0814 3C            inr a
1356   0815 32 C4 2E      sta (panelA)+(259)
1357   0818 C3 3A 08      jmp l3293
1358   081B             l3250:
1359   081B             ;631 if(panelA.cursorX == 0) {
1360   081B 3A C3 2E      lda (panelA)+(258)
1361   081E B7            ora a
1362   081F C2 30 08      jnz l3294
1363   0822             ;631 {
1364   0822 AF            xra a
1365   0823             ;633 ++panelA.cursorX; 
1366   0823 32 C4 2E      sta (panelA)+(259)
1367   0826 3A C3 2E      lda (panelA)+(258)
1368   0829 3C            inr a
1369   082A 32 C3 2E      sta (panelA)+(258)
1370   082D C3 3A 08      jmp l3302
1371   0830             l3294:
1372   0830             ;634 { 
1373   0830 2A C5 2E      lhld (panelA)+(260)
1374   0833             ;636 drawFiles();
1375   0833 23            inx h
1376   0834 22 C5 2E      shld (panelA)+(260)
1377   0837 CD 01 11      call drawFiles
1378   083A             ; label1
1379   083A             l3302:
1380   083A             ; label1
1381   083A             l3293:
1382   083A             ;639 showFileCursorAndDrawFileInfo();
1383   083A CD 95 12      call showFileCursorAndDrawFileInfo
1384   083D C9            ret
1385   083E             ; --------------------------------------------------------------
1386   083E             cursor_up:
1387   083E             ;607 if(panelA.cursorY) { 
1388   083E 3A C4 2E      lda (panelA)+(259)
1389   0841 B7            ora a
1390   0842 CA 4C 08      jz l3303
1391   0845             ;607 { 
1392   0845 3D            dcr a
1393   0846 32 C4 2E      sta (panelA)+(259)
1394   0849 C3 70 08      jmp l3318
1395   084C             l3303:
1396   084C             ;610 if(panelA.cursorX) { 
1397   084C 3A C3 2E      lda (panelA)+(258)
1398   084F B7            ora a
1399   0850 CA 61 08      jz l3319
1400   0853             ;610 { 
1401   0853 3D            dcr a
1402   0854             ;612 panelA.cursorY = rowsCnt-1; 
1403   0854 32 C3 2E      sta (panelA)+(258)
1404   0857 3A D7 30      lda rowsCnt
1405   085A 3D            dcr a
1406   085B 32 C4 2E      sta (panelA)+(259)
1407   085E C3 70 08      jmp l3343
1408   0861             l3319:
1409   0861             ;614 if(panelA.offset) {
1410   0861 2A C5 2E      lhld (panelA)+(260)
1411   0864 7C            mov a, h
1412   0865 B5            ora l
1413   0866 CA 70 08      jz l3344
1414   0869             ;614 {
1415   0869             ;616 drawFiles();
1416   0869 2B            dcx h
1417   086A 22 C5 2E      shld (panelA)+(260)
1418   086D CD 01 11      call drawFiles
1419   0870             l3344:
1420   0870             ; label1
1421   0870             l3343:
1422   0870             ; label1
1423   0870             l3318:
1424   0870             ;619 showFileCursorAndDrawFileInfo();
1425   0870 CD 95 12      call showFileCursorAndDrawFileInfo
1426   0873 C9            ret
1427   0874             ; --------------------------------------------------------------
1428   0874             cmd_tab:
1429   0874             ;646 hideFileCursor();
1430   0874 CD 7F 16      call hideFileCursor
1431   0877             ;647 drawPanelTitle(0, panelA.path1);
1432   0877 AF            xra a
1433   0878 32 82 31      sta drawPanelTitle_1
1434   087B 21 C3 2D      lxi h, (panelA)+(2)
1435   087E CD D4 0B      call drawPanelTitle
1436   0881             ;648 swapPanels();
1437   0881 CD 5B 0D      call swapPanels
1438   0884             ;649 showFileCursor();
1439   0884 CD BE 16      call showFileCursor
1440   0887             ;650 drawPanelTitle(1, panelA.path1);
1441   0887 3E 01         mvi a, 1
1442   0889 32 82 31      sta drawPanelTitle_1
1443   088C 21 C3 2D      lxi h, (panelA)+(2)
1444   088F CD D4 0B      call drawPanelTitle
1445   0892             ;651 drawCmdLineWithPath();
1446   0892 CD 6E 02      call drawCmdLineWithPath
1447   0895 C9            ret
1448   0896             ; --------------------------------------------------------------
1449   0896             cmd_copymove:
1450   0896             ;269 drawError(copymode ? "o{ibka kopirowaniq" : "o{ibka pereme}eniq", cmd_copymove1(copymode, shiftPressed));
1451   0896 32 60 31      sta cmd_copymove_2
1452   0899 3A 5F 31      lda cmd_copymove_1
1453   089C B7            ora a
1454   089D CA A6 08      jz l3346
1455   08A0 21 8A 2C      lxi h, str27
1456   08A3 C3 A9 08      jmp l3345
1457   08A6             ; label1
1458   08A6             l3346:
1459   08A6 21 AF 2C      lxi h, str28
1460   08A9             ; label1
1461   08A9             l3345:
1462   08A9 22 62 32      shld drawError_1
1463   08AC 32 9C 32      sta cmd_copymove1_1
1464   08AF 3A 60 31      lda cmd_copymove_2
1465   08B2 CD 1B 17      call cmd_copymove1
1466   08B5 CD 13 13      call drawError
1467   08B8             ;270 drawScreen();
1468   08B8 CD 74 14      call drawScreen
1469   08BB C9            ret
1470   08BC             ; --------------------------------------------------------------
1471   08BC             cmd_delete:
1472   08BC C5            push b
1473   08BD             ;72 if(confirm(" udalitx ", "wy hotite udalitx fail(y)?")) {
1474   08BD 21 28 2B      lxi h, str39
1475   08C0 22 BC 33      shld confirm_1
1476   08C3 21 8C 2D      lxi h, str40
1477   08C6 CD 0E 19      call confirm
1478   08C9 B7            ora a
1479   08CA CA 1E 09      jz l3347
1480   08CD             ;72 {
1481   08CD 0E 00         mvi c, 0
1482   08CF             ;76 if(getFirstSelected(cmdLine)) {
1483   08CF 21 D5 2F      lxi h, cmdline
1484   08D2 CD 51 19      call getFirstSelected
1485   08D5 B7            ora a
1486   08D6 CA 1E 09      jz l3355
1487   08D9             ;76 {
1488   08D9             l121:
1489   08D9             l120:
1490   08D9             ;77 {
1491   08D9 21 D5 2F      lxi h, cmdline
1492   08DC CD 59 15      call absolutePath
1493   08DF B7            ora a
1494   08E0 C2 E8 08      jnz l3363
1495   08E3             ;78 { e = ERR_RECV_STRING; break; }
1496   08E3 06 0B         mvi b, 11
1497   08E5             ;78 break; }
1498   08E5 C3 0D 09      jmp l119
1499   08E8             l3363:
1500   08E8             ;81 e = cmd_deleteFile();
1501   08E8 CD 9D 19      call cmd_deleteFile
1502   08EB             ;84 if(e == ERR_DIR_NOT_EMPTY) {
1503   08EB FE 07         cpi 7
1504   08ED C2 F5 08      jnz l3364
1505   08F0             ;84 {
1506   08F0 0E 01         mvi c, 1
1507   08F2             ;86 e = cmd_deleteFolder();
1508   08F2 CD C8 19      call cmd_deleteFolder
1509   08F5             l3364:
1510   08F5             ;88 if(e) break;
1511   08F5 B7            ora a
1512   08F6 47            mov b, a
1513   08F7 CA FD 08      jz l3365
1514   08FA             ;88 break;
1515   08FA C3 0D 09      jmp l119
1516   08FD             l3365:
1517   08FD             ;91 if(!getNextSelected(cmdLine)) break;
1518   08FD 21 D5 2F      lxi h, cmdline
1519   0900 CD 89 1A      call getNextSelected
1520   0903 B7            ora a
1521   0904 C2 0A 09      jnz l3374
1522   0907             ;91 break;
1523   0907 C3 0D 09      jmp l119
1524   090A             l3374:
1525   090A C3 D9 08      jmp l121
1526   090D             l119:
1527   090D             ;95 drawError("o{ibka udaleniq", e);
1528   090D 21 D8 2C      lxi h, str41
1529   0910 22 62 32      shld drawError_1
1530   0913 78            mov a, b
1531   0914 CD 13 13      call drawError
1532   0917             ;98 getFiles();
1533   0917 CD 90 03      call getFiles
1534   091A             ;99 dupFiles(needRefresh2);
1535   091A 79            mov a, c
1536   091B CD A7 04      call dupFiles
1537   091E             l3355:
1538   091E             l3347:
1539   091E             ;103 drawScreen();
1540   091E CD 74 14      call drawScreen
1541   0921 C1            pop b
1542   0922 C9            ret
1543   0923             ; --------------------------------------------------------------
1544   0923             cmd_inverseOne:
1545   0923 C5            push b
1546   0924             ;795 FileInfo* f = getSelNoBack();
1547   0924 CD 1F 16      call getSelNoBack
1548   0927             ;796 if(!f) return;
1549   0927 7C            mov a, h
1550   0928 B5            ora l
1551   0929 C2 2E 09      jnz l3375
1552   092C             ;796 return;
1553   092C C1            pop b
1554   092D C9            ret
1555   092E             l3375:
1556   092E             ;797 f->fattrib ^= 0x80;
1557   092E 44            mov b, h
1558   092F 4D            mov c, l
1559   0930 11 0B 00      lxi d, 11
1560   0933 19            dad d
1561   0934 7E            mov a, m
1562   0935 EE 80         xri 128
1563   0937 77            mov m, a
1564   0938             ;798 drawFile(panelA.cursorX, panelA.cursorY, f);
1565   0938 3A C3 2E      lda (panelA)+(258)
1566   093B 32 CB 33      sta drawFile_1
1567   093E 3A C4 2E      lda (panelA)+(259)
1568   0941 32 CC 33      sta drawFile_2
1569   0944 60            mov h, b
1570   0945 69            mov l, c
1571   0946 CD F6 1A      call drawFile
1572   0949             ;799 cursor_down();
1573   0949 CD DB 07      call cursor_down
1574   094C C1            pop b
1575   094D C9            ret
1576   094E             ; --------------------------------------------------------------
1577   094E             cmd_inverseAll:
1578   094E C5            push b
1579   094F             ;807 for(f = panelA.files1, i = panelA.cnt; i; --i, ++f) {
1580   094F 2A C1 2D      lhld panelA
1581   0952 44            mov b, h
1582   0953 4D            mov c, l
1583   0954 2A C7 2E      lhld (panelA)+(262)
1584   0957 22 67 31      shld cmd_inverseAll_i
1585   095A             l64:
1586   095A 2A 67 31      lhld cmd_inverseAll_i
1587   095D 7C            mov a, h
1588   095E B5            ora l
1589   095F CA 8F 09      jz l62
1590   0962             ;807 {
1591   0962 60            mov h, b
1592   0963 69            mov l, c
1593   0964 11 0B 00      lxi d, 11
1594   0967 19            dad d
1595   0968 7E            mov a, m
1596   0969 E6 10         ani 16
1597   096B CA 75 09      jz l8510
1598   096E             ;808 {
1599   096E 7E            mov a, m
1600   096F E6 7F         ani 127
1601   0971 77            mov m, a
1602   0972 C3 7F 09      jmp l12212
1603   0975             l8510:
1604   0975             ;810 {
1605   0975 60            mov h, b
1606   0976 69            mov l, c
1607   0977 11 0B 00      lxi d, 11
1608   097A 19            dad d
1609   097B 7E            mov a, m
1610   097C EE 80         xri 128
1611   097E 77            mov m, a
1612   097F             ; label1
1613   097F             l12212:
1614   097F             l63:
1615   097F 2A 67 31      lhld cmd_inverseAll_i
1616   0982 2B            dcx h
1617   0983 22 67 31      shld cmd_inverseAll_i
1618   0986 21 14 00      lxi h, 20
1619   0989 09            dad b
1620   098A 44            mov b, h
1621   098B 4D            mov c, l
1622   098C C3 5A 09      jmp l64
1623   098F             l62:
1624   098F             ;814 drawFiles();
1625   098F CD 01 11      call drawFiles
1626   0992             ;815 showFileCursor();
1627   0992 CD BE 16      call showFileCursor
1628   0995 C1            pop b
1629   0996 C9            ret
1630   0997             ; --------------------------------------------------------------
1631   0997             cmd_sel:
1632   0997 C5            push b
1633   0998             ;33 strcpy(cmdLine, "*.*");
1634   0998 21 D5 2F      lxi h, cmdline
1635   099B 22 90 31      shld strcpy_1
1636   099E 21 32 2B      lxi h, str42
1637   09A1 32 69 31      sta cmd_sel_1
1638   09A4 CD 07 0D      call strcpy
1639   09A7             ;34 if(inputBox(" pometitx fajly ")) {
1640   09A7 21 ED 2A      lxi h, str43
1641   09AA CD 22 1B      call inputBox
1642   09AD B7            ora a
1643   09AE CA 20 0A      jz l12213
1644   09B1             ;34 {
1645   09B1 21 6E 31      lxi h, cmd_sel_buf
1646   09B4 22 D3 33      shld packName_1
1647   09B7 21 D5 2F      lxi h, cmdline
1648   09BA CD 90 1B      call packName
1649   09BD             ;37 for(i=panelA.cnt, f=panelA.files1; i; --i, ++f) {
1650   09BD 2A C7 2E      lhld (panelA)+(262)
1651   09C0 22 6C 31      shld cmd_sel_i
1652   09C3 2A C1 2D      lhld panelA
1653   09C6 44            mov b, h
1654   09C7 4D            mov c, l
1655   09C8             l129:
1656   09C8 2A 6C 31      lhld cmd_sel_i
1657   09CB 7C            mov a, h
1658   09CC B5            ora l
1659   09CD CA 20 0A      jz l127
1660   09D0             ;37 {
1661   09D0 60            mov h, b
1662   09D1 69            mov l, c
1663   09D2 11 0B 00      lxi d, 11
1664   09D5 19            dad d
1665   09D6 7E            mov a, m
1666   09D7 E6 10         ani 16
1667   09D9 CA E3 09      jz l17348
1668   09DC             ;38 {
1669   09DC 7E            mov a, m
1670   09DD E6 7F         ani 127
1671   09DF 77            mov m, a
1672   09E0 C3 10 0A      jmp l25391
1673   09E3             l17348:
1674   09E3             ;40 {
1675   09E3 60            mov h, b
1676   09E4 69            mov l, c
1677   09E5 22 DA 33      shld compareMask_1
1678   09E8 21 6E 31      lxi h, cmd_sel_buf
1679   09EB CD E7 1B      call compareMask
1680   09EE B7            ora a
1681   09EF CA 10 0A      jz l25392
1682   09F2             ;41 {
1683   09F2 3A 69 31      lda cmd_sel_1
1684   09F5 B7            ora a
1685   09F6 CA 06 0A      jz l27542
1686   09F9             ;42 {
1687   09F9 60            mov h, b
1688   09FA 69            mov l, c
1689   09FB 11 0B 00      lxi d, 11
1690   09FE 19            dad d
1691   09FF 7E            mov a, m
1692   0A00 F6 80         ori 128
1693   0A02 77            mov m, a
1694   0A03 C3 10 0A      jmp l28060
1695   0A06             l27542:
1696   0A06             ;44 {
1697   0A06 60            mov h, b
1698   0A07 69            mov l, c
1699   0A08 11 0B 00      lxi d, 11
1700   0A0B 19            dad d
1701   0A0C 7E            mov a, m
1702   0A0D E6 7F         ani 127
1703   0A0F 77            mov m, a
1704   0A10             ; label1
1705   0A10             l28060:
1706   0A10             l25392:
1707   0A10             ; label1
1708   0A10             l25391:
1709   0A10             l128:
1710   0A10 2A 6C 31      lhld cmd_sel_i
1711   0A13 2B            dcx h
1712   0A14 22 6C 31      shld cmd_sel_i
1713   0A17 21 14 00      lxi h, 20
1714   0A1A 09            dad b
1715   0A1B 44            mov b, h
1716   0A1C 4D            mov c, l
1717   0A1D C3 C8 09      jmp l129
1718   0A20             l127:
1719   0A20             l12213:
1720   0A20             ;52 drawScreen();
1721   0A20 CD 74 14      call drawScreen
1722   0A23 C1            pop b
1723   0A24 C9            ret
1724   0A25             ; --------------------------------------------------------------
1725   0A25             processInput:
1726   0A25 C5            push b
1727   0A26             ;156 register uint cmdline_pos = strlen(cmdline);
1728   0A26 21 D5 2F      lxi h, cmdline
1729   0A29 32 79 31      sta processInput_1
1730   0A2C CD B7 0C      call strlen
1731   0A2F             ;157 if(c==KEY_BKSPC) {
1732   0A2F 3A 79 31      lda processInput_1
1733   0A32 FE 7F         cpi 127
1734   0A34 44            mov b, h
1735   0A35 4D            mov c, l
1736   0A36 C2 4B 0A      jnz l28061
1737   0A39             ;157 {
1738   0A39 7C            mov a, h
1739   0A3A B5            ora l
1740   0A3B C2 40 0A      jnz l28069
1741   0A3E             ;158 return;
1742   0A3E C1            pop b
1743   0A3F C9            ret
1744   0A40             l28069:
1745   0A40             ;159 --cmdline_pos;    
1746   0A40             ;160 cmdline[cmdline_pos] = 0;
1747   0A40 2B            dcx h
1748   0A41 11 D5 2F      lxi d, cmdline
1749   0A44 44            mov b, h
1750   0A45 4D            mov c, l
1751   0A46 19            dad d
1752   0A47 36 00         mvi m, 0
1753   0A49             ;161 return;
1754   0A49 C1            pop b
1755   0A4A C9            ret
1756   0A4B             l28061:
1757   0A4B             ;163 if(c>=32) {
1758   0A4B FE 20         cpi 32
1759   0A4D DA 6A 0A      jc l28072
1760   0A50             ;163 {
1761   0A50 11 FF 00      lxi d, 255
1762   0A53 CD CD 29      call op_cmp16
1763   0A56 C2 5B 0A      jnz l28080
1764   0A59             ;164 return; 
1765   0A59 C1            pop b
1766   0A5A C9            ret
1767   0A5B             l28080:
1768   0A5B             ;165 cmdline[cmdline_pos] = c;
1769   0A5B 3A 79 31      lda processInput_1
1770   0A5E 11 D5 2F      lxi d, cmdline
1771   0A61 19            dad d
1772   0A62 77            mov m, a
1773   0A63             ;166 ++cmdline_pos;
1774   0A63 03            inx b
1775   0A64             ;167 cmdline[cmdline_pos] = 0;
1776   0A64 21 D5 2F      lxi h, cmdline
1777   0A67 09            dad b
1778   0A68 36 00         mvi m, 0
1779   0A6A             l28072:
1780   0A6A C1            pop b
1781   0A6B C9            ret
1782   0A6C             ; --------------------------------------------------------------
1783   0A6C             drawCmdLine:
1784   0A6C             ;286 drawInput(panelA.cmdLineOff, rowsCnt+6, fs_screenWidth-panelA.cmdLineOff);
1785   0A6C 3A C9 2E      lda (panelA)+(264)
1786   0A6F 32 DE 33      sta drawInput_1
1787   0A72 3A D7 30      lda rowsCnt
1788   0A75 C6 06         adi 6
1789   0A77 32 DF 33      sta drawInput_2
1790   0A7A 2A C9 2E      lhld (panelA)+(264)
1791   0A7D EB            xchg
1792   0A7E 2A 11 31      lhld fs_screenWidth
1793   0A81 26 00         mvi h, 0
1794   0A83 CD 40 2A      call op_sub16_swap
1795   0A86 7D            mov a, l
1796   0A87 CD 1B 1C      call drawInput
1797   0A8A C9            ret
1798   0A8B             ; --------------------------------------------------------------
1799   0A8B             fs_initScreen:
1800   0A8B             ;28 fs_clearScreen();
1801   0A8B CD D8 0A      call fs_clearScreen
1802   0A8E             ;29 asm { 
1803   0A8E              
1804   0A8E                 ; Настройка микросхем
1805   0A8E 21 01 EF        lxi h, 61185
1806   0A91 36 00           mvi m, 0
1807   0A93 2D              dcr l
1808   0A94 36 4D           mvi m, 77
1809   0A96 36 64           mvi m, 100
1810   0A98 36 77           mvi m, 119
1811   0A9A 36 53           mvi m, 83
1812   0A9C 2C              inr l
1813   0A9D 36 23           mvi m, 35
1814   0A9F             fs_clearScreen_1:
1815   0A9F 3A 01 EF        lda 61185
1816   0AA2 E6 20           ani 32
1817   0AA4 CA 9F 0A        jz fs_clearScreen_1
1818   0AA7             fs_clearScreen_2:
1819   0AA7 3A 01 EF        lda 61185
1820   0AAA E6 20           ani 32
1821   0AAC CA A7 0A        jz fs_clearScreen_2
1822   0AAF                 ; Программирование контроллеров
1823   0AAF 21 08 F0        lxi h, 61448
1824   0AB2 36 80           mvi m, 128
1825   0AB4 2E 04           mvi l, 4
1826   0AB6 36 D0           mvi m, 208
1827   0AB8 36 E1           mvi m, 225
1828   0ABA 2C              inr l
1829   0ABB 36 1C           mvi m, 28
1830   0ABD 36 49           mvi m, 73
1831   0ABF 2E 08           mvi l, 8
1832   0AC1 36 A4           mvi m, 164
1833   0AC3 F3              di   
1834   0AC4               
1835   0AC4             ;61 fs_screenWidth  = 64;
1836   0AC4 3E 40         mvi a, 64
1837   0AC6             ;62 fs_screenHeight = 30;
1838   0AC6 32 11 31      sta fs_screenWidth
1839   0AC9 3E 1E         mvi a, 30
1840   0ACB             ;63 fs_colors = 8;    
1841   0ACB 32 12 31      sta fs_screenHeight
1842   0ACE 3E 08         mvi a, 8
1843   0AD0 32 13 31      sta fs_colors
1844   0AD3 C9            ret
1845   0AD4             ; --------------------------------------------------------------
1846   0AD4             fs_window:
1847   0AD4             ;174 return "\x1B\x1C\x04\x1C\x10\x06\x11\x02\x1C\x01";
1848   0AD4 21 63 2A      lxi h, str58
1849   0AD7 C9            ret
1850   0AD8             ; --------------------------------------------------------------
1851   0AD8             fs_clearScreen:
1852   0AD8             ;67 asm {
1853   0AD8 C5              push b
1854   0AD9                 ; Форматирование видеопамяти
1855   0AD9 AF              xra a
1856   0ADA 21 D0 E1        lxi h, 57808
1857   0ADD 06 03           mvi b, 3
1858   0ADF             fs_initScreen_l1:
1859   0ADF 77              mov m, a
1860   0AE0 23              inx h
1861   0AE1 36 F1           mvi m, 241
1862   0AE3 23              inx h
1863   0AE4 05              dcr b
1864   0AE5 C2 DF 0A        jnz fs_initScreen_l1    
1865   0AE8 0E 1F           mvi c, 31
1866   0AEA             fs_initScreen_l2:
1867   0AEA 06 4A           mvi b, 74
1868   0AEC             fs_initScreen_l3:
1869   0AEC 77              mov m, a
1870   0AED 23              inx h
1871   0AEE 05              dcr b
1872   0AEF C2 EC 0A        jnz fs_initScreen_l3
1873   0AF2 36 F1           mvi m, 241
1874   0AF4 23              inx h
1875   0AF5 0D              dcr c
1876   0AF6 C2 EA 0A        jnz fs_initScreen_l2
1877   0AF9 23              inx h
1878   0AFA 36 FF           mvi m, 255
1879   0AFC C1              pop b
1880   0AFD               
1881   0AFD C9            ret
1882   0AFE             ; --------------------------------------------------------------
1883   0AFE             fs_print:
1884   0AFE             ;99 asm {
1885   0AFE 32 81 31      sta fs_print_5
1886   0B01                 ; Расчет адреса ((uchar*)0xE1D0) + x + y * 78;
1887   0B01             ;    lhld fs_print_2
1888   0B01             ;    mvi h, 0
1889   0B01             ;    mov d, h
1890   0B01             ;    mov e, l
1891   0B01             ;    dad h
1892   0B01             ;    dad h
1893   0B01             ;    dad h
1894   0B01             ;    dad d    
1895   0B01             ;    dad h
1896   0B01             ;    dad d    
1897   0B01             ;    dad h
1898   0B01             ;    dad d    
1899   0B01             ;    dad h
1900   0B01             ;    xchg
1901   0B01             ;    lhld fs_print_1
1902   0B01             ;    mvi h, 0
1903   0B01             ;    dad d  
1904   0B01             ;    lxi d, 0E1D0h
1905   0B01                 
1906   0B01                 ; Расчет адреса ((uchar*)0xE1DF) + x + y * 75;
1907   0B01 2A 7D 31        lhld fs_print_2
1908   0B04 26 00           mvi h, 0
1909   0B06 54              mov d, h
1910   0B07 5D              mov e, l
1911   0B08 29              dad h
1912   0B09 29              dad h
1913   0B0A 29              dad h
1914   0B0B 19              dad d    
1915   0B0C 29              dad h
1916   0B0D 29              dad h
1917   0B0E 19              dad d    
1918   0B0F 29              dad h
1919   0B10 19              dad d
1920   0B11 EB              xchg
1921   0B12 2A 7C 31        lhld fs_print_1
1922   0B15 26 00           mvi h, 0
1923   0B17 19              dad d  
1924   0B18 11 DF E1        lxi d, 0E1DFh
1925   0B1B 19              dad d
1926   0B1C C5              push b
1927   0B1D EB              xchg
1928   0B1E 2A 7F 31        lhld fs_print_4
1929   0B21 EB              xchg
1930   0B22 3A 7E 31        lda  fs_print_3
1931   0B25 47              mov  b, a
1932   0B26             fs_print_loop:
1933   0B26 1A              ldax d
1934   0B27 13              inx  d
1935   0B28 E6 7F           ani  07Fh
1936   0B2A CA 35 0B        jz   fs_print_spc
1937   0B2D 77              mov  m, a
1938   0B2E 23              inx  h
1939   0B2F 05              dcr  b
1940   0B30 C2 26 0B        jnz  fs_print_loop 
1941   0B33 C1              pop b
1942   0B34 C9              ret
1943   0B35             
1944   0B35             fs_print_spc:
1945   0B35 3A 81 31        lda  fs_print_5      
1946   0B38 E6 7F           ani  07Fh
1947   0B3A CA 43 0B        jz   fs_print_ret
1948   0B3D             fs_print_loop2:
1949   0B3D 77              mov  m, a
1950   0B3E 23              inx  h
1951   0B3F 05              dcr  b
1952   0B40 C2 3D 0B        jnz  fs_print_loop2
1953   0B43             fs_print_ret:
1954   0B43 C1              pop b
1955   0B44 CD 8A 0D        call fs_hideCursor
1956   0B47               
1957   0B47 C9            ret
1958   0B48             ; --------------------------------------------------------------
1959   0B48             drawPanel:
1960   0B48             ;112 drawRect(activePanel, 0, 31, rowsCnt + 6, 0);
1961   0B48 3A F2 30      lda activePanel
1962   0B4B 32 EB 33      sta drawRect_1
1963   0B4E 3A D7 30      lda rowsCnt
1964   0B51 C6 06         adi 6
1965   0B53 32 EE 33      sta drawRect_4
1966   0B56 AF            xra a
1967   0B57 32 EC 33      sta drawRect_2
1968   0B5A 3E 1F         mvi a, 31
1969   0B5C 32 ED 33      sta drawRect_3
1970   0B5F AF            xra a
1971   0B60 CD C3 1C      call drawRect
1972   0B63             ;113 drawRect(activePanel + 1, rowsCnt + 2, 29, 1, 0); // hLine
1973   0B63 3A F2 30      lda activePanel
1974   0B66 3C            inr a
1975   0B67 32 EB 33      sta drawRect_1
1976   0B6A 3A D7 30      lda rowsCnt
1977   0B6D C6 02         adi 2
1978   0B6F 32 EC 33      sta drawRect_2
1979   0B72 3E 01         mvi a, 1
1980   0B74 32 EE 33      sta drawRect_4
1981   0B77 3E 1D         mvi a, 29
1982   0B79 32 ED 33      sta drawRect_3
1983   0B7C AF            xra a
1984   0B7D CD C3 1C      call drawRect
1985   0B80             ;114 drawRect(activePanel + 15, 1, 1, rowsCnt + 1, 0); // vLine
1986   0B80 3A F2 30      lda activePanel
1987   0B83 C6 0F         adi 15
1988   0B85 32 EB 33      sta drawRect_1
1989   0B88 3A D7 30      lda rowsCnt
1990   0B8B 3C            inr a
1991   0B8C 32 EE 33      sta drawRect_4
1992   0B8F 3E 01         mvi a, 1
1993   0B91 32 EC 33      sta drawRect_2
1994   0B94 32 ED 33      sta drawRect_3
1995   0B97 AF            xra a
1996   0B98 CD C3 1C      call drawRect
1997   0B9B             ;115 fs_print(activePanel + 6, 1, 3, "imq", 0);
1998   0B9B 3A F2 30      lda activePanel
1999   0B9E C6 06         adi 6
2000   0BA0 32 7C 31      sta fs_print_1
2001   0BA3 21 50 2C      lxi h, str52
2002   0BA6 22 7F 31      shld fs_print_4
2003   0BA9 3E 01         mvi a, 1
2004   0BAB 32 7D 31      sta fs_print_2
2005   0BAE 3E 03         mvi a, 3
2006   0BB0 32 7E 31      sta fs_print_3
2007   0BB3 AF            xra a
2008   0BB4 CD FE 0A      call fs_print
2009   0BB7             ;116 fs_print(activePanel + 21, 1, 3, "imq", 0);  
2010   0BB7 3A F2 30      lda activePanel
2011   0BBA C6 15         adi 21
2012   0BBC 32 7C 31      sta fs_print_1
2013   0BBF 21 50 2C      lxi h, str52
2014   0BC2 22 7F 31      shld fs_print_4
2015   0BC5 3E 01         mvi a, 1
2016   0BC7 32 7D 31      sta fs_print_2
2017   0BCA 3E 03         mvi a, 3
2018   0BCC 32 7E 31      sta fs_print_3
2019   0BCF AF            xra a
2020   0BD0 CD FE 0A      call fs_print
2021   0BD3 C9            ret
2022   0BD4             ; --------------------------------------------------------------
2023   0BD4             drawPanelTitle:
2024   0BD4 C5            push b
2025   0BD5             ;151 fs_print(activePanel+1, 0, 29, "", window[3]); 
2026   0BD5 3A F2 30      lda activePanel
2027   0BD8 3C            inr a
2028   0BD9 32 7C 31      sta fs_print_1
2029   0BDC 22 83 31      shld drawPanelTitle_2
2030   0BDF 21 5C 2A      lxi h, str15
2031   0BE2 22 7F 31      shld fs_print_4
2032   0BE5 AF            xra a
2033   0BE6 32 7D 31      sta fs_print_2
2034   0BE9 3E 1D         mvi a, 29
2035   0BEB 32 7E 31      sta fs_print_3
2036   0BEE 2A FA 30      lhld window
2037   0BF1 23            inx h
2038   0BF2 23            inx h
2039   0BF3 23            inx h
2040   0BF4 7E            mov a, m
2041   0BF5 CD FE 0A      call fs_print
2042   0BF8             ;154 if(p[0]==0) p = "/";
2043   0BF8 2A 83 31      lhld drawPanelTitle_2
2044   0BFB AF            xra a
2045   0BFC B6            ora m
2046   0BFD C2 03 0C      jnz l28089
2047   0C00             ;154 p = "/";
2048   0C00 21 3E 2B      lxi h, str23
2049   0C03             l28089:
2050   0C03             ;155 l = strlen(p);
2051   0C03 22 83 31      shld drawPanelTitle_2
2052   0C06 CD B7 0C      call strlen
2053   0C09             ;156 if(l>=27) p=p+(l-27), l=27;
2054   0C09 11 1B 00      lxi d, 27
2055   0C0C CD CD 29      call op_cmp16
2056   0C0F 44            mov b, h
2057   0C10 4D            mov c, l
2058   0C11 DA 23 0C      jc l28090
2059   0C14             ;156 p=p+(l-27), l=27;
2060   0C14 21 E5 FF      lxi h, 65509
2061   0C17 09            dad b
2062   0C18 EB            xchg
2063   0C19 2A 83 31      lhld drawPanelTitle_2
2064   0C1C 19            dad d
2065   0C1D 01 1B 00      lxi b, 27
2066   0C20 22 83 31      shld drawPanelTitle_2
2067   0C23             l28090:
2068   0C23             ;157 x = 1 + (30 - l) / 2 + activePanel;
2069   0C23 60            mov h, b
2070   0C24 69            mov l, c
2071   0C25 11 1E 00      lxi d, 30
2072   0C28 CD 3F 2A      call op_sub16
2073   0C2B 11 02 00      lxi d, 2
2074   0C2E CD FC 29      call op_div16_swap
2075   0C31 23            inx h
2076   0C32 EB            xchg
2077   0C33 2A F2 30      lhld activePanel
2078   0C36 26 00         mvi h, 0
2079   0C38 19            dad d
2080   0C39 7D            mov a, l
2081   0C3A             ;158 fs_print(x, 0, l, p, 0);
2082   0C3A 32 7C 31      sta fs_print_1
2083   0C3D 60            mov h, b
2084   0C3E 69            mov l, c
2085   0C3F 32 87 31      sta drawPanelTitle_x
2086   0C42 7D            mov a, l
2087   0C43 32 7E 31      sta fs_print_3
2088   0C46 2A 83 31      lhld drawPanelTitle_2
2089   0C49 22 7F 31      shld fs_print_4
2090   0C4C AF            xra a
2091   0C4D 32 7D 31      sta fs_print_2
2092   0C50 CD FE 0A      call fs_print
2093   0C53             ;159 if(!active) return;
2094   0C53 3A 82 31      lda drawPanelTitle_1
2095   0C56 B7            ora a
2096   0C57 C2 5C 0C      jnz l28171
2097   0C5A             ;159 return;
2098   0C5A C1            pop b
2099   0C5B C9            ret
2100   0C5C             l28171:
2101   0C5C             ;160 fs_print(x-1, 0, 1, "[", 0);
2102   0C5C 3A 87 31      lda drawPanelTitle_x
2103   0C5F 3D            dcr a
2104   0C60 32 7C 31      sta fs_print_1
2105   0C63 21 C4 2B      lxi h, str47
2106   0C66 22 7F 31      shld fs_print_4
2107   0C69 AF            xra a
2108   0C6A 32 7D 31      sta fs_print_2
2109   0C6D 3C            inr a
2110   0C6E 32 7E 31      sta fs_print_3
2111   0C71 AF            xra a
2112   0C72 CD FE 0A      call fs_print
2113   0C75             ;161 fs_print(x+l, 0, 1, "]", 0);
2114   0C75 2A 87 31      lhld drawPanelTitle_x
2115   0C78 26 00         mvi h, 0
2116   0C7A 09            dad b
2117   0C7B 7D            mov a, l
2118   0C7C 32 7C 31      sta fs_print_1
2119   0C7F 21 07 2C      lxi h, str48
2120   0C82 22 7F 31      shld fs_print_4
2121   0C85 AF            xra a
2122   0C86 32 7D 31      sta fs_print_2
2123   0C89 3C            inr a
2124   0C8A 32 7E 31      sta fs_print_3
2125   0C8D AF            xra a
2126   0C8E CD FE 0A      call fs_print
2127   0C91 C1            pop b
2128   0C92 C9            ret
2129   0C93             ; --------------------------------------------------------------
2130   0C93             drawSwapPanels:
2131   0C93             ;62 if(activePanelN) activePanelN=0, activePanel-=31;
2132   0C93 3A F3 30      lda activePanelN
2133   0C96 B7            ora a
2134   0C97 CA A9 0C      jz l28172
2135   0C9A             ;62 activePanelN=0, activePanel-=31;
2136   0C9A AF            xra a
2137   0C9B 32 F3 30      sta activePanelN
2138   0C9E 3A F2 30      lda activePanel
2139   0CA1 C6 E1         adi 225
2140   0CA3 32 F2 30      sta activePanel
2141   0CA6 C3 B6 0C      jmp l28194
2142   0CA9             l28172:
2143   0CA9             ;63 activePanelN=1, activePanel+=31;
2144   0CA9 3E 01         mvi a, 1
2145   0CAB 32 F3 30      sta activePanelN
2146   0CAE 3A F2 30      lda activePanel
2147   0CB1 C6 1F         adi 31
2148   0CB3 32 F2 30      sta activePanel
2149   0CB6             ; label1
2150   0CB6             l28194:
2151   0CB6 C9            ret
2152   0CB7             ; --------------------------------------------------------------
2153   0CB7             strlen:
2154   0CB7             ;2 asm { 
2155   0CB7 22 88 31      shld strlen_1
2156   0CBA              
2157   0CBA 11 FF FF        lxi d, -1
2158   0CBD             strlen_l1:
2159   0CBD AF              xra a
2160   0CBE B6              ora m
2161   0CBF 13              inx d
2162   0CC0 23              inx h
2163   0CC1 C2 BD 0C        jnz strlen_l1
2164   0CC4 EB              xchg
2165   0CC5               
2166   0CC5 C9            ret
2167   0CC6             ; --------------------------------------------------------------
2168   0CC6             strcmp:
2169   0CC6 C5            push b
2170   0CC7             ;3 while(1) {
2171   0CC7 22 8C 31      shld strcmp_2
2172   0CCA             l180:
2173   0CCA             ;3 {
2174   0CCA 2A 8A 31      lhld strcmp_1
2175   0CCD 7E            mov a, m
2176   0CCE 2A 8C 31      lhld strcmp_2
2177   0CD1 32 8E 31      sta strcmp_a
2178   0CD4 7E            mov a, m
2179   0CD5             ;5 if(a < b) return 255;
2180   0CD5 47            mov b, a
2181   0CD6 3A 8E 31      lda strcmp_a
2182   0CD9 B8            cmp b
2183   0CDA D2 E1 0C      jnc l28195
2184   0CDD             ;5 return 255;
2185   0CDD 3E FF         mvi a, 255
2186   0CDF C1            pop b
2187   0CE0 C9            ret
2188   0CE1             l28195:
2189   0CE1             ;6 if(b < a) return 1;
2190   0CE1 B8            cmp b
2191   0CE2 CA EC 0C      jz l28204
2192   0CE5 DA EC 0C      jc l28204
2193   0CE8             ;6 return 1;
2194   0CE8 3E 01         mvi a, 1
2195   0CEA C1            pop b
2196   0CEB C9            ret
2197   0CEC             l28204:
2198   0CEC             ;7 if(*d==0) return 0;
2199   0CEC 2A 8A 31      lhld strcmp_1
2200   0CEF AF            xra a
2201   0CF0 B6            ora m
2202   0CF1 C2 F7 0C      jnz l28213
2203   0CF4             ;7 return 0;
2204   0CF4 AF            xra a
2205   0CF5 C1            pop b
2206   0CF6 C9            ret
2207   0CF7             l28213:
2208   0CF7             ;8 ++d, ++s;
2209   0CF7 23            inx h
2210   0CF8 22 8A 31      shld strcmp_1
2211   0CFB 2A 8C 31      lhld strcmp_2
2212   0CFE 23            inx h
2213   0CFF 22 8C 31      shld strcmp_2
2214   0D02 C3 CA 0C      jmp l180
2215   0D05             l179:
2216   0D05 C1            pop b
2217   0D06 C9            ret
2218   0D07             ; --------------------------------------------------------------
2219   0D07             strcpy:
2220   0D07             ;2 asm {
2221   0D07 22 92 31      shld strcpy_2
2222   0D0A                 ; de = src
2223   0D0A EB              xchg
2224   0D0B                 ; hl = to
2225   0D0B 2A 90 31        lhld strcpy_1
2226   0D0E             strcpy_l1:
2227   0D0E                 ; *dest = *src
2228   0D0E 1A              ldax d
2229   0D0F 77              mov m, a
2230   0D10 B7              ora a
2231   0D11 23              inx h
2232   0D12 13              inx d
2233   0D13 C2 0E 0D        jnz strcpy_l1
2234   0D16 2B              dcx h
2235   0D17               
2236   0D17 C9            ret
2237   0D18             ; --------------------------------------------------------------
2238   0D18             fs_open:
2239   0D18             ;1 { ((ushort*)a)[0] = (b&0xFFFF); ((ushort*)a)[1] = (b>>16); }
2240   0D18 22 94 31      shld fs_open_1
2241   0D1B 21 80 A9      lxi h, 43392
2242   0D1E             ;1 ((ushort*)a)[1] = (b>>16); }
2243   0D1E 22 14 31      shld readEmuSize
2244   0D21 21 03 00      lxi h, 3
2245   0D24             ;272 return 0;
2246   0D24 AF            xra a
2247   0D25 22 16 31      shld (readEmuSize)+(2)
2248   0D28 C9            ret
2249   0D29             ; --------------------------------------------------------------
2250   0D29             fs_read:
2251   0D29             ;261 if(((ushort*)&readEmuSize)[1] == 0 && ((ushort*)&readEmuSize)[0] < size) {
2252   0D29 22 98 31      shld fs_read_2
2253   0D2C 2A 16 31      lhld (readEmuSize)+(2)
2254   0D2F 7C            mov a, h
2255   0D30 B5            ora l
2256   0D31 C2 47 0D      jnz l28214
2257   0D34 2A 98 31      lhld fs_read_2
2258   0D37 EB            xchg
2259   0D38 2A 14 31      lhld readEmuSize
2260   0D3B CD CD 29      call op_cmp16
2261   0D3E D2 47 0D      jnc l28214
2262   0D41             ;261 {
2263   0D41 22 0D 31      shld fs_low
2264   0D44 C3 4D 0D      jmp l28232
2265   0D47             l28214:
2266   0D47             ;263 {
2267   0D47 2A 98 31      lhld fs_read_2
2268   0D4A 22 0D 31      shld fs_low
2269   0D4D             ; label1
2270   0D4D             l28232:
2271   0D4D             ;266 sub32_16(&readEmuSize, fs_low);
2272   0D4D 21 14 31      lxi h, readEmuSize
2273   0D50 22 F1 33      shld sub32_16_1
2274   0D53 2A 0D 31      lhld fs_low
2275   0D56 CD C1 1E      call sub32_16
2276   0D59             ;267 return 0;
2277   0D59 AF            xra a
2278   0D5A C9            ret
2279   0D5B             ; --------------------------------------------------------------
2280   0D5B             swapPanels:
2281   0D5B             ;56 memswap(&panelA, &panelB, sizeof(Panel));  
2282   0D5B 21 C1 2D      lxi h, panelA
2283   0D5E 22 F5 33      shld memswap_1
2284   0D61 21 CB 2E      lxi h, panelB
2285   0D64 22 F7 33      shld memswap_2
2286   0D67 21 0A 01      lxi h, 266
2287   0D6A CD DD 1E      call memswap
2288   0D6D             ;57 if(onePanel) {
2289   0D6D 3A F9 30      lda onePanel
2290   0D70 B7            ora a
2291   0D71 CA 86 0D      jz l28233
2292   0D74             ;57 {
2293   0D74 3E 01         mvi a, 1
2294   0D76 32 82 31      sta drawPanelTitle_1
2295   0D79 21 C3 2D      lxi h, (panelA)+(2)
2296   0D7C CD D4 0B      call drawPanelTitle
2297   0D7F             ;59 drawCmdLineWithPath();
2298   0D7F CD 6E 02      call drawCmdLineWithPath
2299   0D82             ;60 drawFiles2();
2300   0D82 CD 78 05      call drawFiles2
2301   0D85             ;61 return;
2302   0D85 C9            ret
2303   0D86             l28233:
2304   0D86             ;63 drawSwapPanels();
2305   0D86 CD 93 0C      call drawSwapPanels
2306   0D89 C9            ret
2307   0D8A             ; --------------------------------------------------------------
2308   0D8A             fs_hideCursor:
2309   0D8A             ;178 directCursor(255, 255);
2310   0D8A 3E FF         mvi a, 255
2311   0D8C 32 FB 33      sta directCursor_1
2312   0D8F CD FF 1E      call directCursor
2313   0D92 C9            ret
2314   0D93             ; --------------------------------------------------------------
2315   0D93             memcpy:
2316   0D93             ;2 asm {
2317   0D93 22 9E 31      shld memcpy_3
2318   0D96                 ; if(cnt==0) return
2319   0D96 7C              mov a, h
2320   0D97 B5              ora l
2321   0D98 C8              rz
2322   0D99                 ; start
2323   0D99 C5              push b
2324   0D9A                 ; de = count
2325   0D9A EB              xchg
2326   0D9B                 ; bc = from
2327   0D9B 2A 9C 31        lhld memcpy_2
2328   0D9E 4D              mov c, l
2329   0D9F 44              mov b, h
2330   0DA0                 ; hl = to
2331   0DA0 2A 9A 31        lhld memcpy_1
2332   0DA3                 ; enter loop
2333   0DA3 14              inr d
2334   0DA4 AF              xra a
2335   0DA5 B3              ora e
2336   0DA6 CA B1 0D        jz memcpy_l2
2337   0DA9             memcpy_l1:
2338   0DA9                 ; *dest = *src
2339   0DA9 0A              ldax b
2340   0DAA 77              mov m, a
2341   0DAB                 ; dest++, src++
2342   0DAB 23              inx h
2343   0DAC 03              inx b
2344   0DAD                 ; while(--cnt)
2345   0DAD 1D              dcr e
2346   0DAE C2 A9 0D        jnz memcpy_l1
2347   0DB1             memcpy_l2:
2348   0DB1 15              dcr d
2349   0DB2 C2 A9 0D        jnz memcpy_l1
2350   0DB5 C1              pop b
2351   0DB6               
2352   0DB6 C9            ret
2353   0DB7             ; --------------------------------------------------------------
2354   0DB7             fs_findfirst:
2355   0DB7 C5            push b
2356   0DB8             ;195 fs_low = 0;
2357   0DB8 22 A4 31      shld fs_findfirst_3
2358   0DBB 21 00 00      lxi h, 0
2359   0DBE             ;197 xx=0; 
2360   0DBE 0E 00         mvi c, 0
2361   0DC0             ;198 for(;path[i]!=0; i++)
2362   0DC0 22 0D 31      shld fs_low
2363   0DC3             l145:
2364   0DC3 68            mov l, b
2365   0DC4 26 00         mvi h, 0
2366   0DC6 EB            xchg
2367   0DC7 2A A0 31      lhld fs_findfirst_1
2368   0DCA 19            dad d
2369   0DCB AF            xra a
2370   0DCC B6            ora m
2371   0DCD CA E3 0D      jz l143
2372   0DD0             ;199 if(path[i]=='/')
2373   0DD0 68            mov l, b
2374   0DD1 26 00         mvi h, 0
2375   0DD3 EB            xchg
2376   0DD4 2A A0 31      lhld fs_findfirst_1
2377   0DD7 19            dad d
2378   0DD8 7E            mov a, m
2379   0DD9 FE 2F         cpi 47
2380   0DDB C2 DF 0D      jnz l28242
2381   0DDE             ;200 xx++;
2382   0DDE 0C            inr c
2383   0DDF             l28242:
2384   0DDF             l144:
2385   0DDF 04            inr b
2386   0DE0 C3 C3 0D      jmp l145
2387   0DE3             l143:
2388   0DE3             ;202 if(xx<4)
2389   0DE3 79            mov a, c
2390   0DE4 FE 04         cpi 4
2391   0DE6 D2 71 0E      jnc l28269
2392   0DE9             ;203 for(i=4; i; --i) {
2393   0DE9 06 04         mvi b, 4
2394   0DEB             l149:
2395   0DEB             ;203 {
2396   0DEB 2A A2 31      lhld fs_findfirst_2
2397   0DEE 22 9A 31      shld memcpy_1
2398   0DF1 21 99 2B      lxi h, str59
2399   0DF4 22 9C 31      shld memcpy_2
2400   0DF7 21 0B 00      lxi h, 11
2401   0DFA CD 93 0D      call memcpy
2402   0DFD             ;205 i2s(dest[0].fname+6, i, 2, '0');
2403   0DFD 2A A2 31      lhld fs_findfirst_2
2404   0E00 11 06 00      lxi d, 6
2405   0E03 19            dad d
2406   0E04 22 FD 33      shld i2s_1
2407   0E07 68            mov l, b
2408   0E08 26 00         mvi h, 0
2409   0E0A 22 FF 33      shld i2s_2
2410   0E0D 21 02 00      lxi h, 2
2411   0E10 22 01 34      shld i2s_3
2412   0E13 3E 30         mvi a, 48
2413   0E15 CD 14 1F      call i2s
2414   0E18             ;206 memcpy(dest[0].fname+8, "   ", 3);
2415   0E18 2A A2 31      lhld fs_findfirst_2
2416   0E1B 11 08 00      lxi d, 8
2417   0E1E 19            dad d
2418   0E1F 22 9A 31      shld memcpy_1
2419   0E22 21 70 2A      lxi h, str60
2420   0E25 22 9C 31      shld memcpy_2
2421   0E28 21 03 00      lxi h, 3
2422   0E2B CD 93 0D      call memcpy
2423   0E2E             ;207 dest[0].fattrib = 0x10;
2424   0E2E 2A A2 31      lhld fs_findfirst_2
2425   0E31 11 0B 00      lxi d, 11
2426   0E34 19            dad d
2427   0E35 36 10         mvi m, 16
2428   0E37             ;208 dest[0].fsize_l = i;
2429   0E37 23            inx h
2430   0E38 EB            xchg
2431   0E39 68            mov l, b
2432   0E3A 26 00         mvi h, 0
2433   0E3C EB            xchg
2434   0E3D 73            mov m, e
2435   0E3E 23            inx h
2436   0E3F 72            mov m, d
2437   0E40             ;209 dest[0].fdate = i;
2438   0E40 68            mov l, b
2439   0E41 26 00         mvi h, 0
2440   0E43 E5            push h
2441   0E44 2A A2 31      lhld fs_findfirst_2
2442   0E47 11 12 00      lxi d, 18
2443   0E4A 19            dad d
2444   0E4B D1            pop d
2445   0E4C 73            mov m, e
2446   0E4D 23            inx h
2447   0E4E 72            mov m, d
2448   0E4F             ;210 dest[0].ftime = i;
2449   0E4F 2B            dcx h
2450   0E50 2B            dcx h
2451   0E51 2B            dcx h
2452   0E52 EB            xchg
2453   0E53 68            mov l, b
2454   0E54 26 00         mvi h, 0
2455   0E56 EB            xchg
2456   0E57 73            mov m, e
2457   0E58 23            inx h
2458   0E59 72            mov m, d
2459   0E5A             ;211 dest++;
2460   0E5A 2A A2 31      lhld fs_findfirst_2
2461   0E5D 11 14 00      lxi d, 20
2462   0E60 19            dad d
2463   0E61             ;212 fs_low++;
2464   0E61 22 A2 31      shld fs_findfirst_2
2465   0E64 2A 0D 31      lhld fs_low
2466   0E67 23            inx h
2467   0E68 22 0D 31      shld fs_low
2468   0E6B             l148:
2469   0E6B 05            dcr b
2470   0E6C AF            xra a
2471   0E6D B8            cmp b
2472   0E6E C2 EB 0D      jnz l149
2473   0E71             l28269:
2474   0E71             ;215 for(i=rand()&31; i; --i) {
2475   0E71 CD 78 1F      call rand
2476   0E74 E6 1F         ani 31
2477   0E76 47            mov b, a
2478   0E77             l153:
2479   0E77 AF            xra a
2480   0E78 B8            cmp b
2481   0E79 CA 1C 0F      jz l151
2482   0E7C             ;215 {
2483   0E7C 2A A2 31      lhld fs_findfirst_2
2484   0E7F 22 9A 31      shld memcpy_1
2485   0E82 21 8D 2B      lxi h, str61
2486   0E85 22 9C 31      shld memcpy_2
2487   0E88 21 0B 00      lxi h, 11
2488   0E8B CD 93 0D      call memcpy
2489   0E8E             ;217 i2s(dest[0].fname+4, i, 2, '0');
2490   0E8E 2A A2 31      lhld fs_findfirst_2
2491   0E91 11 04 00      lxi d, 4
2492   0E94 19            dad d
2493   0E95 22 FD 33      shld i2s_1
2494   0E98 68            mov l, b
2495   0E99 26 00         mvi h, 0
2496   0E9B 22 FF 33      shld i2s_2
2497   0E9E 21 02 00      lxi h, 2
2498   0EA1 22 01 34      shld i2s_3
2499   0EA4 3E 30         mvi a, 48
2500   0EA6 CD 14 1F      call i2s
2501   0EA9             ;218 i2s(dest[0].fname+6, xx, 2, '0');
2502   0EA9 2A A2 31      lhld fs_findfirst_2
2503   0EAC 11 06 00      lxi d, 6
2504   0EAF 19            dad d
2505   0EB0 22 FD 33      shld i2s_1
2506   0EB3 69            mov l, c
2507   0EB4 26 00         mvi h, 0
2508   0EB6 22 FF 33      shld i2s_2
2509   0EB9 21 02 00      lxi h, 2
2510   0EBC 22 01 34      shld i2s_3
2511   0EBF 3E 30         mvi a, 48
2512   0EC1 CD 14 1F      call i2s
2513   0EC4             ;219 memcpy(dest[0].fname+8, "TXT", 3);
2514   0EC4 2A A2 31      lhld fs_findfirst_2
2515   0EC7 11 08 00      lxi d, 8
2516   0ECA 19            dad d
2517   0ECB 22 9A 31      shld memcpy_1
2518   0ECE 21 C0 2B      lxi h, str62
2519   0ED1 22 9C 31      shld memcpy_2
2520   0ED4 21 03 00      lxi h, 3
2521   0ED7 CD 93 0D      call memcpy
2522   0EDA             ;220 xx++;
2523   0EDA 0C            inr c
2524   0EDB             ;221 dest[0].fattrib = 0;
2525   0EDB 2A A2 31      lhld fs_findfirst_2
2526   0EDE 11 0B 00      lxi d, 11
2527   0EE1 19            dad d
2528   0EE2 36 00         mvi m, 0
2529   0EE4             ;222 dest[0].fsize_l = i;
2530   0EE4 23            inx h
2531   0EE5 EB            xchg
2532   0EE6 68            mov l, b
2533   0EE7 26 00         mvi h, 0
2534   0EE9 EB            xchg
2535   0EEA 73            mov m, e
2536   0EEB 23            inx h
2537   0EEC 72            mov m, d
2538   0EED             ;223 dest[0].fdate = i;
2539   0EED 68            mov l, b
2540   0EEE 26 00         mvi h, 0
2541   0EF0 E5            push h
2542   0EF1 2A A2 31      lhld fs_findfirst_2
2543   0EF4 11 12 00      lxi d, 18
2544   0EF7 19            dad d
2545   0EF8 D1            pop d
2546   0EF9 73            mov m, e
2547   0EFA 23            inx h
2548   0EFB 72            mov m, d
2549   0EFC             ;224 dest[0].ftime = i;
2550   0EFC 2B            dcx h
2551   0EFD 2B            dcx h
2552   0EFE 2B            dcx h
2553   0EFF EB            xchg
2554   0F00 68            mov l, b
2555   0F01 26 00         mvi h, 0
2556   0F03 EB            xchg
2557   0F04 73            mov m, e
2558   0F05 23            inx h
2559   0F06 72            mov m, d
2560   0F07             ;225 dest++;
2561   0F07 2A A2 31      lhld fs_findfirst_2
2562   0F0A 11 14 00      lxi d, 20
2563   0F0D 19            dad d
2564   0F0E             ;226 fs_low++;
2565   0F0E 22 A2 31      shld fs_findfirst_2
2566   0F11 2A 0D 31      lhld fs_low
2567   0F14 23            inx h
2568   0F15 22 0D 31      shld fs_low
2569   0F18             l152:
2570   0F18 05            dcr b
2571   0F19 C3 77 0E      jmp l153
2572   0F1C             l151:
2573   0F1C             ;228 return 0;
2574   0F1C AF            xra a
2575   0F1D C1            pop b
2576   0F1E C9            ret
2577   0F1F             ; --------------------------------------------------------------
2578   0F1F             sort:
2579   0F1F C5            push b
2580   0F20             ;329 FileInfo *st_[SORT_STACK_MAX*2], **st = st_;
2581   0F20 22 AA 31      shld sort_2
2582   0F23 21 B2 31      lxi h, sort_st_
2583   0F26             ;330 uchar stc = 0;
2584   0F26 AF            xra a
2585   0F27             ;331 while(1) {
2586   0F27 32 34 32      sta sort_stc
2587   0F2A 22 32 32      shld sort_st
2588   0F2D             l31:
2589   0F2D             ;331 {
2590   0F2D 2A A8 31      lhld sort_1
2591   0F30             ;333 j = high;
2592   0F30 22 AC 31      shld sort_i
2593   0F33 2A AA 31      lhld sort_2
2594   0F36             ;334 x = low + (high-low)/2;
2595   0F36 44            mov b, h
2596   0F37 4D            mov c, l
2597   0F38 2A A8 31      lhld sort_1
2598   0F3B EB            xchg
2599   0F3C 2A AA 31      lhld sort_2
2600   0F3F CD 40 2A      call op_sub16_swap
2601   0F42 11 14 00      lxi d, 20
2602   0F45 CD FC 29      call op_div16_swap
2603   0F48 11 02 00      lxi d, 2
2604   0F4B CD FC 29      call op_div16_swap
2605   0F4E 54            mov d, h
2606   0F4F 5D            mov e, l
2607   0F50 29            dad h
2608   0F51 29            dad h
2609   0F52 19            dad d
2610   0F53 29            dad h
2611   0F54 29            dad h
2612   0F55 EB            xchg
2613   0F56 2A A8 31      lhld sort_1
2614   0F59 19            dad d
2615   0F5A             ;335 while(1) {
2616   0F5A 22 B0 31      shld sort_x
2617   0F5D             l33:
2618   0F5D             ;335 {
2619   0F5D             l35:
2620   0F5D 2A B0 31      lhld sort_x
2621   0F60 22 04 34      shld cmpFileInfo_1
2622   0F63 2A AC 31      lhld sort_i
2623   0F66 CD 84 1F      call cmpFileInfo
2624   0F69 B7            ora a
2625   0F6A CA 7A 0F      jz l34
2626   0F6D             ;336 i++;
2627   0F6D 2A AC 31      lhld sort_i
2628   0F70 11 14 00      lxi d, 20
2629   0F73 19            dad d
2630   0F74 22 AC 31      shld sort_i
2631   0F77 C3 5D 0F      jmp l35
2632   0F7A             l34:
2633   0F7A             ;337 while(0!=cmpFileInfo(j, x)) j--;
2634   0F7A             l37:
2635   0F7A 60            mov h, b
2636   0F7B 69            mov l, c
2637   0F7C 22 04 34      shld cmpFileInfo_1
2638   0F7F 2A B0 31      lhld sort_x
2639   0F82 CD 84 1F      call cmpFileInfo
2640   0F85 B7            ora a
2641   0F86 CA 92 0F      jz l36
2642   0F89             ;337 j--;
2643   0F89 21 EC FF      lxi h, 65516
2644   0F8C 09            dad b
2645   0F8D 44            mov b, h
2646   0F8E 4D            mov c, l
2647   0F8F C3 7A 0F      jmp l37
2648   0F92             l36:
2649   0F92             ;338 if(i <= j) {
2650   0F92 60            mov h, b
2651   0F93 69            mov l, c
2652   0F94 EB            xchg
2653   0F95 2A AC 31      lhld sort_i
2654   0F98 CD CD 29      call op_cmp16
2655   0F9B CA A1 0F      jz $+6
2656   0F9E D2 E6 0F      jnc l28278
2657   0FA1             ;338 {
2658   0FA1 22 F5 33      shld memswap_1
2659   0FA4 60            mov h, b
2660   0FA5 69            mov l, c
2661   0FA6 22 F7 33      shld memswap_2
2662   0FA9 21 14 00      lxi h, 20
2663   0FAC CD DD 1E      call memswap
2664   0FAF             ;340 if(x==i) x=j; else if(x==j) x=i;
2665   0FAF 2A AC 31      lhld sort_i
2666   0FB2 EB            xchg
2667   0FB3 2A B0 31      lhld sort_x
2668   0FB6 CD CD 29      call op_cmp16
2669   0FB9 C2 C4 0F      jnz l28286
2670   0FBC             ;340 x=j; else if(x==j) x=i;
2671   0FBC 60            mov h, b
2672   0FBD 69            mov l, c
2673   0FBE 22 B0 31      shld sort_x
2674   0FC1 C3 D6 0F      jmp l28301
2675   0FC4             l28286:
2676   0FC4             ;340 if(x==j) x=i;
2677   0FC4 60            mov h, b
2678   0FC5 69            mov l, c
2679   0FC6 EB            xchg
2680   0FC7 2A B0 31      lhld sort_x
2681   0FCA CD CD 29      call op_cmp16
2682   0FCD C2 D3 0F      jnz l28302
2683   0FD0             ;340 x=i;
2684   0FD0 2A AC 31      lhld sort_i
2685   0FD3             l28302:
2686   0FD3 22 B0 31      shld sort_x
2687   0FD6             ; label1
2688   0FD6             l28301:
2689   0FD6             ;341 i++; j--;   
2690   0FD6 2A AC 31      lhld sort_i
2691   0FD9 11 14 00      lxi d, 20
2692   0FDC 19            dad d
2693   0FDD             ;341 j--;   
2694   0FDD 22 AC 31      shld sort_i
2695   0FE0 21 EC FF      lxi h, 65516
2696   0FE3 09            dad b
2697   0FE4 44            mov b, h
2698   0FE5 4D            mov c, l
2699   0FE6             l28278:
2700   0FE6             ;343 if(j<=i) break;
2701   0FE6 60            mov h, b
2702   0FE7 69            mov l, c
2703   0FE8 EB            xchg
2704   0FE9 2A AC 31      lhld sort_i
2705   0FEC CD CD 29      call op_cmp16
2706   0FEF DA F5 0F      jc l28311
2707   0FF2             ;343 break;
2708   0FF2 C3 F8 0F      jmp l32
2709   0FF5             l28311:
2710   0FF5 C3 5D 0F      jmp l33
2711   0FF8             l32:
2712   0FF8             ;345 if(i < high) {
2713   0FF8 2A AA 31      lhld sort_2
2714   0FFB EB            xchg
2715   0FFC 2A AC 31      lhld sort_i
2716   0FFF CD CD 29      call op_cmp16
2717   1002 D2 42 10      jnc l28320
2718   1005             ;345 {
2719   1005 60            mov h, b
2720   1006 69            mov l, c
2721   1007 EB            xchg
2722   1008 2A A8 31      lhld sort_1
2723   100B CD CD 29      call op_cmp16
2724   100E D2 39 10      jnc l28376
2725   1011             ;346 if(stc != SORT_STACK_MAX) *st = low, ++st, *st = j, ++st, ++stc;
2726   1011 3A 34 32      lda sort_stc
2727   1014 FE 20         cpi 32
2728   1016 CA 36 10      jz l28385
2729   1019             ;346 *st = low, ++st, *st = j, ++st, ++stc;
2730   1019 EB            xchg
2731   101A 2A 32 32      lhld sort_st
2732   101D 73            mov m, e
2733   101E 23            inx h
2734   101F 72            mov m, d
2735   1020 2B            dcx h
2736   1021 23            inx h
2737   1022 23            inx h
2738   1023 22 32 32      shld sort_st
2739   1026 EB            xchg
2740   1027 60            mov h, b
2741   1028 69            mov l, c
2742   1029 EB            xchg
2743   102A 73            mov m, e
2744   102B 23            inx h
2745   102C 72            mov m, d
2746   102D 2A 32 32      lhld sort_st
2747   1030 3C            inr a
2748   1031 23            inx h
2749   1032 23            inx h
2750   1033 22 32 32      shld sort_st
2751   1036             l28385:
2752   1036 32 34 32      sta sort_stc
2753   1039             l28376:
2754   1039             ;347 low = i; 
2755   1039 2A AC 31      lhld sort_i
2756   103C             ;348 continue;
2757   103C 22 A8 31      shld sort_1
2758   103F C3 2D 0F      jmp l31
2759   1042             l28320:
2760   1042             ;350 if(low < j) { 
2761   1042 EB            xchg
2762   1043 60            mov h, b
2763   1044 69            mov l, c
2764   1045 CD CD 29      call op_cmp16
2765   1048 CA 54 10      jz l28386
2766   104B DA 54 10      jc l28386
2767   104E             ;350 { 
2768   104E             ;352 continue; 
2769   104E 22 AA 31      shld sort_2
2770   1051 C3 2D 0F      jmp l31
2771   1054             l28386:
2772   1054             ;354 if(stc==0) break;
2773   1054 3A 34 32      lda sort_stc
2774   1057 B7            ora a
2775   1058 C2 5E 10      jnz l28387
2776   105B             ;354 break;
2777   105B C3 83 10      jmp l30
2778   105E             l28387:
2779   105E             ;355 --stc, --st, high = *st, --st, low = *st; 
2780   105E 3D            dcr a
2781   105F 2A 32 32      lhld sort_st
2782   1062 2B            dcx h
2783   1063 2B            dcx h
2784   1064 22 32 32      shld sort_st
2785   1067 32 34 32      sta sort_stc
2786   106A 7E            mov a, m
2787   106B 23            inx h
2788   106C 66            mov h, m
2789   106D 6F            mov l, a
2790   106E 22 AA 31      shld sort_2
2791   1071 2A 32 32      lhld sort_st
2792   1074 2B            dcx h
2793   1075 2B            dcx h
2794   1076 22 32 32      shld sort_st
2795   1079 7E            mov a, m
2796   107A 23            inx h
2797   107B 66            mov h, m
2798   107C 6F            mov l, a
2799   107D 22 A8 31      shld sort_1
2800   1080 C3 2D 0F      jmp l31
2801   1083             l30:
2802   1083 C1            pop b
2803   1084 C9            ret
2804   1085             ; --------------------------------------------------------------
2805   1085             getSel:
2806   1085 C5            push b
2807   1086             ;125 uint n = panelA.offset+panelA.cursorY+panelA.cursorX*rowsCnt;
2808   1086 2A D7 30      lhld rowsCnt
2809   1089 26 00         mvi h, 0
2810   108B EB            xchg
2811   108C 2A C3 2E      lhld (panelA)+(258)
2812   108F 26 00         mvi h, 0
2813   1091 CD D3 29      call op_mul16
2814   1094 E5            push h
2815   1095 2A C4 2E      lhld (panelA)+(259)
2816   1098 26 00         mvi h, 0
2817   109A EB            xchg
2818   109B 2A C5 2E      lhld (panelA)+(260)
2819   109E 19            dad d
2820   109F D1            pop d
2821   10A0 19            dad d
2822   10A1             ;126 if(n < panelA.cnt) return panelA.files1 + n;
2823   10A1 44            mov b, h
2824   10A2 4D            mov c, l
2825   10A3 2A C7 2E      lhld (panelA)+(262)
2826   10A6 EB            xchg
2827   10A7 60            mov h, b
2828   10A8 69            mov l, c
2829   10A9 CD CD 29      call op_cmp16
2830   10AC D2 BD 10      jnc l28414
2831   10AF             ;126 return panelA.files1 + n;
2832   10AF 54            mov d, h
2833   10B0 5D            mov e, l
2834   10B1 29            dad h
2835   10B2 29            dad h
2836   10B3 19            dad d
2837   10B4 29            dad h
2838   10B5 29            dad h
2839   10B6 EB            xchg
2840   10B7 2A C1 2D      lhld panelA
2841   10BA 19            dad d
2842   10BB C1            pop b
2843   10BC C9            ret
2844   10BD             l28414:
2845   10BD             ;127 panelA.offset = 0;
2846   10BD 21 00 00      lxi h, 0
2847   10C0             ;128 panelA.cursorY = 0;
2848   10C0 AF            xra a
2849   10C1             ;129 panelA.cursorX = 0;
2850   10C1 32 C4 2E      sta (panelA)+(259)
2851   10C4             ;130 if(panelA.cnt != 0) return panelA.files1;
2852   10C4 22 C5 2E      shld (panelA)+(260)
2853   10C7 2A C7 2E      lhld (panelA)+(262)
2854   10CA 32 C3 2E      sta (panelA)+(258)
2855   10CD 7C            mov a, h
2856   10CE B5            ora l
2857   10CF CA D7 10      jz l28415
2858   10D2             ;130 return panelA.files1;
2859   10D2 2A C1 2D      lhld panelA
2860   10D5 C1            pop b
2861   10D6 C9            ret
2862   10D7             l28415:
2863   10D7             ;131 return (FileInfo*)parentDir;
2864   10D7 21 D8 30      lxi h, parentDir
2865   10DA C1            pop b
2866   10DB C9            ret
2867   10DC             ; --------------------------------------------------------------
2868   10DC             memcmp:
2869   10DC             ;2 asm {
2870   10DC 22 3B 32      shld memcmp_3
2871   10DF                 ; if(len==0) return 0;
2872   10DF 7D              mov a, l
2873   10E0 B4              ora h
2874   10E1 C8              rz
2875   10E2 C5              push b
2876   10E3                 ; de = len
2877   10E3 EB              xchg
2878   10E4                 ; bc = d
2879   10E4 2A 37 32        lhld memcmp_1
2880   10E7 44              mov b, h
2881   10E8 4D              mov c, l
2882   10E9                 ; hl = s
2883   10E9 2A 39 32        lhld memcmp_2
2884   10EC                 ; loop
2885   10EC             memcmp_l1:
2886   10EC 0A                ldax b
2887   10ED BE                cmp m
2888   10EE C2 FB 10          jnz memcmp_stop
2889   10F1 23                inx h
2890   10F2 03                inx b
2891   10F3 1B                dcx d
2892   10F4 7A                mov a, d
2893   10F5 B3                ora e
2894   10F6 C2 EC 10        jnz memcmp_l1
2895   10F9 C1              pop b
2896   10FA                 ; a=0
2897   10FA C9              ret
2898   10FB             memcmp_stop:
2899   10FB C1              pop b
2900   10FC 9F              sbb a
2901   10FD D8              rc
2902   10FE 3C              inr a
2903   10FF C9              ret
2904   1100               
2905   1100 C9            ret
2906   1101             ; --------------------------------------------------------------
2907   1101             drawFiles:
2908   1101             ;30 hideFileCursor();
2909   1101 CD 7F 16      call hideFileCursor
2910   1104             ;31 drawColumn(0);
2911   1104 AF            xra a
2912   1105 CD CF 1F      call drawColumn
2913   1108             ;32 drawColumn(1);
2914   1108 3E 01         mvi a, 1
2915   110A CD CF 1F      call drawColumn
2916   110D C9            ret
2917   110E             ; --------------------------------------------------------------
2918   110E             drawFilesCount:
2919   110E C5            push b
2920   110F             ;1 { ((ushort*)a)[0] = (b&0xFFFF); ((ushort*)a)[1] = (b>>16); }
2921   110F 21 00 00      lxi h, 0
2922   1112             ;1 ((ushort*)a)[1] = (b>>16); }
2923   1112 22 3D 32      shld drawFilesCount_total
2924   1115             ;43 filesCnt = 0;
2925   1115 22 3F 32      shld (drawFilesCount_total)+(2)
2926   1118             ;44 for(p = panelA.files1, i = panelA.cnt; i; ++p, --i) {
2927   1118 22 43 32      shld drawFilesCount_filesCnt
2928   111B 2A C1 2D      lhld panelA
2929   111E 44            mov b, h
2930   111F 4D            mov c, l
2931   1120 2A C7 2E      lhld (panelA)+(262)
2932   1123 22 41 32      shld drawFilesCount_i
2933   1126             l2:
2934   1126 2A 41 32      lhld drawFilesCount_i
2935   1129 7C            mov a, h
2936   112A B5            ora l
2937   112B CA 5C 11      jz l0
2938   112E             ;44 {
2939   112E 21 0B 00      lxi h, 11
2940   1131 09            dad b
2941   1132 7E            mov a, m
2942   1133 E6 10         ani 16
2943   1135 C2 3F 11      jnz l28418
2944   1138             ;45 ++filesCnt;
2945   1138 2A 43 32      lhld drawFilesCount_filesCnt
2946   113B 23            inx h
2947   113C 22 43 32      shld drawFilesCount_filesCnt
2948   113F             l28418:
2949   113F             ;46 add32_32(&total, &p->fsize);
2950   113F 21 3D 32      lxi h, drawFilesCount_total
2951   1142 22 12 34      shld add32_32_1
2952   1145 21 0C 00      lxi h, 12
2953   1148 09            dad b
2954   1149 CD 6D 20      call add32_32
2955   114C             l1:
2956   114C 21 14 00      lxi h, 20
2957   114F 09            dad b
2958   1150 44            mov b, h
2959   1151 4D            mov c, l
2960   1152 2A 41 32      lhld drawFilesCount_i
2961   1155 2B            dcx h
2962   1156 22 41 32      shld drawFilesCount_i
2963   1159 C3 26 11      jmp l2
2964   115C             l0:
2965   115C             ;49 drawFilesCountInt(&total, filesCnt);
2966   115C 21 3D 32      lxi h, drawFilesCount_total
2967   115F 22 16 34      shld drawFilesCountInt_1
2968   1162 2A 43 32      lhld drawFilesCount_filesCnt
2969   1165 CD 88 20      call drawFilesCountInt
2970   1168 C1            pop b
2971   1169 C9            ret
2972   116A             ; --------------------------------------------------------------
2973   116A             drawFileInfo:
2974   116A C5            push b
2975   116B             ;73 f = getSel();
2976   116B CD 85 10      call getSel
2977   116E             ;75 if(f->fattrib & 0x10) {
2978   116E 44            mov b, h
2979   116F 4D            mov c, l
2980   1170 21 0B 00      lxi h, 11
2981   1173 09            dad b
2982   1174 7E            mov a, m
2983   1175 E6 10         ani 16
2984   1177 CA 80 11      jz l28419
2985   117A             ;75 {
2986   117A CD 6D 21      call drawFileInfoDir
2987   117D C3 9E 11      jmp l28481
2988   1180             l28419:
2989   1180             ;77 {
2990   1180 21 49 32      lxi h, drawFileInfo_buf
2991   1183 22 29 34      shld i2s32_1
2992   1186 21 0C 00      lxi h, 12
2993   1189 09            dad b
2994   118A 22 2B 34      shld i2s32_2
2995   118D 21 0A 00      lxi h, 10
2996   1190 22 2D 34      shld i2s32_3
2997   1193 3E 20         mvi a, 32
2998   1195 CD 74 21      call i2s32
2999   1198             ;79 drawFileInfo1(buf);
3000   1198 21 49 32      lxi h, drawFileInfo_buf
3001   119B CD EC 21      call drawFileInfo1
3002   119E             ; label1
3003   119E             l28481:
3004   119E             ;82 if(f->fdate==0 && f->ftime==0) {
3005   119E 21 12 00      lxi h, 18
3006   11A1 09            dad b
3007   11A2 7E            mov a, m
3008   11A3 23            inx h
3009   11A4 66            mov h, m
3010   11A5 6F            mov l, a
3011   11A6 7C            mov a, h
3012   11A7 B5            ora l
3013   11A8 C2 BF 11      jnz l28484
3014   11AB 21 10 00      lxi h, 16
3015   11AE 09            dad b
3016   11AF 7E            mov a, m
3017   11B0 23            inx h
3018   11B1 66            mov h, m
3019   11B2 6F            mov l, a
3020   11B3 7C            mov a, h
3021   11B4 B5            ora l
3022   11B5 C2 BF 11      jnz l28484
3023   11B8             ;82 {
3024   11B8 AF            xra a
3025   11B9 32 49 32      sta drawFileInfo_buf
3026   11BC C3 8D 12      jmp l28646
3027   11BF             l28484:
3028   11BF             ;84 {
3029   11BF 21 49 32      lxi h, drawFileInfo_buf
3030   11C2 22 FD 33      shld i2s_1
3031   11C5 21 12 00      lxi h, 18
3032   11C8 09            dad b
3033   11C9 7E            mov a, m
3034   11CA 23            inx h
3035   11CB 66            mov h, m
3036   11CC 6F            mov l, a
3037   11CD 11 1F 00      lxi d, 31
3038   11D0 CD 55 2A      call op_and16
3039   11D3 22 FF 33      shld i2s_2
3040   11D6 21 02 00      lxi h, 2
3041   11D9 22 01 34      shld i2s_3
3042   11DC 3E 20         mvi a, 32
3043   11DE CD 14 1F      call i2s
3044   11E1             ;86 buf[2] = '-';
3045   11E1 3E 2D         mvi a, 45
3046   11E3             ;87 i2s(buf+3, (f->fdate>>5) & 15, 2, '0');
3047   11E3 21 4C 32      lxi h, (drawFileInfo_buf)+(3)
3048   11E6 22 FD 33      shld i2s_1
3049   11E9 21 12 00      lxi h, 18
3050   11EC 09            dad b
3051   11ED 32 4B 32      sta (drawFileInfo_buf)+(2)
3052   11F0 7E            mov a, m
3053   11F1 23            inx h
3054   11F2 66            mov h, m
3055   11F3 6F            mov l, a
3056   11F4 11 05 00      lxi d, 5
3057   11F7 CD 48 2A      call op_shr16_swap
3058   11FA 11 0F 00      lxi d, 15
3059   11FD CD 55 2A      call op_and16
3060   1200 22 FF 33      shld i2s_2
3061   1203 21 02 00      lxi h, 2
3062   1206 22 01 34      shld i2s_3
3063   1209 3E 30         mvi a, 48
3064   120B CD 14 1F      call i2s
3065   120E             ;88 buf[5] = '-';
3066   120E 3E 2D         mvi a, 45
3067   1210             ;89 i2s(buf+6, (f->fdate>>9)+1980, 4, '0');
3068   1210 21 4F 32      lxi h, (drawFileInfo_buf)+(6)
3069   1213 22 FD 33      shld i2s_1
3070   1216 21 12 00      lxi h, 18
3071   1219 09            dad b
3072   121A 32 4E 32      sta (drawFileInfo_buf)+(5)
3073   121D 7E            mov a, m
3074   121E 23            inx h
3075   121F 66            mov h, m
3076   1220 6F            mov l, a
3077   1221 11 09 00      lxi d, 9
3078   1224 CD 48 2A      call op_shr16_swap
3079   1227 11 B7 07      lxi d, 1975
3080   122A 19            dad d
3081   122B 22 FF 33      shld i2s_2
3082   122E 21 04 00      lxi h, 4
3083   1231 22 01 34      shld i2s_3
3084   1234 3E 30         mvi a, 48
3085   1236 CD 14 1F      call i2s
3086   1239             ;90 buf[10] = ' ';
3087   1239 3E 20         mvi a, 32
3088   123B             ;91 i2s(buf+11, f->ftime>>11, 2, '0');
3089   123B 21 54 32      lxi h, (drawFileInfo_buf)+(11)
3090   123E 22 FD 33      shld i2s_1
3091   1241 21 10 00      lxi h, 16
3092   1244 09            dad b
3093   1245 32 53 32      sta (drawFileInfo_buf)+(10)
3094   1248 7E            mov a, m
3095   1249 23            inx h
3096   124A 66            mov h, m
3097   124B 6F            mov l, a
3098   124C 11 0B 00      lxi d, 11
3099   124F CD 48 2A      call op_shr16_swap
3100   1252 22 FF 33      shld i2s_2
3101   1255 21 02 00      lxi h, 2
3102   1258 22 01 34      shld i2s_3
3103   125B 3E 30         mvi a, 48
3104   125D CD 14 1F      call i2s
3105   1260             ;92 buf[13] = ':';
3106   1260 3E 3A         mvi a, 58
3107   1262             ;93 i2s(buf+14, (f->ftime>>5)&63, 2, '0');
3108   1262 21 57 32      lxi h, (drawFileInfo_buf)+(14)
3109   1265 22 FD 33      shld i2s_1
3110   1268 21 10 00      lxi h, 16
3111   126B 09            dad b
3112   126C 32 56 32      sta (drawFileInfo_buf)+(13)
3113   126F 7E            mov a, m
3114   1270 23            inx h
3115   1271 66            mov h, m
3116   1272 6F            mov l, a
3117   1273 11 05 00      lxi d, 5
3118   1276 CD 48 2A      call op_shr16_swap
3119   1279 11 3F 00      lxi d, 63
3120   127C CD 55 2A      call op_and16
3121   127F 22 FF 33      shld i2s_2
3122   1282 21 02 00      lxi h, 2
3123   1285 22 01 34      shld i2s_3
3124   1288 3E 30         mvi a, 48
3125   128A CD 14 1F      call i2s
3126   128D             ; label1
3127   128D             l28646:
3128   128D             ;95 drawFileInfo2(buf);
3129   128D 21 49 32      lxi h, drawFileInfo_buf
3130   1290 CD 0D 22      call drawFileInfo2
3131   1293 C1            pop b
3132   1294 C9            ret
3133   1295             ; --------------------------------------------------------------
3134   1295             showFileCursorAndDrawFileInfo:
3135   1295             ;102 showFileCursor();
3136   1295 CD BE 16      call showFileCursor
3137   1298             ;103 drawFileInfo();  
3138   1298 CD 6A 11      call drawFileInfo
3139   129B C9            ret
3140   129C             ; --------------------------------------------------------------
3141   129C             drawWindow:
3142   129C             ;250 fs_hideCursor();
3143   129C 22 5B 32      shld drawWindow_1
3144   129F CD 8A 0D      call fs_hideCursor
3145   12A2             ;251 drawRect(windowX, windowY, 32, 9, 1);
3146   12A2 3A F7 30      lda windowX
3147   12A5 32 EB 33      sta drawRect_1
3148   12A8 3A F8 30      lda windowY
3149   12AB 32 EC 33      sta drawRect_2
3150   12AE 3E 09         mvi a, 9
3151   12B0 32 EE 33      sta drawRect_4
3152   12B3 3E 20         mvi a, 32
3153   12B5 32 ED 33      sta drawRect_3
3154   12B8 3E 01         mvi a, 1
3155   12BA CD C3 1C      call drawRect
3156   12BD             ;252 drawWindowTextCenter(-2, title);
3157   12BD 3E FE         mvi a, 254
3158   12BF 32 38 34      sta drawWindowTextCenter_1
3159   12C2 2A 5B 32      lhld drawWindow_1
3160   12C5 CD 2D 22      call drawWindowTextCenter
3161   12C8 C9            ret
3162   12C9             ; --------------------------------------------------------------
3163   12C9             drawWindowText:
3164   12C9             ;259 fs_print(windowX+ox+2, windowY+oy+2, 28-ox, text, 0);
3165   12C9 22 60 32      shld drawWindowText_3
3166   12CC 2A 5E 32      lhld drawWindowText_1
3167   12CF 26 00         mvi h, 0
3168   12D1 EB            xchg
3169   12D2 2A F7 30      lhld windowX
3170   12D5 26 00         mvi h, 0
3171   12D7 19            dad d
3172   12D8 23            inx h
3173   12D9 23            inx h
3174   12DA 7D            mov a, l
3175   12DB 32 7C 31      sta fs_print_1
3176   12DE 2A 5F 32      lhld drawWindowText_2
3177   12E1 26 00         mvi h, 0
3178   12E3 EB            xchg
3179   12E4 2A F8 30      lhld windowY
3180   12E7 26 00         mvi h, 0
3181   12E9 19            dad d
3182   12EA 23            inx h
3183   12EB 23            inx h
3184   12EC 7D            mov a, l
3185   12ED 32 7D 31      sta fs_print_2
3186   12F0 3A 5E 32      lda drawWindowText_1
3187   12F3 57            mov d, a
3188   12F4 3E 1C         mvi a, 28
3189   12F6 92            sub d
3190   12F7 32 7E 31      sta fs_print_3
3191   12FA 2A 60 32      lhld drawWindowText_3
3192   12FD 22 7F 31      shld fs_print_4
3193   1300 AF            xra a
3194   1301 CD FE 0A      call fs_print
3195   1304 C9            ret
3196   1305             ; --------------------------------------------------------------
3197   1305             fs_getfree:
3198   1305             ;305 fs_high = 100;
3199   1305 21 64 00      lxi h, 100
3200   1308             ;306 fs_low = 20;
3201   1308 22 0F 31      shld fs_high
3202   130B 21 14 00      lxi h, 20
3203   130E             ;307 return 0; 
3204   130E AF            xra a
3205   130F 22 0D 31      shld fs_low
3206   1312 C9            ret
3207   1313             ; --------------------------------------------------------------
3208   1313             drawError:
3209   1313             ;178 if(e == 0) return;
3210   1313 B7            ora a
3211   1314 32 64 32      sta drawError_2
3212   1317 C8            rz
3213   1318             ;178 return;
3214   1318             l28647:
3215   1318             ;181 drawWindow(" o{ibka ");
3216   1318 21 AB 2A      lxi h, str1
3217   131B CD 9C 12      call drawWindow
3218   131E             ;182 drawAnyKeyButton();
3219   131E CD 68 14      call drawAnyKeyButton
3220   1321             ;183 drawWindowText(0, 0, text);
3221   1321 AF            xra a
3222   1322 32 5E 32      sta drawWindowText_1
3223   1325 32 5F 32      sta drawWindowText_2
3224   1328 2A 62 32      lhld drawError_1
3225   132B CD C9 12      call drawWindowText
3226   132E             ;186 switch(e) {
3227   132E 3A 64 32      lda drawError_2
3228   1331 3D            dcr a
3229   1332 CA 5E 13      jz l5
3230   1335 3D            dcr a
3231   1336 CA 67 13      jz l6
3232   1339 3D            dcr a
3233   133A CA 79 13      jz l8
3234   133D 3D            dcr a
3235   133E CA 82 13      jz l9
3236   1341 3D            dcr a
3237   1342 CA 8B 13      jz l10
3238   1345 3D            dcr a
3239   1346 CA 94 13      jz l11
3240   1349 3D            dcr a
3241   134A CA 70 13      jz l7
3242   134D 3D            dcr a
3243   134E CA 9D 13      jz l12
3244   1351 D6 03         sui 3
3245   1353 CA AF 13      jz l14
3246   1356 D6 75         sui 117
3247   1358 CA A6 13      jz l13
3248   135B C3 B8 13      jmp l4
3249   135E             ;187 case ERR_NO_FILESYSTEM: text = "net fajlowoj sistemy"; break;
3250   135E             l5:
3251   135E             ;187 text = "net fajlowoj sistemy"; break;
3252   135E 21 75 2C      lxi h, str2
3253   1361             ;187 break;
3254   1361 22 62 32      shld drawError_1
3255   1364 C3 B8 13      jmp l4
3256   1367             ;188 case ERR_DISK_ERR: text = "o{ibka nakopitelq"; break;
3257   1367             l6:
3258   1367             ;188 text = "o{ibka nakopitelq"; break;
3259   1367 21 9D 2C      lxi h, str3
3260   136A             ;188 break;
3261   136A 22 62 32      shld drawError_1
3262   136D C3 B8 13      jmp l4
3263   1370             ;189 case ERR_DIR_NOT_EMPTY: text = "papka ne pusta"; break;
3264   1370             l7:
3265   1370             ;189 text = "papka ne pusta"; break;
3266   1370 21 F6 2C      lxi h, str4
3267   1373             ;189 break;
3268   1373 22 62 32      shld drawError_1
3269   1376 C3 B8 13      jmp l4
3270   1379             ;190 case ERR_NOT_OPENED: text = "fajl ne otkryt"; break;
3271   1379             l8:
3272   1379             ;190 text = "fajl ne otkryt"; break;
3273   1379 21 32 2C      lxi h, str5
3274   137C             ;190 break;
3275   137C 22 62 32      shld drawError_1
3276   137F C3 B8 13      jmp l4
3277   1382             ;191 case ERR_NO_PATH: text = "putx ne najden"; break;
3278   1382             l9:
3279   1382             ;191 text = "putx ne najden"; break;
3280   1382 21 41 2D      lxi h, str6
3281   1385             ;191 break;
3282   1385 22 62 32      shld drawError_1
3283   1388 C3 B8 13      jmp l4
3284   138B             ;192 case ERR_DIR_FULL: text = "maksimum fajlow w papke"; break;
3285   138B             l10:
3286   138B             ;192 text = "maksimum fajlow w papke"; break;
3287   138B 21 5D 2C      lxi h, str7
3288   138E             ;192 break;
3289   138E 22 62 32      shld drawError_1
3290   1391 C3 B8 13      jmp l4
3291   1394             ;193 case ERR_NO_FREE_SPACE: text = "disk zapolnen"; break;
3292   1394             l11:
3293   1394             ;193 text = "disk zapolnen"; break;
3294   1394 21 14 2C      lxi h, str8
3295   1397             ;193 break;
3296   1397 22 62 32      shld drawError_1
3297   139A C3 B8 13      jmp l4
3298   139D             ;194 case ERR_FILE_EXISTS: text = "fail su}estwuet"; break;
3299   139D             l12:
3300   139D             ;194 text = "fail su}estwuet"; break;
3301   139D 21 22 2C      lxi h, str9
3302   13A0             ;194 break;
3303   13A0 22 62 32      shld drawError_1
3304   13A3 C3 B8 13      jmp l4
3305   13A6             ;195 case ERR_USER: text = "prerwano polxzowatelem"; break;
3306   13A6             l13:
3307   13A6             ;195 text = "prerwano polxzowatelem"; break;
3308   13A6 21 05 2D      lxi h, str10
3309   13A9             ;195 break;
3310   13A9 22 62 32      shld drawError_1
3311   13AC C3 B8 13      jmp l4
3312   13AF             ;196 case ERR_RECV_STRING: text = "putx bolx{e 255 simwolow"; break;
3313   13AF             l14:
3314   13AF             ;196 text = "putx bolx{e 255 simwolow"; break;
3315   13AF 21 28 2D      lxi h, str11
3316   13B2             ;196 break;
3317   13B2 22 62 32      shld drawError_1
3318   13B5 C3 B8 13      jmp l4
3319   13B8             l4:
3320   13B8             ;201 drawWindowText(0, 2, text);
3321   13B8 AF            xra a
3322   13B9 32 5E 32      sta drawWindowText_1
3323   13BC 3E 02         mvi a, 2
3324   13BE 32 5F 32      sta drawWindowText_2
3325   13C1 2A 62 32      lhld drawError_1
3326   13C4 CD C9 12      call drawWindowText
3327   13C7             ;204 fs_bioskey(0);
3328   13C7 AF            xra a
3329   13C8 CD 98 05      call fs_bioskey
3330   13CB C9            ret
3331   13CC             ; --------------------------------------------------------------
3332   13CC             cmd_freespace_1:
3333   13CC             ;11 i2s32(buf, (ulong*)&fs_low, 10, ' ');
3334   13CC 22 6A 32      shld cmd_freespace_1_2
3335   13CF 21 6C 32      lxi h, cmd_freespace_1_buf
3336   13D2 22 29 34      shld i2s32_1
3337   13D5 21 0D 31      lxi h, fs_low
3338   13D8 22 2B 34      shld i2s32_2
3339   13DB 21 0A 00      lxi h, 10
3340   13DE 22 2D 34      shld i2s32_3
3341   13E1 3E 20         mvi a, 32
3342   13E3 CD 74 21      call i2s32
3343   13E6             ;14 memcpy_back(buf+10, buf+7, 3); buf[9]  = ' ';
3344   13E6 21 76 32      lxi h, (cmd_freespace_1_buf)+(10)
3345   13E9 22 3B 34      shld memcpy_back_1
3346   13EC 21 73 32      lxi h, (cmd_freespace_1_buf)+(7)
3347   13EF 22 3D 34      shld memcpy_back_2
3348   13F2 21 03 00      lxi h, 3
3349   13F5 CD 68 22      call memcpy_back
3350   13F8             ;14 buf[9]  = ' ';
3351   13F8 3E 20         mvi a, 32
3352   13FA             ;15 memcpy_back(buf+6,  buf+4, 3); buf[5]  = ' ';
3353   13FA 21 72 32      lxi h, (cmd_freespace_1_buf)+(6)
3354   13FD 22 3B 34      shld memcpy_back_1
3355   1400 21 70 32      lxi h, (cmd_freespace_1_buf)+(4)
3356   1403 22 3D 34      shld memcpy_back_2
3357   1406 21 03 00      lxi h, 3
3358   1409 32 75 32      sta (cmd_freespace_1_buf)+(9)
3359   140C CD 68 22      call memcpy_back
3360   140F             ;15 buf[5]  = ' ';
3361   140F 3E 20         mvi a, 32
3362   1411             ;16 memcpy_back(buf+2,  buf+1, 3); buf[1]  = ' ';
3363   1411 21 6E 32      lxi h, (cmd_freespace_1_buf)+(2)
3364   1414 22 3B 34      shld memcpy_back_1
3365   1417 21 6D 32      lxi h, (cmd_freespace_1_buf)+(1)
3366   141A 22 3D 34      shld memcpy_back_2
3367   141D 21 03 00      lxi h, 3
3368   1420 32 71 32      sta (cmd_freespace_1_buf)+(5)
3369   1423 CD 68 22      call memcpy_back
3370   1426             ;16 buf[1]  = ' ';
3371   1426 3E 20         mvi a, 32
3372   1428             ;17 strcpy(buf+13, " mb");
3373   1428 21 79 32      lxi h, (cmd_freespace_1_buf)+(13)
3374   142B 22 90 31      shld strcpy_1
3375   142E 21 9A 2A      lxi h, str32
3376   1431 32 6D 32      sta (cmd_freespace_1_buf)+(1)
3377   1434 CD 07 0D      call strcpy
3378   1437             ;20 drawWindowText(6, y, text);
3379   1437 3A 69 32      lda cmd_freespace_1_1
3380   143A 32 5F 32      sta drawWindowText_2
3381   143D 3E 06         mvi a, 6
3382   143F 32 5E 32      sta drawWindowText_1
3383   1442 2A 6A 32      lhld cmd_freespace_1_2
3384   1445 CD C9 12      call drawWindowText
3385   1448             ;21 drawWindowText(16, y, buf);
3386   1448 3A 69 32      lda cmd_freespace_1_1
3387   144B 32 5F 32      sta drawWindowText_2
3388   144E 3E 10         mvi a, 16
3389   1450 32 5E 32      sta drawWindowText_1
3390   1453 21 6C 32      lxi h, cmd_freespace_1_buf
3391   1456 CD C9 12      call drawWindowText
3392   1459 C9            ret
3393   145A             ; --------------------------------------------------------------
3394   145A             fs_gettotal:
3395   145A             ;294 fs_high = 200;
3396   145A 21 C8 00      lxi h, 200
3397   145D             ;295 fs_low = 20;
3398   145D 22 0F 31      shld fs_high
3399   1460 21 14 00      lxi h, 20
3400   1463             ;296 return 0; 
3401   1463 AF            xra a
3402   1464 22 0D 31      shld fs_low
3403   1467 C9            ret
3404   1468             ; --------------------------------------------------------------
3405   1468             drawAnyKeyButton:
3406   1468             ;266 drawWindowTextCenter(4, "[ ok ]");
3407   1468 3E 04         mvi a, 4
3408   146A 32 38 34      sta drawWindowTextCenter_1
3409   146D 21 C6 2B      lxi h, str56
3410   1470 CD 2D 22      call drawWindowTextCenter
3411   1473 C9            ret
3412   1474             ; --------------------------------------------------------------
3413   1474             drawScreen:
3414   1474             ;146 cmdline[0] = 0;
3415   1474 AF            xra a
3416   1475             ;147 drawScreenInt();
3417   1475 32 D5 2F      sta cmdline
3418   1478 CD 1C 02      call drawScreenInt
3419   147B             ;148 drawCmdLineWithPath();
3420   147B CD 6E 02      call drawCmdLineWithPath
3421   147E             ;149 drawFiles2();
3422   147E CD 78 05      call drawFiles2
3423   1481 C9            ret
3424   1482             ; --------------------------------------------------------------
3425   1482             cmd_new1:
3426   1482             ;8 cmdLine[0] = 0;
3427   1482 32 7D 32      sta cmd_new1_1
3428   1485 AF            xra a
3429   1486             ;11 if(!inputBox(dir ? " sozdatx papku " : " sozdatx fajl ") && cmdline[0]!=0) return 0;
3430   1486 32 D5 2F      sta cmdline
3431   1489 3A 7D 32      lda cmd_new1_1
3432   148C B7            ora a
3433   148D CA 96 14      jz l28705
3434   1490 21 0D 2B      lxi h, str29
3435   1493 C3 99 14      jmp l28704
3436   1496             ; label1
3437   1496             l28705:
3438   1496 21 FE 2A      lxi h, str30
3439   1499             ; label1
3440   1499             l28704:
3441   1499 CD 22 1B      call inputBox
3442   149C B7            ora a
3443   149D C2 A9 14      jnz l28648
3444   14A0 3A D5 2F      lda cmdline
3445   14A3 B7            ora a
3446   14A4 CA A9 14      jz l28648
3447   14A7             ;11 return 0;
3448   14A7 AF            xra a
3449   14A8 C9            ret
3450   14A9             l28648:
3451   14A9             ;13 if(!absolutePath(cmdline)) return ERR_RECV_STRING;
3452   14A9 21 D5 2F      lxi h, cmdline
3453   14AC CD 59 15      call absolutePath
3454   14AF B7            ora a
3455   14B0 C2 B6 14      jnz l28714
3456   14B3             ;13 return ERR_RECV_STRING;
3457   14B3 3E 0B         mvi a, 11
3458   14B5 C9            ret
3459   14B6             l28714:
3460   14B6             ;16 if(!dir) {
3461   14B6 3A 7D 32      lda cmd_new1_1
3462   14B9 B7            ora a
3463   14BA C2 F4 14      jnz l28723
3464   14BD             ;16 {
3465   14BD 21 D5 2F      lxi h, cmdline
3466   14C0 CD B7 0C      call strlen
3467   14C3 11 FF 00      lxi d, 255
3468   14C6 CD CD 29      call op_cmp16
3469   14C9 DA CF 14      jc l28731
3470   14CC             ;17 return ERR_RECV_STRING;
3471   14CC 3E 0B         mvi a, 11
3472   14CE C9            ret
3473   14CF             l28731:
3474   14CF             ;20 memcpy_back(cmdline+1, cmdline, 255);
3475   14CF 21 D6 2F      lxi h, (cmdline)+(1)
3476   14D2 22 3B 34      shld memcpy_back_1
3477   14D5 21 D5 2F      lxi h, cmdline
3478   14D8 22 3D 34      shld memcpy_back_2
3479   14DB 21 FF 00      lxi h, 255
3480   14DE CD 68 22      call memcpy_back
3481   14E1             ;21 cmdline[0] = '*';
3482   14E1 3E 2A         mvi a, 42
3483   14E3             ;24 run(editorApp, cmdLine);
3484   14E3 21 A7 2D      lxi h, editorApp
3485   14E6 22 87 32      shld run_1
3486   14E9 21 D5 2F      lxi h, cmdline
3487   14EC 32 D5 2F      sta cmdline
3488   14EF CD CC 15      call run
3489   14F2             ;25 return 0;
3490   14F2 AF            xra a
3491   14F3 C9            ret
3492   14F4             l28723:
3493   14F4             ;29 dir = fs_mkdir(cmdline);
3494   14F4 21 D5 2F      lxi h, cmdline
3495   14F7 CD 8E 22      call fs_mkdir
3496   14FA             ;32 if(!dir) {
3497   14FA B7            ora a
3498   14FB 32 7D 32      sta cmd_new1_1
3499   14FE C2 08 15      jnz l28732
3500   1501             ;32 {
3501   1501 CD 90 03      call getFiles
3502   1504             ;34 dupFiles(0);
3503   1504 AF            xra a
3504   1505 CD A7 04      call dupFiles
3505   1508             l28732:
3506   1508             ;37 return dir;
3507   1508 3A 7D 32      lda cmd_new1_1
3508   150B C9            ret
3509   150C             ; --------------------------------------------------------------
3510   150C             unpackName:
3511   150C C5            push b
3512   150D             ;255 for(i=0; i!=11; ++i, ++s) {
3513   150D 06 00         mvi b, 0
3514   150F 22 80 32      shld unpackName_2
3515   1512             l24:
3516   1512             ;255 {
3517   1512 3E 08         mvi a, 8
3518   1514 B8            cmp b
3519   1515 C2 21 15      jnz l28733
3520   1518             ;256 *d = '.', ++d;
3521   1518 2A 7E 32      lhld unpackName_1
3522   151B 36 2E         mvi m, 46
3523   151D 23            inx h
3524   151E 22 7E 32      shld unpackName_1
3525   1521             l28733:
3526   1521             ;257 if(*s!=' ') *d = *s, ++d;
3527   1521 2A 80 32      lhld unpackName_2
3528   1524 7E            mov a, m
3529   1525 FE 20         cpi 32
3530   1527 CA 33 15      jz l28742
3531   152A             ;257 *d = *s, ++d;
3532   152A 7E            mov a, m
3533   152B 2A 7E 32      lhld unpackName_1
3534   152E 77            mov m, a
3535   152F 23            inx h
3536   1530 22 7E 32      shld unpackName_1
3537   1533             l28742:
3538   1533             l23:
3539   1533 04            inr b
3540   1534 2A 80 32      lhld unpackName_2
3541   1537 23            inx h
3542   1538 22 80 32      shld unpackName_2
3543   153B 3E 0B         mvi a, 11
3544   153D B8            cmp b
3545   153E C2 12 15      jnz l24
3546   1541             ;259 if(d[-1]=='.') --d;
3547   1541 2A 7E 32      lhld unpackName_1
3548   1544 2B            dcx h
3549   1545 7E            mov a, m
3550   1546 FE 2E         cpi 46
3551   1548 C2 52 15      jnz l28823
3552   154B             ;259 --d;
3553   154B 2A 7E 32      lhld unpackName_1
3554   154E 2B            dcx h
3555   154F 22 7E 32      shld unpackName_1
3556   1552             l28823:
3557   1552             ;260 *d = 0;
3558   1552 2A 7E 32      lhld unpackName_1
3559   1555 36 00         mvi m, 0
3560   1557 C1            pop b
3561   1558 C9            ret
3562   1559             ; --------------------------------------------------------------
3563   1559             absolutePath:
3564   1559 C5            push b
3565   155A             ;484 if(str[0] == '/') {
3566   155A 7E            mov a, m
3567   155B FE 2F         cpi 47
3568   155D C2 6E 15      jnz l28824
3569   1560             ;484 {
3570   1560 22 90 31      shld strcpy_1
3571   1563 22 83 32      shld absolutePath_1
3572   1566 23            inx h
3573   1567 CD 07 0D      call strcpy
3574   156A             ;486 return 1;
3575   156A 3E 01         mvi a, 1
3576   156C C1            pop b
3577   156D C9            ret
3578   156E             l28824:
3579   156E             ;490 l = strlen(panelA.path1);
3580   156E 22 83 32      shld absolutePath_1
3581   1571 21 C3 2D      lxi h, (panelA)+(2)
3582   1574 CD B7 0C      call strlen
3583   1577             ;493 if(l != 0) l++;
3584   1577 7C            mov a, h
3585   1578 B5            ora l
3586   1579 44            mov b, h
3587   157A 4D            mov c, l
3588   157B CA 81 15      jz l28825
3589   157E             ;493 l++;
3590   157E 23            inx h
3591   157F 44            mov b, h
3592   1580 4D            mov c, l
3593   1581             l28825:
3594   1581             ;496 if(strlen(str) + l >= 255) return 0;
3595   1581 2A 83 32      lhld absolutePath_1
3596   1584 CD B7 0C      call strlen
3597   1587 09            dad b
3598   1588 11 FF 00      lxi d, 255
3599   158B CD CD 29      call op_cmp16
3600   158E DA 94 15      jc l28834
3601   1591             ;496 return 0;
3602   1591 AF            xra a
3603   1592 C1            pop b
3604   1593 C9            ret
3605   1594             l28834:
3606   1594             ;499 memcpy_back(str+l, str, strlen(str)+1);
3607   1594 2A 83 32      lhld absolutePath_1
3608   1597 09            dad b
3609   1598 22 3B 34      shld memcpy_back_1
3610   159B 2A 83 32      lhld absolutePath_1
3611   159E 22 3D 34      shld memcpy_back_2
3612   15A1 CD B7 0C      call strlen
3613   15A4 23            inx h
3614   15A5 CD 68 22      call memcpy_back
3615   15A8             ;500 memcpy(str, panelA.path1, l);
3616   15A8 2A 83 32      lhld absolutePath_1
3617   15AB 22 9A 31      shld memcpy_1
3618   15AE 21 C3 2D      lxi h, (panelA)+(2)
3619   15B1 22 9C 31      shld memcpy_2
3620   15B4 60            mov h, b
3621   15B5 69            mov l, c
3622   15B6 CD 93 0D      call memcpy
3623   15B9             ;503 if(l != 0) str[l-1] = '/';
3624   15B9 60            mov h, b
3625   15BA 69            mov l, c
3626   15BB 7C            mov a, h
3627   15BC B5            ora l
3628   15BD CA C8 15      jz l28843
3629   15C0             ;503 str[l-1] = '/';
3630   15C0 2B            dcx h
3631   15C1 EB            xchg
3632   15C2 2A 83 32      lhld absolutePath_1
3633   15C5 19            dad d
3634   15C6 36 2F         mvi m, 47
3635   15C8             l28843:
3636   15C8             ;505 return 1;
3637   15C8 3E 01         mvi a, 1
3638   15CA C1            pop b
3639   15CB C9            ret
3640   15CC             ; --------------------------------------------------------------
3641   15CC             run:
3642   15CC             ;725 saveState();
3643   15CC 22 89 32      shld run_2
3644   15CF CD B3 22      call saveState
3645   15D2             ;726 drawError(prog, fs_exec(prog, cmdLine)); 
3646   15D2 2A 87 32      lhld run_1
3647   15D5 22 62 32      shld drawError_1
3648   15D8 22 45 34      shld fs_exec_1
3649   15DB 2A 89 32      lhld run_2
3650   15DE CD F6 22      call fs_exec
3651   15E1 CD 13 13      call drawError
3652   15E4             ;727 drawScreen(); // Там происходит очистка ком строки
3653   15E4 CD 74 14      call drawScreen
3654   15E7 C9            ret
3655   15E8             ; --------------------------------------------------------------
3656   15E8             runCmdLine:
3657   15E8 C5            push b
3658   15E9             ;661 if(!absolutePath(cmdline)) return;
3659   15E9 21 D5 2F      lxi h, cmdline
3660   15EC CD 59 15      call absolutePath
3661   15EF B7            ora a
3662   15F0 C2 F5 15      jnz l28844
3663   15F3             ;661 return;
3664   15F3 C1            pop b
3665   15F4 C9            ret
3666   15F5             l28844:
3667   15F5             ;664 cmdLine2 = strchr(cmdLine, ' ');
3668   15F5 21 D5 2F      lxi h, cmdline
3669   15F8 22 49 34      shld strchr_1
3670   15FB 3E 20         mvi a, 32
3671   15FD CD FC 22      call strchr
3672   1600             ;665 if(cmdLine2) {
3673   1600 7C            mov a, h
3674   1601 B5            ora l
3675   1602 44            mov b, h
3676   1603 4D            mov c, l
3677   1604 CA 0F 16      jz l28845
3678   1607             ;665 {
3679   1607 AF            xra a
3680   1608 02            stax b
3681   1609             ;667 ++cmdLine2;
3682   1609 23            inx h
3683   160A 44            mov b, h
3684   160B 4D            mov c, l
3685   160C C3 12 16      jmp l28853
3686   160F             l28845:
3687   160F             ;668 {
3688   160F 01 5C 2A      lxi b, str15
3689   1612             ; label1
3690   1612             l28853:
3691   1612             ;673 run(cmdLine, cmdLine2);
3692   1612 21 D5 2F      lxi h, cmdline
3693   1615 22 87 32      shld run_1
3694   1618 60            mov h, b
3695   1619 69            mov l, c
3696   161A CD CC 15      call run
3697   161D C1            pop b
3698   161E C9            ret
3699   161F             ; --------------------------------------------------------------
3700   161F             getSelNoBack:
3701   161F C5            push b
3702   1620             ;137 FileInfo* f = getSel();
3703   1620 CD 85 10      call getSel
3704   1623             ;138 if(f->fname[0] == '.') f = 0;
3705   1623 7E            mov a, m
3706   1624 FE 2E         cpi 46
3707   1626 44            mov b, h
3708   1627 4D            mov c, l
3709   1628 C2 2E 16      jnz l28854
3710   162B             ;138 f = 0;
3711   162B 01 00 00      lxi b, 0
3712   162E             l28854:
3713   162E             ;139 return f;  
3714   162E 60            mov h, b
3715   162F 69            mov l, c
3716   1630 C1            pop b
3717   1631 C9            ret
3718   1632             ; --------------------------------------------------------------
3719   1632             dropPath:
3720   1632             ;540 dropPathInt(panelA.path1, buf);
3721   1632 21 C3 2D      lxi h, (panelA)+(2)
3722   1635 22 4C 34      shld dropPathInt_1
3723   1638 21 8F 32      lxi h, dropPath_buf
3724   163B CD 0E 23      call dropPathInt
3725   163E             ;541 reloadFiles(buf);
3726   163E 21 8F 32      lxi h, dropPath_buf
3727   1641 CD 45 16      call reloadFiles
3728   1644 C9            ret
3729   1645             ; --------------------------------------------------------------
3730   1645             reloadFiles:
3731   1645             ;453 drawPanelTitle(1, panelA.path1);
3732   1645 3E 01         mvi a, 1
3733   1647 32 82 31      sta drawPanelTitle_1
3734   164A 22 9A 32      shld reloadFiles_1
3735   164D 21 C3 2D      lxi h, (panelA)+(2)
3736   1650 CD D4 0B      call drawPanelTitle
3737   1653             ;454 drawCmdLineWithPath();
3738   1653 CD 6E 02      call drawCmdLineWithPath
3739   1656             ;457 getFiles();
3740   1656 CD 90 03      call getFiles
3741   1659             ;460 drawPanelTitle(1, panelA.path1);   
3742   1659 3E 01         mvi a, 1
3743   165B 32 82 31      sta drawPanelTitle_1
3744   165E 21 C3 2D      lxi h, (panelA)+(2)
3745   1661 CD D4 0B      call drawPanelTitle
3746   1664             ;461 drawCmdLineWithPath();
3747   1664 CD 6E 02      call drawCmdLineWithPath
3748   1667             ;464 if(sfile) {
3749   1667 2A 9A 32      lhld reloadFiles_1
3750   166A 7C            mov a, h
3751   166B B5            ora l
3752   166C CA 72 16      jz l28855
3753   166F             ;464 {
3754   166F CD F0 04      call selectFile
3755   1672             l28855:
3756   1672             ;469 drawFilesCount();
3757   1672 CD 0E 11      call drawFilesCount
3758   1675             ;470 drawFiles();
3759   1675 CD 01 11      call drawFiles
3760   1678             ;471 showFileCursorAndDrawFileInfo();
3761   1678 CD 95 12      call showFileCursorAndDrawFileInfo
3762   167B             ;474 drawCmdLine(); 
3763   167B CD 6C 0A      call drawCmdLine
3764   167E C9            ret
3765   167F             ; --------------------------------------------------------------
3766   167F             hideFileCursor:
3767   167F             ;70 if(!fileCursorX) return;
3768   167F 3A F5 30      lda fileCursorX
3769   1682 B7            ora a
3770   1683 C8            rz
3771   1684             ;70 return;
3772   1684             l28856:
3773   1684             ;71 fs_print(fileCursorX, fileCursorY, 1, " ", 0);
3774   1684 32 7C 31      sta fs_print_1
3775   1687 3A F6 30      lda fileCursorY
3776   168A 32 7D 31      sta fs_print_2
3777   168D 21 6E 2A      lxi h, str46
3778   1690 22 7F 31      shld fs_print_4
3779   1693 3E 01         mvi a, 1
3780   1695 32 7E 31      sta fs_print_3
3781   1698 AF            xra a
3782   1699 CD FE 0A      call fs_print
3783   169C             ;72 fs_print(fileCursorX + 13, fileCursorY, 1, " ", 0);
3784   169C 3A F5 30      lda fileCursorX
3785   169F C6 0D         adi 13
3786   16A1 32 7C 31      sta fs_print_1
3787   16A4 3A F6 30      lda fileCursorY
3788   16A7 32 7D 31      sta fs_print_2
3789   16AA 21 6E 2A      lxi h, str46
3790   16AD 22 7F 31      shld fs_print_4
3791   16B0 3E 01         mvi a, 1
3792   16B2 32 7E 31      sta fs_print_3
3793   16B5 AF            xra a
3794   16B6 CD FE 0A      call fs_print
3795   16B9             ;73 fileCursorX = 0;
3796   16B9 AF            xra a
3797   16BA 32 F5 30      sta fileCursorX
3798   16BD C9            ret
3799   16BE             ; --------------------------------------------------------------
3800   16BE             showFileCursor:
3801   16BE             ;80 hideFileCursor();
3802   16BE CD 7F 16      call hideFileCursor
3803   16C1             ;83 fileCursorX = panelA.cursorX*15 + 1 + activePanel, fileCursorY = 2 + panelA.cursorY;
3804   16C1 2A C3 2E      lhld (panelA)+(258)
3805   16C4 26 00         mvi h, 0
3806   16C6 54            mov d, h
3807   16C7 5D            mov e, l
3808   16C8 29            dad h
3809   16C9 19            dad d
3810   16CA 29            dad h
3811   16CB 19            dad d
3812   16CC 29            dad h
3813   16CD 19            dad d
3814   16CE 23            inx h
3815   16CF EB            xchg
3816   16D0 2A F2 30      lhld activePanel
3817   16D3 26 00         mvi h, 0
3818   16D5 19            dad d
3819   16D6 7D            mov a, l
3820   16D7 32 F5 30      sta fileCursorX
3821   16DA 3A C4 2E      lda (panelA)+(259)
3822   16DD C6 02         adi 2
3823   16DF             ;84 fs_print(fileCursorX, fileCursorY, 1, "[", 0);
3824   16DF 32 F6 30      sta fileCursorY
3825   16E2 3A F5 30      lda fileCursorX
3826   16E5 32 7C 31      sta fs_print_1
3827   16E8 3A F6 30      lda fileCursorY
3828   16EB 32 7D 31      sta fs_print_2
3829   16EE 21 C4 2B      lxi h, str47
3830   16F1 22 7F 31      shld fs_print_4
3831   16F4 3E 01         mvi a, 1
3832   16F6 32 7E 31      sta fs_print_3
3833   16F9 AF            xra a
3834   16FA CD FE 0A      call fs_print
3835   16FD             ;85 fs_print(fileCursorX + 13, fileCursorY, 1, "]", 0);
3836   16FD 3A F5 30      lda fileCursorX
3837   1700 C6 0D         adi 13
3838   1702 32 7C 31      sta fs_print_1
3839   1705 3A F6 30      lda fileCursorY
3840   1708 32 7D 31      sta fs_print_2
3841   170B 21 07 2C      lxi h, str48
3842   170E 22 7F 31      shld fs_print_4
3843   1711 3E 01         mvi a, 1
3844   1713 32 7E 31      sta fs_print_3
3845   1716 AF            xra a
3846   1717 CD FE 0A      call fs_print
3847   171A C9            ret
3848   171B             ; --------------------------------------------------------------
3849   171B             cmd_copymove1:
3850   171B C5            push b
3851   171C             ;176 if(shiftPressed) {
3852   171C B7            ora a
3853   171D 32 9D 32      sta cmd_copymove1_2
3854   1720 CA 40 17      jz l28857
3855   1723             ;176 {
3856   1723 CD 1F 16      call getSelNoBack
3857   1726             ;179 if(!f) return 0; // ” ©« ­Ґ ўлЎа ­, ўле®¤Ё¬ ЎҐ§ ®иЁЎЄЁ
3858   1726 7C            mov a, h
3859   1727 B5            ora l
3860   1728 C2 2E 17      jnz l28865
3861   172B             ;179 return 0; // ” ©« ­Ґ ўлЎа ­, ўле®¤Ё¬ ЎҐ§ ®иЁЎЄЁ
3862   172B AF            xra a
3863   172C C1            pop b
3864   172D C9            ret
3865   172E             l28865:
3866   172E             ;180 unpackName(cmdLine, f->fname);
3867   172E 22 A1 32      shld cmd_copymove1_f
3868   1731 21 D5 2F      lxi h, cmdline
3869   1734 22 7E 32      shld unpackName_1
3870   1737 2A A1 32      lhld cmd_copymove1_f
3871   173A CD 0C 15      call unpackName
3872   173D C3 7D 17      jmp l28874
3873   1740             l28857:
3874   1740             ;181 {
3875   1740 21 CD 2E      lxi h, (panelB)+(2)
3876   1743 CD B7 0C      call strlen
3877   1746             ;184 if(i >= 254) return ERR_RECV_STRING; // ’ Є Є Є ЇаЁЎ ўЁ¬ 2 бЁ¬ў®« 
3878   1746 11 FE 00      lxi d, 254
3879   1749 CD CD 29      call op_cmp16
3880   174C DA 53 17      jc l28875
3881   174F             ;184 return ERR_RECV_STRING; // ’ Є Є Є ЇаЁЎ ўЁ¬ 2 бЁ¬ў®« 
3882   174F 3E 0B         mvi a, 11
3883   1751 C1            pop b
3884   1752 C9            ret
3885   1753             l28875:
3886   1753             ;185 cmdLine[0] = '/';
3887   1753 3E 2F         mvi a, 47
3888   1755             ;186 strcpy(cmdline+1, panelB.path1);
3889   1755 22 BA 33      shld cmd_copymove1_i
3890   1758 21 D6 2F      lxi h, (cmdline)+(1)
3891   175B 22 90 31      shld strcpy_1
3892   175E 21 CD 2E      lxi h, (panelB)+(2)
3893   1761 32 D5 2F      sta cmdline
3894   1764 CD 07 0D      call strcpy
3895   1767             ;187 if(i != 0) strcpy(cmdline+i+1, "/");
3896   1767 2A BA 33      lhld cmd_copymove1_i
3897   176A 7C            mov a, h
3898   176B B5            ora l
3899   176C CA 7D 17      jz l28876
3900   176F             ;187 strcpy(cmdline+i+1, "/");
3901   176F 11 D5 2F      lxi d, cmdline
3902   1772 19            dad d
3903   1773 23            inx h
3904   1774 22 90 31      shld strcpy_1
3905   1777 21 3E 2B      lxi h, str23
3906   177A CD 07 0D      call strcpy
3907   177D             l28876:
3908   177D             ; label1
3909   177D             l28874:
3910   177D             ;191 if(!inputBox(copymode ? " kopirowatx " : " pereimenowatx/peremestitx ") && cmdline[0]!=0) return 0;
3911   177D 3A 9C 32      lda cmd_copymove1_1
3912   1780 B7            ora a
3913   1781 CA 8A 17      jz l29974
3914   1784 21 8D 2A      lxi h, str24
3915   1787 C3 8D 17      jmp l29973
3916   178A             ; label1
3917   178A             l29974:
3918   178A 21 D1 2A      lxi h, str25
3919   178D             ; label1
3920   178D             l29973:
3921   178D CD 22 1B      call inputBox
3922   1790 B7            ora a
3923   1791 C2 9E 17      jnz l29917
3924   1794 3A D5 2F      lda cmdline
3925   1797 B7            ora a
3926   1798 CA 9E 17      jz l29917
3927   179B             ;191 return 0;
3928   179B AF            xra a
3929   179C C1            pop b
3930   179D C9            ret
3931   179E             l29917:
3932   179E             ;194 if(!absolutePath(cmdline)) return ERR_RECV_STRING;
3933   179E 21 D5 2F      lxi h, cmdline
3934   17A1 CD 59 15      call absolutePath
3935   17A4 B7            ora a
3936   17A5 C2 AC 17      jnz l29983
3937   17A8             ;194 return ERR_RECV_STRING;
3938   17A8 3E 0B         mvi a, 11
3939   17AA C1            pop b
3940   17AB C9            ret
3941   17AC             l29983:
3942   17AC             ;197 mask[0] = 0;  
3943   17AC AF            xra a
3944   17AD             ;198 name = getname(cmdline);
3945   17AD 21 D5 2F      lxi h, cmdline
3946   17B0 32 A3 33      sta cmd_copymove1_mask
3947   17B3 CD 3B 23      call getName
3948   17B6             ;199 if(name[0] != 0) {
3949   17B6 AF            xra a
3950   17B7 B6            ora m
3951   17B8 22 9E 32      shld cmd_copymove1_name
3952   17BB CA D9 17      jz l29984
3953   17BE             ;199 {
3954   17BE 21 A3 33      lxi h, cmd_copymove1_mask
3955   17C1 22 D3 33      shld packName_1
3956   17C4 2A 9E 32      lhld cmd_copymove1_name
3957   17C7 CD 90 1B      call packName
3958   17CA             ;203 dropPathInt(cmdLine, 0);
3959   17CA 21 D5 2F      lxi h, cmdline
3960   17CD 22 4C 34      shld dropPathInt_1
3961   17D0 21 00 00      lxi h, 0
3962   17D3 CD 0E 23      call dropPathInt
3963   17D6 C3 EB 17      jmp l29992
3964   17D9             l29984:
3965   17D9             ;204 {
3966   17D9 3A D5 2F      lda cmdline
3967   17DC B7            ora a
3968   17DD CA EB 17      jz l29993
3969   17E0 2A 9E 32      lhld cmd_copymove1_name
3970   17E3 AF            xra a
3971   17E4 B6            ora m
3972   17E5 C2 EB 17      jnz l29993
3973   17E8             ;207 name[-1] = 0;
3974   17E8 2B            dcx h
3975   17E9 36 00         mvi m, 0
3976   17EB             l29993:
3977   17EB             ; label1
3978   17EB             l29992:
3979   17EB             ;211 type = getFirstSelected(sourceFile);
3980   17EB 21 A3 32      lxi h, cmd_copymove1_sourceFile
3981   17EE CD 51 19      call getFirstSelected
3982   17F1             ;212 if(type == 0) return 0; // ЌҐв ўлЎа ­­ле д ©«®ў
3983   17F1 4F            mov c, a
3984   17F2 AF            xra a
3985   17F3 B9            cmp c
3986   17F4 C2 F9 17      jnz l29996
3987   17F7             ;212 return 0; // ЌҐв ўлЎа ­­ле д ©«®ў
3988   17F7 C1            pop b
3989   17F8 C9            ret
3990   17F9             l29996:
3991   17F9             ;214 for(;;) {
3992   17F9             l111:
3993   17F9             l110:
3994   17F9             ;214 {
3995   17F9 21 A3 32      lxi h, cmd_copymove1_sourceFile
3996   17FC CD 59 15      call absolutePath
3997   17FF B7            ora a
3998   1800 C2 08 18      jnz l29997
3999   1803             ;216 { e = ERR_RECV_STRING; break; }
4000   1803 06 0B         mvi b, 11
4001   1805             ;216 break; }
4002   1805 C3 03 19      jmp l109
4003   1808             l29997:
4004   1808             ;219 packName(forMask, getname(sourceFile));
4005   1808 21 AE 33      lxi h, cmd_copymove1_forMask
4006   180B 22 D3 33      shld packName_1
4007   180E 21 A3 32      lxi h, cmd_copymove1_sourceFile
4008   1811 CD 3B 23      call getName
4009   1814 CD 90 1B      call packName
4010   1817             ;220 if(mask[0]) applyMask(forMask, mask);
4011   1817 3A A3 33      lda cmd_copymove1_mask
4012   181A B7            ora a
4013   181B CA 2A 18      jz l29998
4014   181E             ;220 applyMask(forMask, mask);
4015   181E 21 AE 33      lxi h, cmd_copymove1_forMask
4016   1821 22 56 34      shld applyMask_1
4017   1824 21 A3 33      lxi h, cmd_copymove1_mask
4018   1827 CD 5B 23      call applyMask
4019   182A             l29998:
4020   182A             ;221 if(catPathAndUnpack(cmdline, forMask)) return ERR_RECV_STRING;
4021   182A 21 D5 2F      lxi h, cmdline
4022   182D 22 5A 34      shld catPathAndUnpack_1
4023   1830 21 AE 33      lxi h, cmd_copymove1_forMask
4024   1833 CD 89 23      call catPathAndUnpack
4025   1836 B7            ora a
4026   1837 CA 3E 18      jz l30007
4027   183A             ;221 return ERR_RECV_STRING;
4028   183A 3E 0B         mvi a, 11
4029   183C C1            pop b
4030   183D C9            ret
4031   183E             l30007:
4032   183E             ;224 if(0!=strcmp(sourceFile, cmdline)) {
4033   183E 21 A3 32      lxi h, cmd_copymove1_sourceFile
4034   1841 22 8A 31      shld strcmp_1
4035   1844 21 D5 2F      lxi h, cmdline
4036   1847 CD C6 0C      call strcmp
4037   184A B7            ora a
4038   184B CA E4 18      jz l30016
4039   184E             ;224 {
4040   184E 3A 9C 32      lda cmd_copymove1_1
4041   1851 B7            ora a
4042   1852 CA 7B 18      jz l30072
4043   1855             ;226 {
4044   1855 3E 02         mvi a, 2
4045   1857 B9            cmp c
4046   1858 C2 6B 18      jnz l30128
4047   185B             ;227 {
4048   185B 21 A3 32      lxi h, cmd_copymove1_sourceFile
4049   185E 22 60 34      shld cmd_copyFolder_1
4050   1861 21 D5 2F      lxi h, cmdline
4051   1864 CD C7 23      call cmd_copyFolder
4052   1867 47            mov b, a
4053   1868 C3 78 18      jmp l30143
4054   186B             l30128:
4055   186B             ;229 {
4056   186B 21 A3 32      lxi h, cmd_copymove1_sourceFile
4057   186E 22 7A 34      shld cmd_copyFile_1
4058   1871 21 D5 2F      lxi h, cmdline
4059   1874 CD F9 24      call cmd_copyFile
4060   1877 47            mov b, a
4061   1878             ; label1
4062   1878             l30143:
4063   1878 C3 DC 18      jmp l30144
4064   187B             l30072:
4065   187B             ;232 {
4066   187B 21 B4 2A      lxi h, str26
4067   187E CD 9C 12      call drawWindow
4068   1881             ;235 drawWindowText(0, 1, "iz:");
4069   1881 AF            xra a
4070   1882 32 5E 32      sta drawWindowText_1
4071   1885 3C            inr a
4072   1886 32 5F 32      sta drawWindowText_2
4073   1889 21 59 2C      lxi h, str19
4074   188C CD C9 12      call drawWindowText
4075   188F             ;236 drawWindowText(4, 1, sourceFile);
4076   188F 3E 01         mvi a, 1
4077   1891 32 5F 32      sta drawWindowText_2
4078   1894 3E 04         mvi a, 4
4079   1896 32 5E 32      sta drawWindowText_1
4080   1899 21 A3 32      lxi h, cmd_copymove1_sourceFile
4081   189C CD C9 12      call drawWindowText
4082   189F             ;237 drawWindowText(0, 2, "w:");
4083   189F AF            xra a
4084   18A0 32 5E 32      sta drawWindowText_1
4085   18A3 3E 02         mvi a, 2
4086   18A5 32 5F 32      sta drawWindowText_2
4087   18A8 21 82 2D      lxi h, str20
4088   18AB CD C9 12      call drawWindowText
4089   18AE             ;238 drawWindowText(4, 2, cmdline);
4090   18AE 3E 02         mvi a, 2
4091   18B0 32 5F 32      sta drawWindowText_2
4092   18B3 87            add a
4093   18B4 32 5E 32      sta drawWindowText_1
4094   18B7 21 D5 2F      lxi h, cmdline
4095   18BA CD C9 12      call drawWindowText
4096   18BD             ;239 drawAnyKeyButton();
4097   18BD CD 68 14      call drawAnyKeyButton
4098   18C0             ;242 if(fs_bioskey(1) == KEY_ESC) { e = ERR_USER; break; }
4099   18C0 3E 01         mvi a, 1
4100   18C2 CD 98 05      call fs_bioskey
4101   18C5 FE 1B         cpi 27
4102   18C7 C2 CF 18      jnz l30145
4103   18CA             ;242 { e = ERR_USER; break; }
4104   18CA 06 80         mvi b, 128
4105   18CC             ;242 break; }
4106   18CC C3 03 19      jmp l109
4107   18CF             l30145:
4108   18CF             ;244 e = fs_move(sourceFile, cmdline);    
4109   18CF 21 A3 32      lxi h, cmd_copymove1_sourceFile
4110   18D2 22 9C 34      shld fs_move_1
4111   18D5 21 D5 2F      lxi h, cmdline
4112   18D8 CD B0 26      call fs_move
4113   18DB 47            mov b, a
4114   18DC             ; label1
4115   18DC             l30144:
4116   18DC             ;247 if(e) break;
4117   18DC AF            xra a
4118   18DD B8            cmp b
4119   18DE CA E4 18      jz l30146
4120   18E1             ;247 break;
4121   18E1 C3 03 19      jmp l109
4122   18E4             l30146:
4123   18E4             l30016:
4124   18E4             ;251 dropPathInt(cmdLine, 0);
4125   18E4 21 D5 2F      lxi h, cmdline
4126   18E7 22 4C 34      shld dropPathInt_1
4127   18EA 21 00 00      lxi h, 0
4128   18ED CD 0E 23      call dropPathInt
4129   18F0             ;254 type = getNextSelected(sourceFile);
4130   18F0 21 A3 32      lxi h, cmd_copymove1_sourceFile
4131   18F3 CD 89 1A      call getNextSelected
4132   18F6             ;255 if(type == 0) { e=0; break; }
4133   18F6 B7            ora a
4134   18F7 4F            mov c, a
4135   18F8 C2 00 19      jnz l30147
4136   18FB             ;255 { e=0; break; }
4137   18FB 06 00         mvi b, 0
4138   18FD             ;255 break; }
4139   18FD C3 03 19      jmp l109
4140   1900             l30147:
4141   1900 C3 F9 17      jmp l111
4142   1903             l109:
4143   1903             ;260 getFiles();
4144   1903 CD 90 03      call getFiles
4145   1906             ;261 dupFiles(1);
4146   1906 3E 01         mvi a, 1
4147   1908 CD A7 04      call dupFiles
4148   190B             ;263 return e;
4149   190B 78            mov a, b
4150   190C C1            pop b
4151   190D C9            ret
4152   190E             ; --------------------------------------------------------------
4153   190E             confirm:
4154   190E             ;237 drawWindow(title);
4155   190E 22 BE 33      shld confirm_2
4156   1911 2A BC 33      lhld confirm_1
4157   1914 CD 9C 12      call drawWindow
4158   1917             ;238 drawWindowText(3, 1, text);
4159   1917 3E 01         mvi a, 1
4160   1919 32 5F 32      sta drawWindowText_2
4161   191C 3E 03         mvi a, 3
4162   191E 32 5E 32      sta drawWindowText_1
4163   1921 2A BE 33      lhld confirm_2
4164   1924 CD C9 12      call drawWindowText
4165   1927             ;239 drawWindowText(6, 4, "[ wk - ok ]  [ ar2 - otmena ]");
4166   1927 3E 04         mvi a, 4
4167   1929 32 5F 32      sta drawWindowText_2
4168   192C 3E 06         mvi a, 6
4169   192E 32 5E 32      sta drawWindowText_1
4170   1931 21 E9 2B      lxi h, str14
4171   1934 CD C9 12      call drawWindowText
4172   1937             ;242 while(1) {
4173   1937             l18:
4174   1937             ;242 {
4175   1937 AF            xra a
4176   1938 CD 98 05      call fs_bioskey
4177   193B D6 0D         sui 13
4178   193D CA 48 19      jz l20
4179   1940 D6 0E         sui 14
4180   1942 CA 4B 19      jz l21
4181   1945 C3 4D 19      jmp l19
4182   1948             ;244 case KEY_ENTER: return 1;
4183   1948             l20:
4184   1948             ;244 return 1;
4185   1948 3E 01         mvi a, 1
4186   194A C9            ret
4187   194B             ;245 case KEY_ESC: return 0;
4188   194B             l21:
4189   194B             ;245 return 0;
4190   194B AF            xra a
4191   194C C9            ret
4192   194D             l19:
4193   194D C3 37 19      jmp l18
4194   1950             l17:
4195   1950 C9            ret
4196   1951             ; --------------------------------------------------------------
4197   1951             getFirstSelected:
4198   1951 C5            push b
4199   1952             ;284 nextSelectedCnt = panelA.cnt;
4200   1952 22 C0 33      shld getFirstSelected_1
4201   1955 2A C7 2E      lhld (panelA)+(262)
4202   1958             ;285 nextSelectedFile = panelA.files1;
4203   1958 22 EC 30      shld nextSelectedCnt
4204   195B 2A C1 2D      lhld panelA
4205   195E             ;286 if(type = getNextSelected(name)) return type; 
4206   195E 22 EE 30      shld nextSelectedFile
4207   1961 2A C0 33      lhld getFirstSelected_1
4208   1964 CD 89 1A      call getNextSelected
4209   1967 B7            ora a
4210   1968 CA 6D 19      jz l30148
4211   196B             ;286 return type; 
4212   196B C1            pop b
4213   196C C9            ret
4214   196D             l30148:
4215   196D             ;288 nextSelectedFile = getSelNoBack();
4216   196D 47            mov b, a
4217   196E CD 1F 16      call getSelNoBack
4218   1971             ;289 if(!nextSelectedFile) return 0;
4219   1971 7C            mov a, h
4220   1972 B5            ora l
4221   1973 22 EE 30      shld nextSelectedFile
4222   1976 C2 7C 19      jnz l30149
4223   1979             ;289 return 0;
4224   1979 AF            xra a
4225   197A C1            pop b
4226   197B C9            ret
4227   197C             l30149:
4228   197C             ;290 unpackName(name, nextSelectedFile->fname);
4229   197C 2A C0 33      lhld getFirstSelected_1
4230   197F 22 7E 32      shld unpackName_1
4231   1982 2A EE 30      lhld nextSelectedFile
4232   1985 CD 0C 15      call unpackName
4233   1988             ;291 if(nextSelectedFile->fattrib & 0x10) return 2;
4234   1988 2A EE 30      lhld nextSelectedFile
4235   198B 11 0B 00      lxi d, 11
4236   198E 19            dad d
4237   198F 7E            mov a, m
4238   1990 E6 10         ani 16
4239   1992 CA 99 19      jz l30150
4240   1995             ;291 return 2;
4241   1995 3E 02         mvi a, 2
4242   1997 C1            pop b
4243   1998 C9            ret
4244   1999             l30150:
4245   1999             ;292 return 1;
4246   1999 3E 01         mvi a, 1
4247   199B C1            pop b
4248   199C C9            ret
4249   199D             ; --------------------------------------------------------------
4250   199D             cmd_deleteFile:
4251   199D             ;8 drawWindow(" udalenie ");
4252   199D 21 1D 2B      lxi h, str38
4253   19A0 CD 9C 12      call drawWindow
4254   19A3             ;9 drawWindowText(0, 1, cmdline);
4255   19A3 AF            xra a
4256   19A4 32 5E 32      sta drawWindowText_1
4257   19A7 3C            inr a
4258   19A8 32 5F 32      sta drawWindowText_2
4259   19AB 21 D5 2F      lxi h, cmdline
4260   19AE CD C9 12      call drawWindowText
4261   19B1             ;10 drawEscButton();
4262   19B1 CD C2 26      call drawEscButton
4263   19B4             ;13 if(fs_bioskey(1) == KEY_ESC) return ERR_USER;
4264   19B4 3E 01         mvi a, 1
4265   19B6 CD 98 05      call fs_bioskey
4266   19B9 FE 1B         cpi 27
4267   19BB C2 C1 19      jnz l30151
4268   19BE             ;13 return ERR_USER;
4269   19BE 3E 80         mvi a, 128
4270   19C0 C9            ret
4271   19C1             l30151:
4272   19C1             ;16 return fs_delete(cmdline);
4273   19C1 21 D5 2F      lxi h, cmdline
4274   19C4 CD CE 26      call fs_delete
4275   19C7 C9            ret
4276   19C8             ; --------------------------------------------------------------
4277   19C8             cmd_deleteFolder:
4278   19C8 C5            push b
4279   19C9             ;27 level = 0;
4280   19C9 0E 00         mvi c, 0
4281   19CB             ;29 while(1) {
4282   19CB             l114:
4283   19CB             ;29 {
4284   19CB 21 D5 2F      lxi h, cmdline
4285   19CE 22 A0 31      shld fs_findfirst_1
4286   19D1 2A CB 2E      lhld panelB
4287   19D4 22 A2 31      shld fs_findfirst_2
4288   19D7 2A D5 30      lhld maxFiles
4289   19DA CD B7 0D      call fs_findfirst
4290   19DD             ;32 if(e != 0 && e != ERR_MAX_FILES) return e;
4291   19DD B7            ora a
4292   19DE 47            mov b, a
4293   19DF CA E9 19      jz l30152
4294   19E2 FE 0A         cpi 10
4295   19E4 CA E9 19      jz l30152
4296   19E7             ;32 return e;
4297   19E7 C1            pop b
4298   19E8 C9            ret
4299   19E9             l30152:
4300   19E9             ;33 panelB.cnt = fs_low;
4301   19E9 2A 0D 31      lhld fs_low
4302   19EC             ;36 e = 0;
4303   19EC 06 00         mvi b, 0
4304   19EE             ;37 for(p=panelB.files1, i=panelB.cnt; i; --i, ++p) {
4305   19EE 22 D1 2F      shld (panelB)+(262)
4306   19F1 2A CB 2E      lhld panelB
4307   19F4 22 C5 33      shld cmd_deleteFolder_p
4308   19F7 2A D1 2F      lhld (panelB)+(262)
4309   19FA 22 C7 33      shld cmd_deleteFolder_i
4310   19FD             l117:
4311   19FD 2A C7 33      lhld cmd_deleteFolder_i
4312   1A00 7C            mov a, h
4313   1A01 B5            ora l
4314   1A02 CA 4C 1A      jz l115
4315   1A05             ;37 {
4316   1A05 21 D5 2F      lxi h, cmdline
4317   1A08 22 5A 34      shld catPathAndUnpack_1
4318   1A0B 2A C5 33      lhld cmd_deleteFolder_p
4319   1A0E CD 89 23      call catPathAndUnpack
4320   1A11 B7            ora a
4321   1A12 CA 19 1A      jz l30155
4322   1A15             ;38 return ERR_RECV_STRING;
4323   1A15 3E 0B         mvi a, 11
4324   1A17 C1            pop b
4325   1A18 C9            ret
4326   1A19             l30155:
4327   1A19             ;39 e = cmd_deleteFile();
4328   1A19 CD 9D 19      call cmd_deleteFile
4329   1A1C             ;40 if(e == ERR_DIR_NOT_EMPTY) break;
4330   1A1C FE 07         cpi 7
4331   1A1E 47            mov b, a
4332   1A1F C2 25 1A      jnz l30156
4333   1A22             ;40 break;
4334   1A22 C3 4C 1A      jmp l115
4335   1A25             l30156:
4336   1A25             ;41 dropPathInt(cmdLine, 0);
4337   1A25 21 D5 2F      lxi h, cmdline
4338   1A28 22 4C 34      shld dropPathInt_1
4339   1A2B 21 00 00      lxi h, 0
4340   1A2E CD 0E 23      call dropPathInt
4341   1A31             ;43 if(e) return e;
4342   1A31 78            mov a, b
4343   1A32 B7            ora a
4344   1A33 CA 38 1A      jz l30157
4345   1A36             ;43 return e;
4346   1A36 C1            pop b
4347   1A37 C9            ret
4348   1A38             l30157:
4349   1A38             l116:
4350   1A38 2A C7 33      lhld cmd_deleteFolder_i
4351   1A3B 2B            dcx h
4352   1A3C 22 C7 33      shld cmd_deleteFolder_i
4353   1A3F 2A C5 33      lhld cmd_deleteFolder_p
4354   1A42 11 14 00      lxi d, 20
4355   1A45 19            dad d
4356   1A46 22 C5 33      shld cmd_deleteFolder_p
4357   1A49 C3 FD 19      jmp l117
4358   1A4C             l115:
4359   1A4C             ;47 if(e == ERR_DIR_NOT_EMPTY) { 
4360   1A4C 3E 07         mvi a, 7
4361   1A4E B8            cmp b
4362   1A4F C2 56 1A      jnz l30184
4363   1A52             ;47 { 
4364   1A52 0C            inr c
4365   1A53             ;49 continue;
4366   1A53 C3 CB 19      jmp l114
4367   1A56             l30184:
4368   1A56             ;53 if(panelB.cnt == maxFiles) continue;
4369   1A56 2A D5 30      lhld maxFiles
4370   1A59 EB            xchg
4371   1A5A 2A D1 2F      lhld (panelB)+(262)
4372   1A5D CD CD 29      call op_cmp16
4373   1A60 C2 66 1A      jnz l30185
4374   1A63             ;53 continue;
4375   1A63 C3 CB 19      jmp l114
4376   1A66             l30185:
4377   1A66             ;56 e = cmd_deleteFile();
4378   1A66 CD 9D 19      call cmd_deleteFile
4379   1A69             ;57 if(e) return e;
4380   1A69 B7            ora a
4381   1A6A CA 6F 1A      jz l30186
4382   1A6D             ;57 return e;
4383   1A6D C1            pop b
4384   1A6E C9            ret
4385   1A6F             l30186:
4386   1A6F             ;60 if(level == 0) return 0;
4387   1A6F 47            mov b, a
4388   1A70 AF            xra a
4389   1A71 B9            cmp c
4390   1A72 C2 77 1A      jnz l30195
4391   1A75             ;60 return 0;
4392   1A75 C1            pop b
4393   1A76 C9            ret
4394   1A77             l30195:
4395   1A77             ;61 --level;
4396   1A77 0D            dcr c
4397   1A78             ;62 dropPathInt(cmdLine, 0);
4398   1A78 21 D5 2F      lxi h, cmdline
4399   1A7B 22 4C 34      shld dropPathInt_1
4400   1A7E 21 00 00      lxi h, 0
4401   1A81 CD 0E 23      call dropPathInt
4402   1A84 C3 CB 19      jmp l114
4403   1A87             l113:
4404   1A87 C1            pop b
4405   1A88 C9            ret
4406   1A89             ; --------------------------------------------------------------
4407   1A89             getNextSelected:
4408   1A89             ;298 for(;;) {
4409   1A89 22 C9 33      shld getNextSelected_1
4410   1A8C             l28:
4411   1A8C             l27:
4412   1A8C             ;298 {
4413   1A8C 2A EC 30      lhld nextSelectedCnt
4414   1A8F 7C            mov a, h
4415   1A90 B5            ora l
4416   1A91 C2 96 1A      jnz l30196
4417   1A94             ;299 return 0;
4418   1A94 AF            xra a
4419   1A95 C9            ret
4420   1A96             l30196:
4421   1A96             ;300 if(nextSelectedFile->fattrib & 0x80) break;
4422   1A96 2A EE 30      lhld nextSelectedFile
4423   1A99 11 0B 00      lxi d, 11
4424   1A9C 19            dad d
4425   1A9D 7E            mov a, m
4426   1A9E E6 80         ani 128
4427   1AA0 CA A6 1A      jz l30205
4428   1AA3             ;300 break;
4429   1AA3 C3 B7 1A      jmp l26
4430   1AA6             l30205:
4431   1AA6             ;301 ++nextSelectedFile, --nextSelectedCnt;
4432   1AA6 11 09 00      lxi d, 9
4433   1AA9 19            dad d
4434   1AAA 22 EE 30      shld nextSelectedFile
4435   1AAD 2A EC 30      lhld nextSelectedCnt
4436   1AB0 2B            dcx h
4437   1AB1 22 EC 30      shld nextSelectedCnt
4438   1AB4 C3 8C 1A      jmp l28
4439   1AB7             l26:
4440   1AB7             ;304 nextSelectedFile->fattrib &= 0x7F;
4441   1AB7 2A EE 30      lhld nextSelectedFile
4442   1ABA 11 0B 00      lxi d, 11
4443   1ABD 19            dad d
4444   1ABE 7E            mov a, m
4445   1ABF E6 7F         ani 127
4446   1AC1 77            mov m, a
4447   1AC2             ;305 unpackName(name, nextSelectedFile->fname);
4448   1AC2 2A C9 33      lhld getNextSelected_1
4449   1AC5 22 7E 32      shld unpackName_1
4450   1AC8 2A EE 30      lhld nextSelectedFile
4451   1ACB CD 0C 15      call unpackName
4452   1ACE             ;306 ++nextSelectedFile, --nextSelectedCnt;
4453   1ACE 2A EE 30      lhld nextSelectedFile
4454   1AD1 11 14 00      lxi d, 20
4455   1AD4 19            dad d
4456   1AD5 22 EE 30      shld nextSelectedFile
4457   1AD8 2A EC 30      lhld nextSelectedCnt
4458   1ADB             ;307 if(nextSelectedFile[-1].fattrib & 0x10) return 2;
4459   1ADB 2B            dcx h
4460   1ADC 22 EC 30      shld nextSelectedCnt
4461   1ADF 2A EE 30      lhld nextSelectedFile
4462   1AE2 11 EC FF      lxi d, -20
4463   1AE5 19            dad d
4464   1AE6 11 1F 00      lxi d, 31
4465   1AE9 19            dad d
4466   1AEA 7E            mov a, m
4467   1AEB E6 10         ani 16
4468   1AED CA F3 1A      jz l30208
4469   1AF0             ;307 return 2;
4470   1AF0 3E 02         mvi a, 2
4471   1AF2 C9            ret
4472   1AF3             l30208:
4473   1AF3             ;308 return 1;
4474   1AF3 3E 01         mvi a, 1
4475   1AF5 C9            ret
4476   1AF6             ; --------------------------------------------------------------
4477   1AF6             drawFile:
4478   1AF6             ;195 drawFile2(x*15+2+activePanel, 2+y, f);
4479   1AF6 22 CD 33      shld drawFile_3
4480   1AF9 2A CB 33      lhld drawFile_1
4481   1AFC 26 00         mvi h, 0
4482   1AFE 54            mov d, h
4483   1AFF 5D            mov e, l
4484   1B00 29            dad h
4485   1B01 19            dad d
4486   1B02 29            dad h
4487   1B03 19            dad d
4488   1B04 29            dad h
4489   1B05 19            dad d
4490   1B06 23            inx h
4491   1B07 23            inx h
4492   1B08 EB            xchg
4493   1B09 2A F2 30      lhld activePanel
4494   1B0C 26 00         mvi h, 0
4495   1B0E 19            dad d
4496   1B0F 7D            mov a, l
4497   1B10 32 A6 34      sta drawFile2_1
4498   1B13 3A CC 33      lda drawFile_2
4499   1B16 C6 02         adi 2
4500   1B18 32 A7 34      sta drawFile2_2
4501   1B1B 2A CD 33      lhld drawFile_3
4502   1B1E CD 1B 27      call drawFile2
4503   1B21 C9            ret
4504   1B22             ; --------------------------------------------------------------
4505   1B22             inputBox:
4506   1B22 C5            push b
4507   1B23             ;212 clearFlag = 1;
4508   1B23 0E 01         mvi c, 1
4509   1B25             ;215 drawWindow(title);
4510   1B25 22 CF 33      shld inputBox_1
4511   1B28 CD 9C 12      call drawWindow
4512   1B2B             ;216 drawWindowText(3, 0, "imq:");
4513   1B2B AF            xra a
4514   1B2C 32 5F 32      sta drawWindowText_2
4515   1B2F 3E 03         mvi a, 3
4516   1B31 32 5E 32      sta drawWindowText_1
4517   1B34 21 54 2C      lxi h, str12
4518   1B37 CD C9 12      call drawWindowText
4519   1B3A             ;217 drawWindowTextCenter(4, "[ ok ]  [ otmena ]");
4520   1B3A 3E 04         mvi a, 4
4521   1B3C 32 38 34      sta drawWindowTextCenter_1
4522   1B3F 21 CD 2B      lxi h, str13
4523   1B42 CD 2D 22      call drawWindowTextCenter
4524   1B45             ;220 while(1) {
4525   1B45             l16:
4526   1B45             ;220 {
4527   1B45 3E 01         mvi a, 1
4528   1B47 32 B6 34      sta drawWindowInput_1
4529   1B4A 32 B7 34      sta drawWindowInput_2
4530   1B4D 3E 1A         mvi a, 26
4531   1B4F CD 8F 27      call drawWindowInput
4532   1B52             ;222 c = fs_bioskey(0);
4533   1B52 AF            xra a
4534   1B53 CD 98 05      call fs_bioskey
4535   1B56             ;223 if(c==KEY_RIGHT) clearFlag = 0;
4536   1B56 FE 18         cpi 24
4537   1B58 C2 5D 1B      jnz l30209
4538   1B5B             ;223 clearFlag = 0;
4539   1B5B 0E 00         mvi c, 0
4540   1B5D             l30209:
4541   1B5D             ;224 if(c==KEY_LEFT) clearFlag = 0;
4542   1B5D FE 08         cpi 8
4543   1B5F C2 64 1B      jnz l30218
4544   1B62             ;224 clearFlag = 0;
4545   1B62 0E 00         mvi c, 0
4546   1B64             l30218:
4547   1B64             ;225 if(c==KEY_ENTER) { fs_hideCursor(); return 1; }
4548   1B64 FE 0D         cpi 13
4549   1B66 C2 71 1B      jnz l30227
4550   1B69             ;225 { fs_hideCursor(); return 1; }
4551   1B69 47            mov b, a
4552   1B6A CD 8A 0D      call fs_hideCursor
4553   1B6D             ;225 return 1; }
4554   1B6D 3E 01         mvi a, 1
4555   1B6F C1            pop b
4556   1B70 C9            ret
4557   1B71             l30227:
4558   1B71             ;226 if(c==KEY_ESC) { fs_hideCursor(); return 0; }
4559   1B71 FE 1B         cpi 27
4560   1B73 C2 7D 1B      jnz l30228
4561   1B76             ;226 { fs_hideCursor(); return 0; }
4562   1B76 47            mov b, a
4563   1B77 CD 8A 0D      call fs_hideCursor
4564   1B7A             ;226 return 0; }
4565   1B7A AF            xra a
4566   1B7B C1            pop b
4567   1B7C C9            ret
4568   1B7D             l30228:
4569   1B7D             ;227 if(clearFlag) clearFlag = 0, cmdline[0] = 0;
4570   1B7D 47            mov b, a
4571   1B7E AF            xra a
4572   1B7F B9            cmp c
4573   1B80 CA 87 1B      jz l30229
4574   1B83             ;227 clearFlag = 0, cmdline[0] = 0;
4575   1B83 4F            mov c, a
4576   1B84 32 D5 2F      sta cmdline
4577   1B87             l30229:
4578   1B87             ;228 processInput(c);
4579   1B87 78            mov a, b
4580   1B88 CD 25 0A      call processInput
4581   1B8B C3 45 1B      jmp l16
4582   1B8E             l15:
4583   1B8E C1            pop b
4584   1B8F C9            ret
4585   1B90             ; --------------------------------------------------------------
4586   1B90             packName:
4587   1B90 C5            push b
4588   1B91             ;364 memset(buf, ' ', 11);    
4589   1B91 22 D5 33      shld packName_2
4590   1B94 2A D3 33      lhld packName_1
4591   1B97 22 B9 34      shld memset_1
4592   1B9A 3E 20         mvi a, 32
4593   1B9C 32 BB 34      sta memset_2
4594   1B9F 21 0B 00      lxi h, 11
4595   1BA2 CD BD 27      call memset
4596   1BA5             ;366 i = 8;
4597   1BA5 06 08         mvi b, 8
4598   1BA7             ;367 f = '.';
4599   1BA7 3E 2E         mvi a, 46
4600   1BA9             ;368 for(;;) {
4601   1BA9 32 D8 33      sta packName_f
4602   1BAC             l40:
4603   1BAC             l39:
4604   1BAC             ;368 {
4605   1BAC 2A D5 33      lhld packName_2
4606   1BAF 7E            mov a, m
4607   1BB0             ;370 if(c == 0) return;
4608   1BB0 B7            ora a
4609   1BB1 C2 B6 1B      jnz l30230
4610   1BB4             ;370 return;
4611   1BB4 C1            pop b
4612   1BB5 C9            ret
4613   1BB6             l30230:
4614   1BB6             ;371 ++path;
4615   1BB6             ;372 if(c == f) { buf += i; i = 3; f = 0; continue; }
4616   1BB6 4F            mov c, a
4617   1BB7 3A D8 33      lda packName_f
4618   1BBA B9            cmp c
4619   1BBB 23            inx h
4620   1BBC 22 D5 33      shld packName_2
4621   1BBF C2 D6 1B      jnz l30231
4622   1BC2             ;372 { buf += i; i = 3; f = 0; continue; }
4623   1BC2 68            mov l, b
4624   1BC3 26 00         mvi h, 0
4625   1BC5 EB            xchg
4626   1BC6 2A D3 33      lhld packName_1
4627   1BC9 19            dad d
4628   1BCA             ;372 i = 3; f = 0; continue; }
4629   1BCA 06 03         mvi b, 3
4630   1BCC             ;372 f = 0; continue; }
4631   1BCC AF            xra a
4632   1BCD             ;372 continue; }
4633   1BCD 22 D3 33      shld packName_1
4634   1BD0 32 D8 33      sta packName_f
4635   1BD3 C3 AC 1B      jmp l39
4636   1BD6             l30231:
4637   1BD6             ;373 if(i) { *buf = c; ++buf; --i; }
4638   1BD6 AF            xra a
4639   1BD7 B8            cmp b
4640   1BD8 CA E2 1B      jz l30232
4641   1BDB             ;373 { *buf = c; ++buf; --i; }
4642   1BDB 79            mov a, c
4643   1BDC 77            mov m, a
4644   1BDD             ;373 ++buf; --i; }
4645   1BDD             ;373 --i; }
4646   1BDD 05            dcr b
4647   1BDE 23            inx h
4648   1BDF 22 D3 33      shld packName_1
4649   1BE2             l30232:
4650   1BE2 C3 AC 1B      jmp l40
4651   1BE5             l38:
4652   1BE5 C1            pop b
4653   1BE6 C9            ret
4654   1BE7             ; --------------------------------------------------------------
4655   1BE7             compareMask:
4656   1BE7             ;21 if(!compareMask1(fileName, mask, 8)) return 0;
4657   1BE7 22 DC 33      shld compareMask_2
4658   1BEA 2A DA 33      lhld compareMask_1
4659   1BED 22 BE 34      shld compareMask1_1
4660   1BF0 2A DC 33      lhld compareMask_2
4661   1BF3 22 C0 34      shld compareMask1_2
4662   1BF6 3E 08         mvi a, 8
4663   1BF8 CD D7 27      call compareMask1
4664   1BFB B7            ora a
4665   1BFC C2 01 1C      jnz l30233
4666   1BFF             ;21 return 0;
4667   1BFF AF            xra a
4668   1C00 C9            ret
4669   1C01             l30233:
4670   1C01             ;22 return compareMask1(fileName+8, mask+8, 3);
4671   1C01 2A DA 33      lhld compareMask_1
4672   1C04 11 08 00      lxi d, 8
4673   1C07 19            dad d
4674   1C08 22 BE 34      shld compareMask1_1
4675   1C0B 2A DC 33      lhld compareMask_2
4676   1C0E 11 08 00      lxi d, 8
4677   1C11 19            dad d
4678   1C12 22 C0 34      shld compareMask1_2
4679   1C15 3E 03         mvi a, 3
4680   1C17 CD D7 27      call compareMask1
4681   1C1A C9            ret
4682   1C1B             ; --------------------------------------------------------------
4683   1C1B             drawInput:
4684   1C1B C5            push b
4685   1C1C             ;297 cmdline_pos = strlen(cmdline);
4686   1C1C 21 D5 2F      lxi h, cmdline
4687   1C1F 32 E0 33      sta drawInput_3
4688   1C22 CD B7 0C      call strlen
4689   1C25             ;298 --max;
4690   1C25 3A E0 33      lda drawInput_3
4691   1C28 3D            dcr a
4692   1C29             ;299 if(cmdline_pos < max) cmdline_offset = 0; else cmdline_offset = cmdline_pos-max;
4693   1C29 44            mov b, h
4694   1C2A 4D            mov c, l
4695   1C2B 6F            mov l, a
4696   1C2C 26 00         mvi h, 0
4697   1C2E EB            xchg
4698   1C2F 60            mov h, b
4699   1C30 69            mov l, c
4700   1C31 32 E0 33      sta drawInput_3
4701   1C34 CD CD 29      call op_cmp16
4702   1C37 D2 43 1C      jnc l30234
4703   1C3A             ;299 cmdline_offset = 0; else cmdline_offset = cmdline_pos-max;
4704   1C3A 21 00 00      lxi h, 0
4705   1C3D 22 E7 33      shld drawInput_cmdline_offset
4706   1C40 C3 51 1C      jmp l30242
4707   1C43             l30234:
4708   1C43             ;299 cmdline_offset = cmdline_pos-max;
4709   1C43 2A E0 33      lhld drawInput_3
4710   1C46 26 00         mvi h, 0
4711   1C48 EB            xchg
4712   1C49 60            mov h, b
4713   1C4A 69            mov l, c
4714   1C4B CD 40 2A      call op_sub16_swap
4715   1C4E 22 E7 33      shld drawInput_cmdline_offset
4716   1C51             ; label1
4717   1C51             l30242:
4718   1C51             ;300 c1 = cmdline_pos - cmdline_offset;
4719   1C51 2A E7 33      lhld drawInput_cmdline_offset
4720   1C54 EB            xchg
4721   1C55 60            mov h, b
4722   1C56 69            mov l, c
4723   1C57 CD 40 2A      call op_sub16_swap
4724   1C5A             ;301 cmdline[cmdline_pos] = 0;
4725   1C5A 22 E3 33      shld drawInput_c1
4726   1C5D 21 D5 2F      lxi h, cmdline
4727   1C60 09            dad b
4728   1C61 36 00         mvi m, 0
4729   1C63             ;302 ++c1;
4730   1C63 2A E3 33      lhld drawInput_c1
4731   1C66             ;303 if(c1 > max) c1 = max;
4732   1C66 23            inx h
4733   1C67 22 E3 33      shld drawInput_c1
4734   1C6A EB            xchg
4735   1C6B 2A E0 33      lhld drawInput_3
4736   1C6E 26 00         mvi h, 0
4737   1C70 CD CD 29      call op_cmp16
4738   1C73 D2 7B 1C      jnc l30245
4739   1C76             ;303 c1 = max;
4740   1C76 26 00         mvi h, 0
4741   1C78 22 E3 33      shld drawInput_c1
4742   1C7B             l30245:
4743   1C7B             ;304 ++c1;
4744   1C7B 2A E3 33      lhld drawInput_c1
4745   1C7E             ;305 ++max;
4746   1C7E 3A E0 33      lda drawInput_3
4747   1C81 3C            inr a
4748   1C82             ;306 fs_print(x, y, max, cmdline + cmdline_offset, ' ');
4749   1C82 32 E0 33      sta drawInput_3
4750   1C85 3A DE 33      lda drawInput_1
4751   1C88 32 7C 31      sta fs_print_1
4752   1C8B 3A DF 33      lda drawInput_2
4753   1C8E 32 7D 31      sta fs_print_2
4754   1C91 3A E0 33      lda drawInput_3
4755   1C94 32 7E 31      sta fs_print_3
4756   1C97 23            inx h
4757   1C98 22 E3 33      shld drawInput_c1
4758   1C9B 2A E7 33      lhld drawInput_cmdline_offset
4759   1C9E 11 D5 2F      lxi d, cmdline
4760   1CA1 19            dad d
4761   1CA2 22 7F 31      shld fs_print_4
4762   1CA5 3E 20         mvi a, 32
4763   1CA7 CD FE 0A      call fs_print
4764   1CAA             ;309 fs_cursor(x+cmdline_pos-cmdline_offset, y);
4765   1CAA 2A E7 33      lhld drawInput_cmdline_offset
4766   1CAD EB            xchg
4767   1CAE 2A DE 33      lhld drawInput_1
4768   1CB1 26 00         mvi h, 0
4769   1CB3 09            dad b
4770   1CB4 CD 40 2A      call op_sub16_swap
4771   1CB7 7D            mov a, l
4772   1CB8 32 C4 34      sta fs_cursor_1
4773   1CBB 3A DF 33      lda drawInput_2
4774   1CBE CD 1B 28      call fs_cursor
4775   1CC1 C1            pop b
4776   1CC2 C9            ret
4777   1CC3             ; --------------------------------------------------------------
4778   1CC3             drawRect:
4779   1CC3 C5            push b
4780   1CC4             ;34 if(w <= 1) {
4781   1CC4 32 EF 33      sta drawRect_5
4782   1CC7 3A ED 33      lda drawRect_3
4783   1CCA FE 01         cpi 1
4784   1CCC CA D2 1C      jz $+6
4785   1CCF D2 0E 1D      jnc l30246
4786   1CD2             ;34 {
4787   1CD2             l133:
4788   1CD2 3A EE 33      lda drawRect_4
4789   1CD5 FE 00         cpi 0
4790   1CD7 CA 0C 1D      jz l131
4791   1CDA DA 0C 1D      jc l131
4792   1CDD             ;36 fs_print(x,y,1,"",window[0]);
4793   1CDD 3A EB 33      lda drawRect_1
4794   1CE0 32 7C 31      sta fs_print_1
4795   1CE3 3A EC 33      lda drawRect_2
4796   1CE6 32 7D 31      sta fs_print_2
4797   1CE9 21 5C 2A      lxi h, str15
4798   1CEC 22 7F 31      shld fs_print_4
4799   1CEF 3E 01         mvi a, 1
4800   1CF1 32 7E 31      sta fs_print_3
4801   1CF4 2A FA 30      lhld window
4802   1CF7 7E            mov a, m
4803   1CF8 CD FE 0A      call fs_print
4804   1CFB             l132:
4805   1CFB 3A EE 33      lda drawRect_4
4806   1CFE 3D            dcr a
4807   1CFF 32 EE 33      sta drawRect_4
4808   1D02 3A EC 33      lda drawRect_2
4809   1D05 3C            inr a
4810   1D06 32 EC 33      sta drawRect_2
4811   1D09 C3 D2 1C      jmp l133
4812   1D0C             l131:
4813   1D0C             ;37 return;
4814   1D0C C1            pop b
4815   1D0D C9            ret
4816   1D0E             l30246:
4817   1D0E             ;39 if(h <= 1) {
4818   1D0E 3A EE 33      lda drawRect_4
4819   1D11 FE 01         cpi 1
4820   1D13 CA 19 1D      jz $+6
4821   1D16 D2 3B 1D      jnc l30247
4822   1D19             ;39 {
4823   1D19 3A EB 33      lda drawRect_1
4824   1D1C 32 7C 31      sta fs_print_1
4825   1D1F 3A EC 33      lda drawRect_2
4826   1D22 32 7D 31      sta fs_print_2
4827   1D25 3A ED 33      lda drawRect_3
4828   1D28 32 7E 31      sta fs_print_3
4829   1D2B 21 5C 2A      lxi h, str15
4830   1D2E 22 7F 31      shld fs_print_4
4831   1D31 2A FA 30      lhld window
4832   1D34 23            inx h
4833   1D35 7E            mov a, m
4834   1D36 CD FE 0A      call fs_print
4835   1D39             ;41 return;
4836   1D39 C1            pop b
4837   1D3A C9            ret
4838   1D3B             l30247:
4839   1D3B             ;43 x1 = x + w - 1;
4840   1D3B 2A ED 33      lhld drawRect_3
4841   1D3E 26 00         mvi h, 0
4842   1D40 EB            xchg
4843   1D41 2A EB 33      lhld drawRect_1
4844   1D44 26 00         mvi h, 0
4845   1D46 19            dad d
4846   1D47 2B            dcx h
4847   1D48 7D            mov a, l
4848   1D49             ;44 w -= 2, h -= 2;
4849   1D49 47            mov b, a
4850   1D4A 3A ED 33      lda drawRect_3
4851   1D4D C6 FE         adi 254
4852   1D4F 32 ED 33      sta drawRect_3
4853   1D52 3A EE 33      lda drawRect_4
4854   1D55 C6 FE         adi 254
4855   1D57             ;45 fs_print(x,y,1,"\x04",window[2]);
4856   1D57 32 EE 33      sta drawRect_4
4857   1D5A 3A EB 33      lda drawRect_1
4858   1D5D 32 7C 31      sta fs_print_1
4859   1D60 3A EC 33      lda drawRect_2
4860   1D63 32 7D 31      sta fs_print_2
4861   1D66 21 5D 2A      lxi h, str44
4862   1D69 22 7F 31      shld fs_print_4
4863   1D6C 3E 01         mvi a, 1
4864   1D6E 32 7E 31      sta fs_print_3
4865   1D71 2A FA 30      lhld window
4866   1D74 23            inx h
4867   1D75 23            inx h
4868   1D76 7E            mov a, m
4869   1D77 CD FE 0A      call fs_print
4870   1D7A             ;46 if(w > 0) fs_print(x+1,y,w,"",window[3]);
4871   1D7A 3A ED 33      lda drawRect_3
4872   1D7D FE 00         cpi 0
4873   1D7F CA A8 1D      jz l30274
4874   1D82 DA A8 1D      jc l30274
4875   1D85             ;46 fs_print(x+1,y,w,"",window[3]);
4876   1D85 3A EB 33      lda drawRect_1
4877   1D88 3C            inr a
4878   1D89 32 7C 31      sta fs_print_1
4879   1D8C 3A EC 33      lda drawRect_2
4880   1D8F 32 7D 31      sta fs_print_2
4881   1D92 3A ED 33      lda drawRect_3
4882   1D95 32 7E 31      sta fs_print_3
4883   1D98 21 5C 2A      lxi h, str15
4884   1D9B 22 7F 31      shld fs_print_4
4885   1D9E 2A FA 30      lhld window
4886   1DA1 23            inx h
4887   1DA2 23            inx h
4888   1DA3 23            inx h
4889   1DA4 7E            mov a, m
4890   1DA5 CD FE 0A      call fs_print
4891   1DA8             l30274:
4892   1DA8             ;47 fs_print(x1,y,1,"\x10",window[4]);
4893   1DA8 78            mov a, b
4894   1DA9 32 7C 31      sta fs_print_1
4895   1DAC 3A EC 33      lda drawRect_2
4896   1DAF 32 7D 31      sta fs_print_2
4897   1DB2 21 5F 2A      lxi h, str45
4898   1DB5 22 7F 31      shld fs_print_4
4899   1DB8 3E 01         mvi a, 1
4900   1DBA 32 7E 31      sta fs_print_3
4901   1DBD 2A FA 30      lhld window
4902   1DC0 11 04 00      lxi d, 4
4903   1DC3 19            dad d
4904   1DC4 7E            mov a, m
4905   1DC5 CD FE 0A      call fs_print
4906   1DC8             ;48 ++y;
4907   1DC8 3A EC 33      lda drawRect_2
4908   1DCB 3C            inr a
4909   1DCC             ;49 for(;h != 0; --h, ++y) {
4910   1DCC 32 EC 33      sta drawRect_2
4911   1DCF             l137:
4912   1DCF 3A EE 33      lda drawRect_4
4913   1DD2 B7            ora a
4914   1DD3 CA 4E 1E      jz l135
4915   1DD6             ;49 {
4916   1DD6 3A EB 33      lda drawRect_1
4917   1DD9 32 7C 31      sta fs_print_1
4918   1DDC 3A EC 33      lda drawRect_2
4919   1DDF 32 7D 31      sta fs_print_2
4920   1DE2 21 5C 2A      lxi h, str15
4921   1DE5 22 7F 31      shld fs_print_4
4922   1DE8 3E 01         mvi a, 1
4923   1DEA 32 7E 31      sta fs_print_3
4924   1DED 2A FA 30      lhld window
4925   1DF0 11 05 00      lxi d, 5
4926   1DF3 19            dad d
4927   1DF4 7E            mov a, m
4928   1DF5 CD FE 0A      call fs_print
4929   1DF8             ;51 if(bg) fs_print(x+1,y,w,"",' ');
4930   1DF8 3A EF 33      lda drawRect_5
4931   1DFB B7            ora a
4932   1DFC CA 1D 1E      jz l30283
4933   1DFF             ;51 fs_print(x+1,y,w,"",' ');
4934   1DFF 3A EB 33      lda drawRect_1
4935   1E02 3C            inr a
4936   1E03 32 7C 31      sta fs_print_1
4937   1E06 3A EC 33      lda drawRect_2
4938   1E09 32 7D 31      sta fs_print_2
4939   1E0C 3A ED 33      lda drawRect_3
4940   1E0F 32 7E 31      sta fs_print_3
4941   1E12 21 5C 2A      lxi h, str15
4942   1E15 22 7F 31      shld fs_print_4
4943   1E18 3E 20         mvi a, 32
4944   1E1A CD FE 0A      call fs_print
4945   1E1D             l30283:
4946   1E1D             ;52 fs_print(x1, y, 1, "",window[6]);
4947   1E1D 78            mov a, b
4948   1E1E 32 7C 31      sta fs_print_1
4949   1E21 3A EC 33      lda drawRect_2
4950   1E24 32 7D 31      sta fs_print_2
4951   1E27 21 5C 2A      lxi h, str15
4952   1E2A 22 7F 31      shld fs_print_4
4953   1E2D 3E 01         mvi a, 1
4954   1E2F 32 7E 31      sta fs_print_3
4955   1E32 2A FA 30      lhld window
4956   1E35 11 06 00      lxi d, 6
4957   1E38 19            dad d
4958   1E39 7E            mov a, m
4959   1E3A CD FE 0A      call fs_print
4960   1E3D             l136:
4961   1E3D 3A EE 33      lda drawRect_4
4962   1E40 3D            dcr a
4963   1E41 32 EE 33      sta drawRect_4
4964   1E44 3A EC 33      lda drawRect_2
4965   1E47 3C            inr a
4966   1E48 32 EC 33      sta drawRect_2
4967   1E4B C3 CF 1D      jmp l137
4968   1E4E             l135:
4969   1E4E             ;54 fs_print(x,y,1,"",window[7]);
4970   1E4E 3A EB 33      lda drawRect_1
4971   1E51 32 7C 31      sta fs_print_1
4972   1E54 3A EC 33      lda drawRect_2
4973   1E57 32 7D 31      sta fs_print_2
4974   1E5A 21 5C 2A      lxi h, str15
4975   1E5D 22 7F 31      shld fs_print_4
4976   1E60 3E 01         mvi a, 1
4977   1E62 32 7E 31      sta fs_print_3
4978   1E65 2A FA 30      lhld window
4979   1E68 11 07 00      lxi d, 7
4980   1E6B 19            dad d
4981   1E6C 7E            mov a, m
4982   1E6D CD FE 0A      call fs_print
4983   1E70             ;55 if(w > 0) fs_print(x+1,y,w,"",window[8]);
4984   1E70 3A ED 33      lda drawRect_3
4985   1E73 FE 00         cpi 0
4986   1E75 CA 9F 1E      jz l30292
4987   1E78 DA 9F 1E      jc l30292
4988   1E7B             ;55 fs_print(x+1,y,w,"",window[8]);
4989   1E7B 3A EB 33      lda drawRect_1
4990   1E7E 3C            inr a
4991   1E7F 32 7C 31      sta fs_print_1
4992   1E82 3A EC 33      lda drawRect_2
4993   1E85 32 7D 31      sta fs_print_2
4994   1E88 3A ED 33      lda drawRect_3
4995   1E8B 32 7E 31      sta fs_print_3
4996   1E8E 21 5C 2A      lxi h, str15
4997   1E91 22 7F 31      shld fs_print_4
4998   1E94 2A FA 30      lhld window
4999   1E97 11 08 00      lxi d, 8
5000   1E9A 19            dad d
5001   1E9B 7E            mov a, m
5002   1E9C CD FE 0A      call fs_print
5003   1E9F             l30292:
5004   1E9F             ;56 fs_print(x1,y,1,"",window[9]);
5005   1E9F 78            mov a, b
5006   1EA0 32 7C 31      sta fs_print_1
5007   1EA3 3A EC 33      lda drawRect_2
5008   1EA6 32 7D 31      sta fs_print_2
5009   1EA9 21 5C 2A      lxi h, str15
5010   1EAC 22 7F 31      shld fs_print_4
5011   1EAF 3E 01         mvi a, 1
5012   1EB1 32 7E 31      sta fs_print_3
5013   1EB4 2A FA 30      lhld window
5014   1EB7 11 09 00      lxi d, 9
5015   1EBA 19            dad d
5016   1EBB 7E            mov a, m
5017   1EBC CD FE 0A      call fs_print
5018   1EBF C1            pop b
5019   1EC0 C9            ret
5020   1EC1             ; --------------------------------------------------------------
5021   1EC1             sub32_16:
5022   1EC1             ;4 asm {
5023   1EC1 22 F3 33      shld sub32_16_2
5024   1EC4 2A F1 33        lhld sub32_16_1
5025   1EC7 EB              xchg
5026   1EC8 2A F3 33        lhld sub32_16_2
5027   1ECB               
5028   1ECB 1A              ldax d
5029   1ECC 95              sub l
5030   1ECD 12              stax d
5031   1ECE                
5032   1ECE 13              inx d
5033   1ECF 1A              ldax d
5034   1ED0 9C              sbb h
5035   1ED1 12              stax d
5036   1ED2             
5037   1ED2 13              inx d
5038   1ED3 1A              ldax d
5039   1ED4 DE 00           sbi 0
5040   1ED6 12              stax d
5041   1ED7             
5042   1ED7 13              inx d
5043   1ED8 1A              ldax d
5044   1ED9 DE 00           sbi 0
5045   1EDB 12              stax d
5046   1EDC               
5047   1EDC C9            ret
5048   1EDD             ; --------------------------------------------------------------
5049   1EDD             memswap:
5050   1EDD             ;2 asm {
5051   1EDD 22 F9 33      shld memswap_3
5052   1EE0 C5              push b
5053   1EE1                 ; de = count
5054   1EE1 EB              xchg
5055   1EE2                 ; bc = from
5056   1EE2 2A F7 33        lhld memswap_2
5057   1EE5 4D              mov c, l
5058   1EE6 44              mov b, h
5059   1EE7                 ; hl = to
5060   1EE7 2A F5 33        lhld memswap_1
5061   1EEA             memswap_l1:
5062   1EEA                 ; if(cnt==0) return
5063   1EEA 7A              mov a, d
5064   1EEB B3              ora e
5065   1EEC CA FD 1E        jz memswap_l2
5066   1EEF                 ; *dest = *src
5067   1EEF 0A              ldax b
5068   1EF0 32 F6 1E        sta memswap_v1
5069   1EF3 7E              mov a, m
5070   1EF4 02              stax b
5071   1EF5 36              .db 36h ; mvi m, 0
5072   1EF6             memswap_v1:
5073   1EF6 00              .db 0    
5074   1EF7                 ; dest++, src++, cnt--
5075   1EF7 23              inx h
5076   1EF8 03              inx b
5077   1EF9 1B              dcx d
5078   1EFA                 ; loop
5079   1EFA C3 EA 1E        jmp memswap_l1
5080   1EFD             memswap_l2:
5081   1EFD C1              pop b
5082   1EFE               
5083   1EFE C9            ret
5084   1EFF             ; --------------------------------------------------------------
5085   1EFF             directCursor:
5086   1EFF             ;1 ((uchar*)0xEF00)
5087   1EFF 32 FC 33      sta directCursor_2
5088   1F02 3E 80         mvi a, 128
5089   1F04 32 01 EF      sta 61185
5090   1F07             ;1 ((uchar*)0xEF00)
5091   1F07 3A FB 33      lda directCursor_1
5092   1F0A 32 00 EF      sta 61184
5093   1F0D             ;1 ((uchar*)0xEF00)
5094   1F0D 3A FC 33      lda directCursor_2
5095   1F10 32 00 EF      sta 61184
5096   1F13 C9            ret
5097   1F14             ; --------------------------------------------------------------
5098   1F14             i2s:
5099   1F14             ;4 buf += n;  
5100   1F14 2A 01 34      lhld i2s_3
5101   1F17 EB            xchg
5102   1F18 2A FD 33      lhld i2s_1
5103   1F1B 19            dad d
5104   1F1C             ;5 *buf = 0;
5105   1F1C 36 00         mvi m, 0
5106   1F1E             ;6 while(1) {
5107   1F1E 32 03 34      sta i2s_4
5108   1F21 22 FD 33      shld i2s_1
5109   1F24             l176:
5110   1F24             ;6 {
5111   1F24 2A FF 33      lhld i2s_2
5112   1F27 11 0A 00      lxi d, 10
5113   1F2A CD FC 29      call op_div16_swap
5114   1F2D             ;8 --buf;
5115   1F2D 22 FF 33      shld i2s_2
5116   1F30 2A FD 33      lhld i2s_1
5117   1F33             ;9 *buf = "0123456789ABCDEF"[op_div16_mod];
5118   1F33 2B            dcx h
5119   1F34 22 FD 33      shld i2s_1
5120   1F37 E5            push h
5121   1F38 2A F9 29      lhld op_div16_mod
5122   1F3B 11 40 2B      lxi d, str66
5123   1F3E 19            dad d
5124   1F3F 7E            mov a, m
5125   1F40 D1            pop d
5126   1F41 12            stax d
5127   1F42             ;10 --n;
5128   1F42 2A 01 34      lhld i2s_3
5129   1F45             ;11 if(n == 0) return;
5130   1F45 2B            dcx h
5131   1F46 7C            mov a, h
5132   1F47 B5            ora l
5133   1F48 22 01 34      shld i2s_3
5134   1F4B C8            rz
5135   1F4C             ;11 return;
5136   1F4C             l30301:
5137   1F4C             ;12 if(v == 0) break;
5138   1F4C 2A FF 33      lhld i2s_2
5139   1F4F 7C            mov a, h
5140   1F50 B5            ora l
5141   1F51 C2 57 1F      jnz l30309
5142   1F54             ;12 break;
5143   1F54 C3 5A 1F      jmp l175
5144   1F57             l30309:
5145   1F57 C3 24 1F      jmp l176
5146   1F5A             l175:
5147   1F5A             ;14 while(1) {
5148   1F5A             l178:
5149   1F5A             ;14 {
5150   1F5A 2A FD 33      lhld i2s_1
5151   1F5D             ;16 *buf = spc;
5152   1F5D 3A 03 34      lda i2s_4
5153   1F60 2B            dcx h
5154   1F61 77            mov m, a
5155   1F62             ;17 if(--n == 0) break;
5156   1F62 22 FD 33      shld i2s_1
5157   1F65 2A 01 34      lhld i2s_3
5158   1F68 2B            dcx h
5159   1F69 7C            mov a, h
5160   1F6A B5            ora l
5161   1F6B 22 01 34      shld i2s_3
5162   1F6E C2 74 1F      jnz l30312
5163   1F71             ;17 break;
5164   1F71 C3 77 1F      jmp l177
5165   1F74             l30312:
5166   1F74 C3 5A 1F      jmp l178
5167   1F77             l177:
5168   1F77 C9            ret
5169   1F78             ; --------------------------------------------------------------
5170   1F78             rand:
5171   1F78             ;4 asm {
5172   1F78 3A 1E 31        LDA rand_seed
5173   1F7B 5F              mov e,a
5174   1F7C 87              add a
5175   1F7D 87              add a
5176   1F7E 83              add e
5177   1F7F 3C              inr a
5178   1F80 32 1E 31        sta rand_seed
5179   1F83               
5180   1F83 C9            ret
5181   1F84             ; --------------------------------------------------------------
5182   1F84             cmpFileInfo:
5183   1F84 C5            push b
5184   1F85             ;317 i = (a->fattrib&0x10);
5185   1F85 22 06 34      shld cmpFileInfo_2
5186   1F88 2A 04 34      lhld cmpFileInfo_1
5187   1F8B 11 0B 00      lxi d, 11
5188   1F8E 19            dad d
5189   1F8F 7E            mov a, m
5190   1F90 E6 10         ani 16
5191   1F92             ;318 j = (b->fattrib&0x10);
5192   1F92 2A 06 34      lhld cmpFileInfo_2
5193   1F95 11 0B 00      lxi d, 11
5194   1F98 19            dad d
5195   1F99 47            mov b, a
5196   1F9A 7E            mov a, m
5197   1F9B E6 10         ani 16
5198   1F9D             ;319 if(i<j) return 1;
5199   1F9D B8            cmp b
5200   1F9E 32 09 34      sta cmpFileInfo_j
5201   1FA1 CA AB 1F      jz l30393
5202   1FA4 DA AB 1F      jc l30393
5203   1FA7             ;319 return 1;
5204   1FA7 3E 01         mvi a, 1
5205   1FA9 C1            pop b
5206   1FAA C9            ret
5207   1FAB             l30393:
5208   1FAB             ;320 if(j<i) return 0;
5209   1FAB B8            cmp b
5210   1FAC D2 B2 1F      jnc l30402
5211   1FAF             ;320 return 0;
5212   1FAF AF            xra a
5213   1FB0 C1            pop b
5214   1FB1 C9            ret
5215   1FB2             l30402:
5216   1FB2             ;321 if(1==memcmp(a->fname, b->fname, sizeof(a->fname))) return 1;
5217   1FB2 2A 04 34      lhld cmpFileInfo_1
5218   1FB5 22 37 32      shld memcmp_1
5219   1FB8 2A 06 34      lhld cmpFileInfo_2
5220   1FBB 22 39 32      shld memcmp_2
5221   1FBE 21 0B 00      lxi h, 11
5222   1FC1 CD DC 10      call memcmp
5223   1FC4 3D            dcr a
5224   1FC5 C2 CC 1F      jnz l30411
5225   1FC8             ;321 return 1;
5226   1FC8 3E 01         mvi a, 1
5227   1FCA C1            pop b
5228   1FCB C9            ret
5229   1FCC             l30411:
5230   1FCC             ;322 return 0;
5231   1FCC AF            xra a
5232   1FCD C1            pop b
5233   1FCE C9            ret
5234   1FCF             ; --------------------------------------------------------------
5235   1FCF             drawColumn:
5236   1FCF C5            push b
5237   1FD0             ;178 register ushort n = panelA.offset + i * rowsCnt;
5238   1FD0 2A D7 30      lhld rowsCnt
5239   1FD3 26 00         mvi h, 0
5240   1FD5 EB            xchg
5241   1FD6 6F            mov l, a
5242   1FD7 26 00         mvi h, 0
5243   1FD9 32 0A 34      sta drawColumn_1
5244   1FDC CD D3 29      call op_mul16
5245   1FDF EB            xchg
5246   1FE0 2A C5 2E      lhld (panelA)+(260)
5247   1FE3 19            dad d
5248   1FE4             ;179 FileInfo* f = panelA.files1 + n;  
5249   1FE4 22 0E 34      shld drawColumn_n
5250   1FE7 54            mov d, h
5251   1FE8 5D            mov e, l
5252   1FE9 29            dad h
5253   1FEA 29            dad h
5254   1FEB 19            dad d
5255   1FEC 29            dad h
5256   1FED 29            dad h
5257   1FEE EB            xchg
5258   1FEF 2A C1 2D      lhld panelA
5259   1FF2 19            dad d
5260   1FF3             ;181 xx = i * 15 + 2 + activePanel; yy = 2;
5261   1FF3 22 10 34      shld drawColumn_f
5262   1FF6 2A 0A 34      lhld drawColumn_1
5263   1FF9 26 00         mvi h, 0
5264   1FFB 54            mov d, h
5265   1FFC 5D            mov e, l
5266   1FFD 29            dad h
5267   1FFE 19            dad d
5268   1FFF 29            dad h
5269   2000 19            dad d
5270   2001 29            dad h
5271   2002 19            dad d
5272   2003 23            inx h
5273   2004 23            inx h
5274   2005 EB            xchg
5275   2006 2A F2 30      lhld activePanel
5276   2009 26 00         mvi h, 0
5277   200B 19            dad d
5278   200C 7D            mov a, l
5279   200D             ;181 yy = 2;
5280   200D 06 02         mvi b, 2
5281   200F             ;182 for(y=rowsCnt; y; --y, ++yy) {
5282   200F 32 0C 34      sta drawColumn_xx
5283   2012 3A D7 30      lda rowsCnt
5284   2015 4F            mov c, a
5285   2016             l141:
5286   2016 AF            xra a
5287   2017 B9            cmp c
5288   2018 CA 6B 20      jz l139
5289   201B             ;182 {
5290   201B 2A C7 2E      lhld (panelA)+(262)
5291   201E EB            xchg
5292   201F 2A 0E 34      lhld drawColumn_n
5293   2022 CD CD 29      call op_cmp16
5294   2025 DA 45 20      jc l30414
5295   2028             ;183 {
5296   2028 3A 0C 34      lda drawColumn_xx
5297   202B 32 7C 31      sta fs_print_1
5298   202E 78            mov a, b
5299   202F 32 7D 31      sta fs_print_2
5300   2032 21 5C 2A      lxi h, str15
5301   2035 22 7F 31      shld fs_print_4
5302   2038 3E 0C         mvi a, 12
5303   203A 32 7E 31      sta fs_print_3
5304   203D 3E 20         mvi a, 32
5305   203F CD FE 0A      call fs_print
5306   2042             ;185 continue;
5307   2042 C3 66 20      jmp l140
5308   2045             l30414:
5309   2045             ;187 drawFile2(xx, yy, f);
5310   2045 3A 0C 34      lda drawColumn_xx
5311   2048 32 A6 34      sta drawFile2_1
5312   204B 78            mov a, b
5313   204C 32 A7 34      sta drawFile2_2
5314   204F 2A 10 34      lhld drawColumn_f
5315   2052 CD 1B 27      call drawFile2
5316   2055             ;188 ++f; ++n;
5317   2055 2A 10 34      lhld drawColumn_f
5318   2058 11 14 00      lxi d, 20
5319   205B 19            dad d
5320   205C             ;188 ++n;
5321   205C 22 10 34      shld drawColumn_f
5322   205F 2A 0E 34      lhld drawColumn_n
5323   2062 23            inx h
5324   2063 22 0E 34      shld drawColumn_n
5325   2066             l140:
5326   2066 0D            dcr c
5327   2067 04            inr b
5328   2068 C3 16 20      jmp l141
5329   206B             l139:
5330   206B C1            pop b
5331   206C C9            ret
5332   206D             ; --------------------------------------------------------------
5333   206D             add32_32:
5334   206D             ;4 asm {   
5335   206D 22 14 34      shld add32_32_2
5336   2070                
5337   2070                 ; hl = add32_32_2   
5338   2070 EB              xchg
5339   2071 2A 12 34        lhld add32_32_1
5340   2074 EB              xchg
5341   2075             
5342   2075 1A              ldax d
5343   2076 86              add  m
5344   2077 12              stax d
5345   2078 23              inx  h
5346   2079 13              inx  d
5347   207A 1A              ldax d
5348   207B 8E              adc  m
5349   207C 12              stax d
5350   207D 23              inx  h
5351   207E 13              inx  d
5352   207F 1A              ldax d
5353   2080 8E              adc  m
5354   2081 12              stax d
5355   2082 23              inx  h
5356   2083 13              inx  d
5357   2084 1A              ldax d
5358   2085 8E              adc  m
5359   2086 12              stax d
5360   2087               
5361   2087 C9            ret
5362   2088             ; --------------------------------------------------------------
5363   2088             drawFilesCountInt:
5364   2088 C5            push b
5365   2089             ;93 x = 1 + activePanel; y = 4 + rowsCnt;
5366   2089 3A F2 30      lda activePanel
5367   208C 3C            inr a
5368   208D             ;93 y = 4 + rowsCnt;
5369   208D 47            mov b, a
5370   208E 3A D7 30      lda rowsCnt
5371   2091 C6 04         adi 4
5372   2093             ;95 i2s32(buf, total, 10, ' ');
5373   2093 22 18 34      shld drawFilesCountInt_2
5374   2096 21 1D 34      lxi h, drawFilesCountInt_buf
5375   2099 22 29 34      shld i2s32_1
5376   209C 2A 16 34      lhld drawFilesCountInt_1
5377   209F 22 2B 34      shld i2s32_2
5378   20A2 21 0A 00      lxi h, 10
5379   20A5 22 2D 34      shld i2s32_3
5380   20A8 32 1C 34      sta drawFilesCountInt_y
5381   20AB 3E 20         mvi a, 32
5382   20AD CD 74 21      call i2s32
5383   20B0             ;96 fs_print(x, y, 12, buf, 0);
5384   20B0 78            mov a, b
5385   20B1 32 7C 31      sta fs_print_1
5386   20B4 3A 1C 34      lda drawFilesCountInt_y
5387   20B7 32 7D 31      sta fs_print_2
5388   20BA 21 1D 34      lxi h, drawFilesCountInt_buf
5389   20BD 22 7F 31      shld fs_print_4
5390   20C0 3E 0C         mvi a, 12
5391   20C2 32 7E 31      sta fs_print_3
5392   20C5 AF            xra a
5393   20C6 CD FE 0A      call fs_print
5394   20C9             ;98 fs_print(x+11, y, 12, "bajt w    ", 0);
5395   20C9 78            mov a, b
5396   20CA C6 0B         adi 11
5397   20CC 32 7C 31      sta fs_print_1
5398   20CF 3A 1C 34      lda drawFilesCountInt_y
5399   20D2 32 7D 31      sta fs_print_2
5400   20D5 21 09 2C      lxi h, str49
5401   20D8 22 7F 31      shld fs_print_4
5402   20DB 3E 0C         mvi a, 12
5403   20DD 32 7E 31      sta fs_print_3
5404   20E0 AF            xra a
5405   20E1 CD FE 0A      call fs_print
5406   20E4             ;100 if(filesCnt < 1000) {
5407   20E4 2A 18 34      lhld drawFilesCountInt_2
5408   20E7 11 E8 03      lxi d, 1000
5409   20EA CD CD 29      call op_cmp16
5410   20ED D2 22 21      jnc l30417
5411   20F0             ;100 {
5412   20F0 21 1D 34      lxi h, drawFilesCountInt_buf
5413   20F3 22 FD 33      shld i2s_1
5414   20F6 2A 18 34      lhld drawFilesCountInt_2
5415   20F9 22 FF 33      shld i2s_2
5416   20FC 21 03 00      lxi h, 3
5417   20FF 22 01 34      shld i2s_3
5418   2102 3E 20         mvi a, 32
5419   2104 CD 14 1F      call i2s
5420   2107             ;102 fs_print(x + 18, y, 3, buf, 0);
5421   2107 78            mov a, b
5422   2108 C6 12         adi 18
5423   210A 32 7C 31      sta fs_print_1
5424   210D 3A 1C 34      lda drawFilesCountInt_y
5425   2110 32 7D 31      sta fs_print_2
5426   2113 21 1D 34      lxi h, drawFilesCountInt_buf
5427   2116 22 7F 31      shld fs_print_4
5428   2119 3E 03         mvi a, 3
5429   211B 32 7E 31      sta fs_print_3
5430   211E AF            xra a
5431   211F CD FE 0A      call fs_print
5432   2122             l30417:
5433   2122             ;105 v = filesCnt % 100;
5434   2122 2A 18 34      lhld drawFilesCountInt_2
5435   2125 11 64 00      lxi d, 100
5436   2128 CD 38 2A      call op_mod16_swap
5437   212B 7D            mov a, l
5438   212C             ;106 fs_print(x + 22, y, 16, (!(v >= 10 && v < 20) && v % 10 == 1) ? "fajle " : "fajlah ", 0);
5439   212C 4F            mov c, a
5440   212D 78            mov a, b
5441   212E C6 16         adi 22
5442   2130 32 7C 31      sta fs_print_1
5443   2133 3A 1C 34      lda drawFilesCountInt_y
5444   2136 32 7D 31      sta fs_print_2
5445   2139 79            mov a, c
5446   213A FE 0A         cpi 10
5447   213C DA 44 21      jc l30498
5448   213F FE 14         cpi 20
5449   2141 DA 5C 21      jc l30497
5450   2144             l30498:
5451   2144 6F            mov l, a
5452   2145 26 00         mvi h, 0
5453   2147 11 0A 00      lxi d, 10
5454   214A CD 38 2A      call op_mod16_swap
5455   214D 11 01 00      lxi d, 1
5456   2150 CD CD 29      call op_cmp16
5457   2153 C2 5C 21      jnz l30497
5458   2156 21 49 2C      lxi h, str50
5459   2159 C3 5F 21      jmp l30496
5460   215C             ; label1
5461   215C             l30497:
5462   215C 21 41 2C      lxi h, str51
5463   215F             ; label1
5464   215F             l30496:
5465   215F 22 7F 31      shld fs_print_4
5466   2162 3E 10         mvi a, 16
5467   2164 32 7E 31      sta fs_print_3
5468   2167 AF            xra a
5469   2168 CD FE 0A      call fs_print
5470   216B C1            pop b
5471   216C C9            ret
5472   216D             ; --------------------------------------------------------------
5473   216D             drawFileInfoDir:
5474   216D             ;208 drawFileInfo1("     <DIR>");
5475   216D 21 74 2A      lxi h, str54
5476   2170 CD EC 21      call drawFileInfo1
5477   2173 C9            ret
5478   2174             ; --------------------------------------------------------------
5479   2174             i2s32:
5480   2174             ;7 set32(&v, src);
5481   2174 21 30 34      lxi h, i2s32_v
5482   2177 22 C6 34      shld set32_1
5483   217A 2A 2B 34      lhld i2s32_2
5484   217D 32 2F 34      sta i2s32_4
5485   2180 CD 2F 28      call set32
5486   2183             ;9 buf += n;  
5487   2183 2A 2D 34      lhld i2s32_3
5488   2186 EB            xchg
5489   2187 2A 29 34      lhld i2s32_1
5490   218A 19            dad d
5491   218B             ;10 *buf = 0;
5492   218B 36 00         mvi m, 0
5493   218D             ;12 while(1) {
5494   218D 22 29 34      shld i2s32_1
5495   2190             l172:
5496   2190             ;12 {
5497   2190 21 30 34      lxi h, i2s32_v
5498   2193 22 CA 34      shld div32_16_1
5499   2196 21 0A 00      lxi h, 10
5500   2199 CD 45 28      call div32_16
5501   219C             ;14 --buf;
5502   219C 2A 29 34      lhld i2s32_1
5503   219F             ;15 *buf = "0123456789ABCDEF"[op_div16_mod];
5504   219F 2B            dcx h
5505   21A0 22 29 34      shld i2s32_1
5506   21A3 E5            push h
5507   21A4 2A F9 29      lhld op_div16_mod
5508   21A7 11 40 2B      lxi d, str66
5509   21AA 19            dad d
5510   21AB 7E            mov a, m
5511   21AC D1            pop d
5512   21AD 12            stax d
5513   21AE             ;16 if(--n == 0) return;
5514   21AE 2A 2D 34      lhld i2s32_3
5515   21B1 2B            dcx h
5516   21B2 7C            mov a, h
5517   21B3 B5            ora l
5518   21B4 22 2D 34      shld i2s32_3
5519   21B7 C8            rz
5520   21B8             ;16 return;
5521   21B8             l30507:
5522   21B8             ;17 if(((ushort*)&v)[0] == 0 && ((ushort*)&v)[1] == 0) break;
5523   21B8 2A 30 34      lhld i2s32_v
5524   21BB 7C            mov a, h
5525   21BC B5            ora l
5526   21BD C2 CB 21      jnz l30515
5527   21C0 2A 32 34      lhld (i2s32_v)+(2)
5528   21C3 7C            mov a, h
5529   21C4 B5            ora l
5530   21C5 C2 CB 21      jnz l30515
5531   21C8             ;17 break;
5532   21C8 C3 CE 21      jmp l171
5533   21CB             l30515:
5534   21CB C3 90 21      jmp l172
5535   21CE             l171:
5536   21CE             ;20 while(1) {
5537   21CE             l174:
5538   21CE             ;20 {
5539   21CE 2A 29 34      lhld i2s32_1
5540   21D1             ;22 *buf = spc;
5541   21D1 3A 2F 34      lda i2s32_4
5542   21D4 2B            dcx h
5543   21D5 77            mov m, a
5544   21D6             ;23 if(--n == 0) break;
5545   21D6 22 29 34      shld i2s32_1
5546   21D9 2A 2D 34      lhld i2s32_3
5547   21DC 2B            dcx h
5548   21DD 7C            mov a, h
5549   21DE B5            ora l
5550   21DF 22 2D 34      shld i2s32_3
5551   21E2 C2 E8 21      jnz l30518
5552   21E5             ;23 break;
5553   21E5 C3 EB 21      jmp l173
5554   21E8             l30518:
5555   21E8 C3 CE 21      jmp l174
5556   21EB             l173:
5557   21EB C9            ret
5558   21EC             ; --------------------------------------------------------------
5559   21EC             drawFileInfo1:
5560   21EC             ;202 fs_print(2+activePanel, rowsCnt+3, 10, buf, ' ');
5561   21EC 3A F2 30      lda activePanel
5562   21EF C6 02         adi 2
5563   21F1 32 7C 31      sta fs_print_1
5564   21F4 3A D7 30      lda rowsCnt
5565   21F7 C6 03         adi 3
5566   21F9 32 7D 31      sta fs_print_2
5567   21FC 22 7F 31      shld fs_print_4
5568   21FF 3E 0A         mvi a, 10
5569   2201 32 7E 31      sta fs_print_3
5570   2204 3E 20         mvi a, 32
5571   2206 22 34 34      shld drawFileInfo1_1
5572   2209 CD FE 0A      call fs_print
5573   220C C9            ret
5574   220D             ; --------------------------------------------------------------
5575   220D             drawFileInfo2:
5576   220D             ;215 fs_print(13+activePanel, rowsCnt+3, 16, buf, ' ');
5577   220D 3A F2 30      lda activePanel
5578   2210 C6 0D         adi 13
5579   2212 32 7C 31      sta fs_print_1
5580   2215 3A D7 30      lda rowsCnt
5581   2218 C6 03         adi 3
5582   221A 32 7D 31      sta fs_print_2
5583   221D 22 7F 31      shld fs_print_4
5584   2220 3E 10         mvi a, 16
5585   2222 32 7E 31      sta fs_print_3
5586   2225 87            add a
5587   2226 22 36 34      shld drawFileInfo2_1
5588   2229 CD FE 0A      call fs_print
5589   222C C9            ret
5590   222D             ; --------------------------------------------------------------
5591   222D             drawWindowTextCenter:
5592   222D             ;242 fs_print((fs_screenWidth - strlen(text)) >> 1, windowY + y + 2, 64, text, 0);
5593   222D 22 39 34      shld drawWindowTextCenter_2
5594   2230 CD B7 0C      call strlen
5595   2233 EB            xchg
5596   2234 2A 11 31      lhld fs_screenWidth
5597   2237 26 00         mvi h, 0
5598   2239 CD 40 2A      call op_sub16_swap
5599   223C 11 01 00      lxi d, 1
5600   223F CD 48 2A      call op_shr16_swap
5601   2242 7D            mov a, l
5602   2243 32 7C 31      sta fs_print_1
5603   2246 2A 38 34      lhld drawWindowTextCenter_1
5604   2249 26 00         mvi h, 0
5605   224B EB            xchg
5606   224C 2A F8 30      lhld windowY
5607   224F 26 00         mvi h, 0
5608   2251 19            dad d
5609   2252 23            inx h
5610   2253 23            inx h
5611   2254 7D            mov a, l
5612   2255 32 7D 31      sta fs_print_2
5613   2258 2A 39 34      lhld drawWindowTextCenter_2
5614   225B 22 7F 31      shld fs_print_4
5615   225E 3E 40         mvi a, 64
5616   2260 32 7E 31      sta fs_print_3
5617   2263 AF            xra a
5618   2264 CD FE 0A      call fs_print
5619   2267 C9            ret
5620   2268             ; --------------------------------------------------------------
5621   2268             memcpy_back:
5622   2268             ;2 asm {
5623   2268 22 3F 34      shld memcpy_back_3
5624   226B                 ; if(cnt==0) return
5625   226B 7C              mov a, h
5626   226C B5              ora l
5627   226D C8              rz
5628   226E                 ; start
5629   226E C5              push b
5630   226F                 ; de = count
5631   226F EB              xchg
5632   2270                 ; bc = from
5633   2270 2A 3D 34        lhld memcpy_back_2
5634   2273 19              dad d
5635   2274 4D              mov c, l
5636   2275 44              mov b, h
5637   2276                 ; hl = to
5638   2276 2A 3B 34        lhld memcpy_back_1
5639   2279 19              dad d
5640   227A                 ; enter loop
5641   227A 14              inr d
5642   227B AF              xra a
5643   227C B3              ora e
5644   227D CA 88 22        jz memcpy_back_l2
5645   2280             memcpy_back_l1:
5646   2280                 ; dest--, src--
5647   2280 2B              dcx h
5648   2281 0B              dcx b
5649   2282                 ; *dest = *src
5650   2282 0A              ldax b
5651   2283 77              mov m, a
5652   2284                 ; while(cnt)
5653   2284 1D              dcr e
5654   2285 C2 80 22        jnz memcpy_back_l1
5655   2288             memcpy_back_l2:
5656   2288 15              dcr d
5657   2289 C2 80 22        jnz memcpy_back_l1
5658   228C C1              pop b
5659   228D               
5660   228D C9            ret
5661   228E             ; --------------------------------------------------------------
5662   228E             fs_mkdir:
5663   228E C5            push b
5664   228F             ;288 fs_print(0,0,64,name,0);
5665   228F 22 7F 31      shld fs_print_4
5666   2292 AF            xra a
5667   2293 32 7C 31      sta fs_print_1
5668   2296 32 7D 31      sta fs_print_2
5669   2299 3E 40         mvi a, 64
5670   229B 32 7E 31      sta fs_print_3
5671   229E AF            xra a
5672   229F 22 41 34      shld fs_mkdir_1
5673   22A2 CD FE 0A      call fs_print
5674   22A5             ;289 for(i=5000; i; --i);
5675   22A5 01 88 13      lxi b, 5000
5676   22A8             l165:
5677   22A8             l164:
5678   22A8 0B            dcx b
5679   22A9 60            mov h, b
5680   22AA 69            mov l, c
5681   22AB 7C            mov a, h
5682   22AC B5            ora l
5683   22AD C2 A8 22      jnz l165
5684   22B0             ;290 return 0;
5685   22B0 AF            xra a
5686   22B1 C1            pop b
5687   22B2 C9            ret
5688   22B3             ; --------------------------------------------------------------
5689   22B3             saveState:
5690   22B3             ;713 if(fs_create(fs_selfName) && fs_open(fs_selfName)) return;
5691   22B3 2A 02 31      lhld fs_selfName
5692   22B6 CD 98 28      call fs_create
5693   22B9 B7            ora a
5694   22BA CA C5 22      jz l30519
5695   22BD 2A 02 31      lhld fs_selfName
5696   22C0 CD 18 0D      call fs_open
5697   22C3 B7            ora a
5698   22C4 C0            rnz
5699   22C5             ;713 return;
5700   22C5             l30519:
5701   22C5             ;714 fs_write(getSel()->fname, 11);
5702   22C5 CD 85 10      call getSel
5703   22C8 22 D0 34      shld fs_write_1
5704   22CB 21 0B 00      lxi h, 11
5705   22CE CD A9 28      call fs_write
5706   22D1             ;715 fs_write(&activePanel, 1);
5707   22D1 21 F2 30      lxi h, activePanel
5708   22D4 22 D0 34      shld fs_write_1
5709   22D7 21 01 00      lxi h, 1
5710   22DA CD A9 28      call fs_write
5711   22DD             ;716 fs_write(panelA.path1, 256);
5712   22DD 21 C3 2D      lxi h, (panelA)+(2)
5713   22E0 22 D0 34      shld fs_write_1
5714   22E3 21 00 01      lxi h, 256
5715   22E6 CD A9 28      call fs_write
5716   22E9             ;717 fs_write(panelB.path1, 256);
5717   22E9 21 CD 2E      lxi h, (panelB)+(2)
5718   22EC 22 D0 34      shld fs_write_1
5719   22EF 21 00 01      lxi h, 256
5720   22F2 CD A9 28      call fs_write
5721   22F5 C9            ret
5722   22F6             ; --------------------------------------------------------------
5723   22F6             fs_exec:
5724   22F6             ;315 return 1;
5725   22F6 3E 01         mvi a, 1
5726   22F8 22 47 34      shld fs_exec_2
5727   22FB C9            ret
5728   22FC             ; --------------------------------------------------------------
5729   22FC             strchr:
5730   22FC             ;2 asm {
5731   22FC 32 4B 34      sta strchr_2
5732   22FF 57              mov d, a
5733   2300 2A 49 34        lhld strchr_1
5734   2303             strchr_l1:
5735   2303                 ; *dest = *src    
5736   2303 7E              mov a, m
5737   2304 BA              cmp d
5738   2305 C8              rz
5739   2306 23              inx h
5740   2307 B7              ora a
5741   2308 C2 03 23        jnz strchr_l1
5742   230B 67              mov h, a
5743   230C 6F              mov l, a
5744   230D               
5745   230D C9            ret
5746   230E             ; --------------------------------------------------------------
5747   230E             dropPathInt:
5748   230E C5            push b
5749   230F             ;525 p = getname(src);
5750   230F 22 4E 34      shld dropPathInt_2
5751   2312 2A 4C 34      lhld dropPathInt_1
5752   2315 CD 3B 23      call getName
5753   2318             ;528 if(preparedName) packName(preparedName, p);
5754   2318 44            mov b, h
5755   2319 4D            mov c, l
5756   231A 2A 4E 34      lhld dropPathInt_2
5757   231D 7C            mov a, h
5758   231E B5            ora l
5759   231F CA 2A 23      jz l30520
5760   2322             ;528 packName(preparedName, p);
5761   2322 22 D3 33      shld packName_1
5762   2325 60            mov h, b
5763   2326 69            mov l, c
5764   2327 CD 90 1B      call packName
5765   232A             l30520:
5766   232A             ;531 if(p != src) --p;
5767   232A 60            mov h, b
5768   232B 69            mov l, c
5769   232C EB            xchg
5770   232D 2A 4C 34      lhld dropPathInt_1
5771   2330 CD CD 29      call op_cmp16
5772   2333 CA 37 23      jz l30529
5773   2336             ;531 --p;
5774   2336 0B            dcx b
5775   2337             l30529:
5776   2337             ;532 *p = 0;
5777   2337 AF            xra a
5778   2338 02            stax b
5779   2339 C1            pop b
5780   233A C9            ret
5781   233B             ; --------------------------------------------------------------
5782   233B             getName:
5783   233B C5            push b
5784   233C             ;512 for(p = name; *p; p++)
5785   233C 22 52 34      shld getName_1
5786   233F 44            mov b, h
5787   2340 4D            mov c, l
5788   2341             l60:
5789   2341 0A            ldax b
5790   2342 B7            ora a
5791   2343 CA 56 23      jz l58
5792   2346             ;513 if(*p == '/')
5793   2346 0A            ldax b
5794   2347 FE 2F         cpi 47
5795   2349 C2 52 23      jnz l30532
5796   234C             ;514 name = p+1;
5797   234C 60            mov h, b
5798   234D 69            mov l, c
5799   234E 23            inx h
5800   234F 22 52 34      shld getName_1
5801   2352             l30532:
5802   2352             l59:
5803   2352 03            inx b
5804   2353 C3 41 23      jmp l60
5805   2356             l58:
5806   2356             ;515 return name;
5807   2356 2A 52 34      lhld getName_1
5808   2359 C1            pop b
5809   235A C9            ret
5810   235B             ; --------------------------------------------------------------
5811   235B             applyMask:
5812   235B             ;160 applyMask1(dest, mask, 8);
5813   235B 22 58 34      shld applyMask_2
5814   235E 2A 56 34      lhld applyMask_1
5815   2361 22 D8 34      shld applyMask1_1
5816   2364 2A 58 34      lhld applyMask_2
5817   2367 22 DA 34      shld applyMask1_2
5818   236A 3E 08         mvi a, 8
5819   236C CD BB 28      call applyMask1
5820   236F             ;161 applyMask1(dest+8, mask+8, 3);
5821   236F 2A 56 34      lhld applyMask_1
5822   2372 11 08 00      lxi d, 8
5823   2375 19            dad d
5824   2376 22 D8 34      shld applyMask1_1
5825   2379 2A 58 34      lhld applyMask_2
5826   237C 11 08 00      lxi d, 8
5827   237F 19            dad d
5828   2380 22 DA 34      shld applyMask1_2
5829   2383 3E 03         mvi a, 3
5830   2385 CD BB 28      call applyMask1
5831   2388 C9            ret
5832   2389             ; --------------------------------------------------------------
5833   2389             catPathAndUnpack:
5834   2389 C5            push b
5835   238A             ;266 uint len = strlen(str);
5836   238A 22 5C 34      shld catPathAndUnpack_2
5837   238D 2A 5A 34      lhld catPathAndUnpack_1
5838   2390 CD B7 0C      call strlen
5839   2393             ;267 if(len) {
5840   2393 7C            mov a, h
5841   2394 B5            ora l
5842   2395 44            mov b, h
5843   2396 4D            mov c, l
5844   2397 CA B8 23      jz l30533
5845   239A             ;267 {
5846   239A 11 F2 00      lxi d, 242
5847   239D CD CD 29      call op_cmp16
5848   23A0 DA A7 23      jc l30541
5849   23A3             ;268 return 1; // Не влезает разделитель плюс имя файла  
5850   23A3 3E 01         mvi a, 1
5851   23A5 C1            pop b
5852   23A6 C9            ret
5853   23A7             l30541:
5854   23A7             ;269 str[len] = '/';  
5855   23A7 2A 5A 34      lhld catPathAndUnpack_1
5856   23AA 09            dad b
5857   23AB 36 2F         mvi m, 47
5858   23AD             ;270 str += len+1;
5859   23AD 60            mov h, b
5860   23AE 69            mov l, c
5861   23AF 23            inx h
5862   23B0 EB            xchg
5863   23B1 2A 5A 34      lhld catPathAndUnpack_1
5864   23B4 19            dad d
5865   23B5 22 5A 34      shld catPathAndUnpack_1
5866   23B8             l30533:
5867   23B8             ;272 unpackName(str, fileName);
5868   23B8 2A 5A 34      lhld catPathAndUnpack_1
5869   23BB 22 7E 32      shld unpackName_1
5870   23BE 2A 5C 34      lhld catPathAndUnpack_2
5871   23C1 CD 0C 15      call unpackName
5872   23C4             ;273 return 0;
5873   23C4 AF            xra a
5874   23C5 C1            pop b
5875   23C6 C9            ret
5876   23C7             ; --------------------------------------------------------------
5877   23C7             cmd_copyFolder:
5878   23C7 C5            push b
5879   23C8             ;97 uchar level=0;
5880   23C8 0E 00         mvi c, 0
5881   23CA             ;102 e = fs_mkdir(to); 
5882   23CA 22 62 34      shld cmd_copyFolder_2
5883   23CD CD 8E 22      call fs_mkdir
5884   23D0             ;103 if(e) return e;
5885   23D0 B7            ora a
5886   23D1 CA D6 23      jz l30542
5887   23D4             ;103 return e;
5888   23D4 C1            pop b
5889   23D5 C9            ret
5890   23D6             l30542:
5891   23D6             ;105 for(i=0;;++i) {
5892   23D6 21 00 00      lxi h, 0
5893   23D9 47            mov b, a
5894   23DA 22 65 34      shld cmd_copyFolder_i
5895   23DD             l107:
5896   23DD             ;105 {
5897   23DD 2A D5 30      lhld maxFiles
5898   23E0 EB            xchg
5899   23E1 2A 65 34      lhld cmd_copyFolder_i
5900   23E4 CD CD 29      call op_cmp16
5901   23E7 C2 EE 23      jnz l30543
5902   23EA             ;107 return ERR_MAX_FILES;
5903   23EA 3E 0A         mvi a, 10
5904   23EC C1            pop b
5905   23ED C9            ret
5906   23EE             l30543:
5907   23EE             ;111 e = fs_findfirst(from, panelB.files1, i+1);
5908   23EE 2A 60 34      lhld cmd_copyFolder_1
5909   23F1 22 A0 31      shld fs_findfirst_1
5910   23F4 2A CB 2E      lhld panelB
5911   23F7 22 A2 31      shld fs_findfirst_2
5912   23FA 2A 65 34      lhld cmd_copyFolder_i
5913   23FD 23            inx h
5914   23FE CD B7 0D      call fs_findfirst
5915   2401             ;112 if(e != 0 && e != ERR_MAX_FILES) return e; // Њл ўбҐЈ¤  Ўг¤Ґ¬ Ї®«гзЁвм ERR_MAX_FILES
5916   2401 B7            ora a
5917   2402 47            mov b, a
5918   2403 CA 0D 24      jz l30546
5919   2406 FE 0A         cpi 10
5920   2408 CA 0D 24      jz l30546
5921   240B             ;112 return e; // Њл ўбҐЈ¤  Ўг¤Ґ¬ Ї®«гзЁвм ERR_MAX_FILES
5922   240B C1            pop b
5923   240C C9            ret
5924   240D             l30546:
5925   240D             ;115 if(i >= fs_low) {
5926   240D 2A 0D 31      lhld fs_low
5927   2410 EB            xchg
5928   2411 2A 65 34      lhld cmd_copyFolder_i
5929   2414 CD CD 29      call op_cmp16
5930   2417 DA 4C 24      jc l30564
5931   241A             ;115 {
5932   241A AF            xra a
5933   241B B9            cmp c
5934   241C C2 21 24      jnz l30572
5935   241F             ;117 return 0;
5936   241F C1            pop b
5937   2420 C9            ret
5938   2421             l30572:
5939   2421             ;119 dropPathInt(from, 0);
5940   2421 2A 60 34      lhld cmd_copyFolder_1
5941   2424 22 4C 34      shld dropPathInt_1
5942   2427 21 00 00      lxi h, 0
5943   242A CD 0E 23      call dropPathInt
5944   242D             ;120 dropPathInt(to, 0);
5945   242D 2A 62 34      lhld cmd_copyFolder_2
5946   2430 22 4C 34      shld dropPathInt_1
5947   2433 21 00 00      lxi h, 0
5948   2436 CD 0E 23      call dropPathInt
5949   2439             ;121 --level;
5950   2439 0D            dcr c
5951   243A             ;122 i = stack[level];
5952   243A 69            mov l, c
5953   243B 26 00         mvi h, 0
5954   243D 29            dad h
5955   243E 11 68 34      lxi d, cmd_copyFolder_stack
5956   2441 19            dad d
5957   2442 7E            mov a, m
5958   2443 23            inx h
5959   2444 66            mov h, m
5960   2445 6F            mov l, a
5961   2446             ;123 continue;
5962   2446 22 65 34      shld cmd_copyFolder_i
5963   2449 C3 ED 24      jmp l106
5964   244C             l30564:
5965   244C             ;125 f = panelB.files1 + i;
5966   244C 54            mov d, h
5967   244D 5D            mov e, l
5968   244E 29            dad h
5969   244F 29            dad h
5970   2450 19            dad d
5971   2451 29            dad h
5972   2452 29            dad h
5973   2453 EB            xchg
5974   2454 2A CB 2E      lhld panelB
5975   2457 19            dad d
5976   2458             ;128 if(catPathAndUnpack(from, f->fname)) return ERR_RECV_STRING;
5977   2458 22 78 34      shld cmd_copyFolder_f
5978   245B 2A 60 34      lhld cmd_copyFolder_1
5979   245E 22 5A 34      shld catPathAndUnpack_1
5980   2461 2A 78 34      lhld cmd_copyFolder_f
5981   2464 CD 89 23      call catPathAndUnpack
5982   2467 B7            ora a
5983   2468 CA 6F 24      jz l30581
5984   246B             ;128 return ERR_RECV_STRING;
5985   246B 3E 0B         mvi a, 11
5986   246D C1            pop b
5987   246E C9            ret
5988   246F             l30581:
5989   246F             ;129 if(catPathAndUnpack(to,   f->fname)) return ERR_RECV_STRING;
5990   246F 2A 62 34      lhld cmd_copyFolder_2
5991   2472 22 5A 34      shld catPathAndUnpack_1
5992   2475 2A 78 34      lhld cmd_copyFolder_f
5993   2478 CD 89 23      call catPathAndUnpack
5994   247B B7            ora a
5995   247C CA 83 24      jz l30590
5996   247F             ;129 return ERR_RECV_STRING;
5997   247F 3E 0B         mvi a, 11
5998   2481 C1            pop b
5999   2482 C9            ret
6000   2483             l30590:
6001   2483             ;132 if(f->fattrib & 0x10) {
6002   2483 2A 78 34      lhld cmd_copyFolder_f
6003   2486 11 0B 00      lxi d, 11
6004   2489 19            dad d
6005   248A 7E            mov a, m
6006   248B E6 10         ani 16
6007   248D CA C1 24      jz l30599
6008   2490             ;132 {
6009   2490 3E 07         mvi a, 7
6010   2492 B9            cmp c
6011   2493 C2 9A 24      jnz l30661
6012   2496             ;134 return ERR_RECV_STRING;
6013   2496 3E 0B         mvi a, 11
6014   2498 C1            pop b
6015   2499 C9            ret
6016   249A             l30661:
6017   249A             ;135 stack[level] = i;
6018   249A 69            mov l, c
6019   249B 26 00         mvi h, 0
6020   249D 29            dad h
6021   249E 11 68 34      lxi d, cmd_copyFolder_stack
6022   24A1 19            dad d
6023   24A2 EB            xchg
6024   24A3 2A 65 34      lhld cmd_copyFolder_i
6025   24A6 EB            xchg
6026   24A7 73            mov m, e
6027   24A8 23            inx h
6028   24A9 72            mov m, d
6029   24AA             ;136 level++;
6030   24AA 0C            inr c
6031   24AB             ;138 e = fs_mkdir(to); 
6032   24AB 2A 62 34      lhld cmd_copyFolder_2
6033   24AE CD 8E 22      call fs_mkdir
6034   24B1             ;139 if(e) return e;
6035   24B1 B7            ora a
6036   24B2 CA B7 24      jz l30662
6037   24B5             ;139 return e;
6038   24B5 C1            pop b
6039   24B6 C9            ret
6040   24B7             l30662:
6041   24B7             ;141 i = -1;
6042   24B7 21 FF FF      lxi h, 65535
6043   24BA             ;142 continue;
6044   24BA 22 65 34      shld cmd_copyFolder_i
6045   24BD 47            mov b, a
6046   24BE C3 ED 24      jmp l106
6047   24C1             l30599:
6048   24C1             ;146 e = cmd_copyFile(from, to);
6049   24C1 2A 60 34      lhld cmd_copyFolder_1
6050   24C4 22 7A 34      shld cmd_copyFile_1
6051   24C7 2A 62 34      lhld cmd_copyFolder_2
6052   24CA CD F9 24      call cmd_copyFile
6053   24CD             ;149 dropPathInt(from, 0);
6054   24CD 2A 60 34      lhld cmd_copyFolder_1
6055   24D0 22 4C 34      shld dropPathInt_1
6056   24D3 21 00 00      lxi h, 0
6057   24D6 47            mov b, a
6058   24D7 CD 0E 23      call dropPathInt
6059   24DA             ;150 dropPathInt(to, 0);
6060   24DA 2A 62 34      lhld cmd_copyFolder_2
6061   24DD 22 4C 34      shld dropPathInt_1
6062   24E0 21 00 00      lxi h, 0
6063   24E3 CD 0E 23      call dropPathInt
6064   24E6             ;153 if(e) return e;
6065   24E6 78            mov a, b
6066   24E7 B7            ora a
6067   24E8 CA ED 24      jz l30663
6068   24EB             ;153 return e;
6069   24EB C1            pop b
6070   24EC C9            ret
6071   24ED             l30663:
6072   24ED             l106:
6073   24ED 2A 65 34      lhld cmd_copyFolder_i
6074   24F0 23            inx h
6075   24F1 22 65 34      shld cmd_copyFolder_i
6076   24F4 C3 DD 23      jmp l107
6077   24F7             l105:
6078   24F7 C1            pop b
6079   24F8 C9            ret
6080   24F9             ; --------------------------------------------------------------
6081   24F9             cmd_copyFile:
6082   24F9 C5            push b
6083   24FA             ;13 uchar e, progress_i=0;
6084   24FA 0E 00         mvi c, 0
6085   24FC             ;18 if(e = fs_open(from)) return e;
6086   24FC 22 7C 34      shld cmd_copyFile_2
6087   24FF 2A 7A 34      lhld cmd_copyFile_1
6088   2502 CD 18 0D      call fs_open
6089   2505 B7            ora a
6090   2506 CA 0B 25      jz l30664
6091   2509             ;18 return e;
6092   2509 C1            pop b
6093   250A C9            ret
6094   250B             l30664:
6095   250B             ;19 if(e = fs_getsize()) return e;
6096   250B CD F4 28      call fs_getsize
6097   250E B7            ora a
6098   250F CA 14 25      jz l30673
6099   2512             ;19 return e;
6100   2512 C1            pop b
6101   2513 C9            ret
6102   2514             l30673:
6103   2514             ;22 set32(&progress_step, &fs_result);
6104   2514 21 98 34      lxi h, cmd_copyFile_progress_step
6105   2517 22 C6 34      shld set32_1
6106   251A 21 0D 31      lxi h, fs_low
6107   251D 47            mov b, a
6108   251E CD 2F 28      call set32
6109   2521             ;23 div32_16(&progress_step, 40);
6110   2521 21 98 34      lxi h, cmd_copyFile_progress_step
6111   2524 22 CA 34      shld div32_16_1
6112   2527 21 28 00      lxi h, 40
6113   252A CD 45 28      call div32_16
6114   252D             ;26 drawWindow(" kopirowanie ");
6115   252D 21 7F 2A      lxi h, str18
6116   2530 CD 9C 12      call drawWindow
6117   2533             ;27 drawWindowText(0, 0, "iz:");
6118   2533 AF            xra a
6119   2534 32 5E 32      sta drawWindowText_1
6120   2537 32 5F 32      sta drawWindowText_2
6121   253A 21 59 2C      lxi h, str19
6122   253D CD C9 12      call drawWindowText
6123   2540             ;28 drawWindowText(4, 0, from);
6124   2540 AF            xra a
6125   2541 32 5F 32      sta drawWindowText_2
6126   2544 3E 04         mvi a, 4
6127   2546 32 5E 32      sta drawWindowText_1
6128   2549 2A 7A 34      lhld cmd_copyFile_1
6129   254C CD C9 12      call drawWindowText
6130   254F             ;29 drawWindowText(0, 1, "w:");
6131   254F AF            xra a
6132   2550 32 5E 32      sta drawWindowText_1
6133   2553 3C            inr a
6134   2554 32 5F 32      sta drawWindowText_2
6135   2557 21 82 2D      lxi h, str20
6136   255A CD C9 12      call drawWindowText
6137   255D             ;30 drawWindowText(4, 1, to);
6138   255D 3E 01         mvi a, 1
6139   255F 32 5F 32      sta drawWindowText_2
6140   2562 3E 04         mvi a, 4
6141   2564 32 5E 32      sta drawWindowText_1
6142   2567 2A 7C 34      lhld cmd_copyFile_2
6143   256A CD C9 12      call drawWindowText
6144   256D             ;31 drawWindowText(0, 2, "skopirowano           /           bajt");
6145   256D AF            xra a
6146   256E 32 5E 32      sta drawWindowText_1
6147   2571 3E 02         mvi a, 2
6148   2573 32 5F 32      sta drawWindowText_2
6149   2576 21 50 2D      lxi h, str21
6150   2579 CD C9 12      call drawWindowText
6151   257C             ;32 drawWindowProgress(0, 3, progress_width, '#');
6152   257C AF            xra a
6153   257D 32 DE 34      sta drawWindowProgress_1
6154   2580 3E 03         mvi a, 3
6155   2582 32 DF 34      sta drawWindowProgress_2
6156   2585 3E 12         mvi a, 18
6157   2587 32 E0 34      sta drawWindowProgress_3
6158   258A 3E 23         mvi a, 35
6159   258C CD 02 29      call drawWindowProgress
6160   258F             ;33 i2s32(buf, &fs_result, 10, ' ');
6161   258F 21 7E 34      lxi h, cmd_copyFile_buf
6162   2592 22 29 34      shld i2s32_1
6163   2595 21 0D 31      lxi h, fs_low
6164   2598 22 2B 34      shld i2s32_2
6165   259B 21 0A 00      lxi h, 10
6166   259E 22 2D 34      shld i2s32_3
6167   25A1 3E 20         mvi a, 32
6168   25A3 CD 74 21      call i2s32
6169   25A6             ;34 drawWindowText(23, 2, buf);
6170   25A6 3E 02         mvi a, 2
6171   25A8 32 5F 32      sta drawWindowText_2
6172   25AB 3E 17         mvi a, 23
6173   25AD 32 5E 32      sta drawWindowText_1
6174   25B0 21 7E 34      lxi h, cmd_copyFile_buf
6175   25B3 CD C9 12      call drawWindowText
6176   25B6             ;35 drawEscButton();
6177   25B6 CD C2 26      call drawEscButton
6178   25B9             ;38 if(e = fs_swap()) return e;
6179   25B9 CD 41 29      call fs_swap
6180   25BC B7            ora a
6181   25BD CA C2 25      jz l30674
6182   25C0             ;38 return e;
6183   25C0 C1            pop b
6184   25C1 C9            ret
6185   25C2             l30674:
6186   25C2             ;39 if(e = fs_create(to)) return e;
6187   25C2 2A 7C 34      lhld cmd_copyFile_2
6188   25C5 CD 98 28      call fs_create
6189   25C8 B7            ora a
6190   25C9 CA CE 25      jz l30683
6191   25CC             ;39 return e;
6192   25CC C1            pop b
6193   25CD C9            ret
6194   25CE             l30683:
6195   25CE             ;1 { ((ushort*)a)[0] = (b&0xFFFF); ((ushort*)a)[1] = (b>>16); }
6196   25CE 21 00 00      lxi h, 0
6197   25D1             ;1 ((ushort*)a)[1] = (b>>16); }
6198   25D1 22 90 34      shld cmd_copyFile_progress
6199   25D4             ;1 { ((ushort*)a)[0] = (b&0xFFFF); ((ushort*)a)[1] = (b>>16); }
6200   25D4 22 92 34      shld (cmd_copyFile_progress)+(2)
6201   25D7             ;1 ((ushort*)a)[1] = (b>>16); }
6202   25D7 22 94 34      shld cmd_copyFile_progress_x
6203   25DA             ;44 for(;;) {
6204   25DA 47            mov b, a
6205   25DB 22 96 34      shld (cmd_copyFile_progress_x)+(2)
6206   25DE             l97:
6207   25DE             l96:
6208   25DE             ;44 {
6209   25DE 21 7E 34      lxi h, cmd_copyFile_buf
6210   25E1 22 29 34      shld i2s32_1
6211   25E4 21 90 34      lxi h, cmd_copyFile_progress
6212   25E7 22 2B 34      shld i2s32_2
6213   25EA 21 0A 00      lxi h, 10
6214   25ED 22 2D 34      shld i2s32_3
6215   25F0 3E 20         mvi a, 32
6216   25F2 CD 74 21      call i2s32
6217   25F5             ;47 drawWindowText(12, 2, buf); 
6218   25F5 3E 02         mvi a, 2
6219   25F7 32 5F 32      sta drawWindowText_2
6220   25FA 3E 0C         mvi a, 12
6221   25FC 32 5E 32      sta drawWindowText_1
6222   25FF 21 7E 34      lxi h, cmd_copyFile_buf
6223   2602 CD C9 12      call drawWindowText
6224   2605             ;50 if(e = fs_swap()) return e;
6225   2605 CD 41 29      call fs_swap
6226   2608 B7            ora a
6227   2609 CA 0E 26      jz l30684
6228   260C             ;50 return e;
6229   260C C1            pop b
6230   260D C9            ret
6231   260E             l30684:
6232   260E             ;51 if(e = fs_read(panelB.files1, 1024) ) return e;
6233   260E 2A CB 2E      lhld panelB
6234   2611 22 96 31      shld fs_read_1
6235   2614 21 00 04      lxi h, 1024
6236   2617 CD 29 0D      call fs_read
6237   261A B7            ora a
6238   261B CA 20 26      jz l30693
6239   261E             ;51 return e;
6240   261E C1            pop b
6241   261F C9            ret
6242   2620             l30693:
6243   2620             ;52 if(fs_low == 0) return 0; // ‘ ЇҐаҐ§ Јаг§Є®© д ©«®ў
6244   2620 2A 0D 31      lhld fs_low
6245   2623 47            mov b, a
6246   2624 7C            mov a, h
6247   2625 B5            ora l
6248   2626 C2 2C 26      jnz l30702
6249   2629             ;52 return 0; // ‘ ЇҐаҐ§ Јаг§Є®© д ©«®ў
6250   2629 AF            xra a
6251   262A C1            pop b
6252   262B C9            ret
6253   262C             l30702:
6254   262C             ;53 if(e = fs_swap()) return e;
6255   262C CD 41 29      call fs_swap
6256   262F B7            ora a
6257   2630 CA 35 26      jz l30711
6258   2633             ;53 return e;
6259   2633 C1            pop b
6260   2634 C9            ret
6261   2635             l30711:
6262   2635             ;54 if(e = fs_write(panelB.files1, fs_low)) return e;
6263   2635 2A CB 2E      lhld panelB
6264   2638 22 D0 34      shld fs_write_1
6265   263B 2A 0D 31      lhld fs_low
6266   263E CD A9 28      call fs_write
6267   2641 B7            ora a
6268   2642 CA 47 26      jz l30720
6269   2645             ;54 return e;
6270   2645 C1            pop b
6271   2646 C9            ret
6272   2647             l30720:
6273   2647             ;57 add32_16(&progress, fs_low);
6274   2647 21 90 34      lxi h, cmd_copyFile_progress
6275   264A 22 E6 34      shld add32_16_1
6276   264D 2A 0D 31      lhld fs_low
6277   2650 47            mov b, a
6278   2651 CD 67 29      call add32_16
6279   2654             ;60 add32_16(&progress_x, fs_low);
6280   2654 21 94 34      lxi h, cmd_copyFile_progress_x
6281   2657 22 E6 34      shld add32_16_1
6282   265A 2A 0D 31      lhld fs_low
6283   265D CD 67 29      call add32_16
6284   2660             ;61 while(progress_i < progress_width && cmp32_32(&progress_x, &progress_step) != 1) {
6285   2660             l100:
6286   2660 79            mov a, c
6287   2661 FE 12         cpi 18
6288   2663 D2 95 26      jnc l99
6289   2666 21 94 34      lxi h, cmd_copyFile_progress_x
6290   2669 22 EA 34      shld cmp32_32_1
6291   266C 21 98 34      lxi h, cmd_copyFile_progress_step
6292   266F CD 82 29      call cmp32_32
6293   2672 3D            dcr a
6294   2673 CA 95 26      jz l99
6295   2676             ;61 {
6296   2676 21 94 34      lxi h, cmd_copyFile_progress_x
6297   2679 22 EE 34      shld sub32_32_1
6298   267C 21 98 34      lxi h, cmd_copyFile_progress_step
6299   267F CD B0 29      call sub32_32
6300   2682             ;63 drawWindowText(progress_i, 3, "\x17");
6301   2682 79            mov a, c
6302   2683 32 5E 32      sta drawWindowText_1
6303   2686 3E 03         mvi a, 3
6304   2688 32 5F 32      sta drawWindowText_2
6305   268B 21 61 2A      lxi h, str22
6306   268E CD C9 12      call drawWindowText
6307   2691             ;64 ++progress_i;
6308   2691 0C            inr c
6309   2692 C3 60 26      jmp l100
6310   2695             l99:
6311   2695             ;68 if(fs_bioskey(1) == KEY_ESC) { e = ERR_USER; break; }
6312   2695 3E 01         mvi a, 1
6313   2697 CD 98 05      call fs_bioskey
6314   269A FE 1B         cpi 27
6315   269C C2 A4 26      jnz l30721
6316   269F             ;68 { e = ERR_USER; break; }
6317   269F 06 80         mvi b, 128
6318   26A1             ;68 break; }
6319   26A1 C3 A7 26      jmp l95
6320   26A4             l30721:
6321   26A4 C3 DE 25      jmp l97
6322   26A7             l95:
6323   26A7             ;72 fs_delete(to);
6324   26A7 2A 7C 34      lhld cmd_copyFile_2
6325   26AA CD CE 26      call fs_delete
6326   26AD             ;73 return e;
6327   26AD 78            mov a, b
6328   26AE C1            pop b
6329   26AF C9            ret
6330   26B0             ; --------------------------------------------------------------
6331   26B0             fs_move:
6332   26B0 C5            push b
6333   26B1             ;282 for(i=20000; i; --i);
6334   26B1 01 20 4E      lxi b, 20000
6335   26B4 22 9E 34      shld fs_move_2
6336   26B7             l161:
6337   26B7             l160:
6338   26B7 0B            dcx b
6339   26B8 60            mov h, b
6340   26B9 69            mov l, c
6341   26BA 7C            mov a, h
6342   26BB B5            ora l
6343   26BC C2 B7 26      jnz l161
6344   26BF             ;283 return 0;
6345   26BF AF            xra a
6346   26C0 C1            pop b
6347   26C1 C9            ret
6348   26C2             ; --------------------------------------------------------------
6349   26C2             drawEscButton:
6350   26C2             ;272 drawWindowTextCenter(4, "[ stop ]");
6351   26C2 3E 04         mvi a, 4
6352   26C4 32 38 34      sta drawWindowTextCenter_1
6353   26C7 21 E0 2B      lxi h, str57
6354   26CA CD 2D 22      call drawWindowTextCenter
6355   26CD C9            ret
6356   26CE             ; --------------------------------------------------------------
6357   26CE             fs_delete:
6358   26CE C5            push b
6359   26CF             ;320 fs_print(0,0,64,name,0);
6360   26CF 22 7F 31      shld fs_print_4
6361   26D2 AF            xra a
6362   26D3 32 7C 31      sta fs_print_1
6363   26D6 32 7D 31      sta fs_print_2
6364   26D9 3E 40         mvi a, 64
6365   26DB 32 7E 31      sta fs_print_3
6366   26DE AF            xra a
6367   26DF 22 A2 34      shld fs_delete_1
6368   26E2 CD FE 0A      call fs_print
6369   26E5             ;321 if(0==strcmp(name, "FOLDER01")) return ERR_DIR_NOT_EMPTY;
6370   26E5 2A A2 34      lhld fs_delete_1
6371   26E8 22 8A 31      shld strcmp_1
6372   26EB 21 A5 2B      lxi h, str64
6373   26EE CD C6 0C      call strcmp
6374   26F1 B7            ora a
6375   26F2 C2 F9 26      jnz l30722
6376   26F5             ;321 return ERR_DIR_NOT_EMPTY;
6377   26F5 3E 07         mvi a, 7
6378   26F7 C1            pop b
6379   26F8 C9            ret
6380   26F9             l30722:
6381   26F9             ;322 if(0==strcmp(name, "FOLDER01/FOLDER04")) return ERR_DIR_NOT_EMPTY;
6382   26F9 2A A2 34      lhld fs_delete_1
6383   26FC 22 8A 31      shld strcmp_1
6384   26FF 21 AE 2B      lxi h, str65
6385   2702 CD C6 0C      call strcmp
6386   2705 B7            ora a
6387   2706 C2 0D 27      jnz l30731
6388   2709             ;322 return ERR_DIR_NOT_EMPTY;
6389   2709 3E 07         mvi a, 7
6390   270B C1            pop b
6391   270C C9            ret
6392   270D             l30731:
6393   270D             ;323 for(i=5000; i; --i);
6394   270D 01 88 13      lxi b, 5000
6395   2710             l169:
6396   2710             l168:
6397   2710 0B            dcx b
6398   2711 60            mov h, b
6399   2712 69            mov l, c
6400   2713 7C            mov a, h
6401   2714 B5            ora l
6402   2715 C2 10 27      jnz l169
6403   2718             ;324 return 0;
6404   2718 AF            xra a
6405   2719 C1            pop b
6406   271A C9            ret
6407   271B             ; --------------------------------------------------------------
6408   271B             drawFile2:
6409   271B             ;168 memcpy(buf, f->fname, 8);
6410   271B 22 A8 34      shld drawFile2_3
6411   271E 21 AA 34      lxi h, drawFile2_buf
6412   2721 22 9A 31      shld memcpy_1
6413   2724 2A A8 34      lhld drawFile2_3
6414   2727 22 9C 31      shld memcpy_2
6415   272A 21 08 00      lxi h, 8
6416   272D CD 93 0D      call memcpy
6417   2730             ;169 buf[8] = (f->fattrib&0x80) ? '*' : ((f->fattrib & 0x06) ? 0x7F : ' '); 
6418   2730 2A A8 34      lhld drawFile2_3
6419   2733 11 0B 00      lxi d, 11
6420   2736 19            dad d
6421   2737 7E            mov a, m
6422   2738 E6 80         ani 128
6423   273A CA 43 27      jz l30733
6424   273D 21 2A 00      lxi h, 42
6425   2740 C3 59 27      jmp l30732
6426   2743             ; label1
6427   2743             l30733:
6428   2743 2A A8 34      lhld drawFile2_3
6429   2746 11 0B 00      lxi d, 11
6430   2749 19            dad d
6431   274A 7E            mov a, m
6432   274B E6 06         ani 6
6433   274D CA 56 27      jz l30787
6434   2750 21 7F 00      lxi h, 127
6435   2753 C3 59 27      jmp l30786
6436   2756             ; label1
6437   2756             l30787:
6438   2756 21 20 00      lxi h, 32
6439   2759             ; label1
6440   2759             l30786:
6441   2759             ; label1
6442   2759             l30732:
6443   2759 7D            mov a, l
6444   275A             ;170 memcpy(buf + 9, f->fname + 8, 3);  
6445   275A 21 B3 34      lxi h, (drawFile2_buf)+(9)
6446   275D 22 9A 31      shld memcpy_1
6447   2760 2A A8 34      lhld drawFile2_3
6448   2763 11 08 00      lxi d, 8
6449   2766 19            dad d
6450   2767 22 9C 31      shld memcpy_2
6451   276A 21 03 00      lxi h, 3
6452   276D 32 B2 34      sta (drawFile2_buf)+(8)
6453   2770 CD 93 0D      call memcpy
6454   2773             ;171 fs_print(x, y, 12, buf, 0); 
6455   2773 3A A6 34      lda drawFile2_1
6456   2776 32 7C 31      sta fs_print_1
6457   2779 3A A7 34      lda drawFile2_2
6458   277C 32 7D 31      sta fs_print_2
6459   277F 21 AA 34      lxi h, drawFile2_buf
6460   2782 22 7F 31      shld fs_print_4
6461   2785 3E 0C         mvi a, 12
6462   2787 32 7E 31      sta fs_print_3
6463   278A AF            xra a
6464   278B CD FE 0A      call fs_print
6465   278E C9            ret
6466   278F             ; --------------------------------------------------------------
6467   278F             drawWindowInput:
6468   278F             ;315 drawInput(windowX+x+2, windowY+y+2, max);
6469   278F 2A B6 34      lhld drawWindowInput_1
6470   2792 26 00         mvi h, 0
6471   2794 EB            xchg
6472   2795 2A F7 30      lhld windowX
6473   2798 26 00         mvi h, 0
6474   279A 19            dad d
6475   279B 23            inx h
6476   279C 23            inx h
6477   279D 32 B8 34      sta drawWindowInput_3
6478   27A0 7D            mov a, l
6479   27A1 32 DE 33      sta drawInput_1
6480   27A4 2A B7 34      lhld drawWindowInput_2
6481   27A7 26 00         mvi h, 0
6482   27A9 EB            xchg
6483   27AA 2A F8 30      lhld windowY
6484   27AD 26 00         mvi h, 0
6485   27AF 19            dad d
6486   27B0 23            inx h
6487   27B1 23            inx h
6488   27B2 7D            mov a, l
6489   27B3 32 DF 33      sta drawInput_2
6490   27B6 3A B8 34      lda drawWindowInput_3
6491   27B9 CD 1B 1C      call drawInput
6492   27BC C9            ret
6493   27BD             ; --------------------------------------------------------------
6494   27BD             memset:
6495   27BD             ;2 asm {
6496   27BD 22 BC 34      shld memset_3
6497   27C0 C5              push b
6498   27C1 3A BB 34        lda memset_2
6499   27C4 EB              xchg
6500   27C5 2A B9 34        lhld memset_1
6501   27C8 EB              xchg
6502   27C9 01 FF FF        lxi b, -1    
6503   27CC             memset_l1:
6504   27CC 09              dad b
6505   27CD D2 D5 27        jnc memset_l2
6506   27D0 12              stax d
6507   27D1 13              inx d
6508   27D2 C3 CC 27        jmp memset_l1
6509   27D5             memset_l2:
6510   27D5 C1              pop b
6511   27D6               
6512   27D6 C9            ret
6513   27D7             ; --------------------------------------------------------------
6514   27D7             compareMask1:
6515   27D7 C5            push b
6516   27D8             ;8 for(;;) {
6517   27D8 32 C2 34      sta compareMask1_3
6518   27DB             l125:
6519   27DB             l124:
6520   27DB             ;8 {
6521   27DB 2A C0 34      lhld compareMask1_2
6522   27DE 7E            mov a, m
6523   27DF             ;10 if(m == '*') return 1;
6524   27DF FE 2A         cpi 42
6525   27E1 47            mov b, a
6526   27E2 C2 E9 27      jnz l30788
6527   27E5             ;10 return 1;
6528   27E5 3E 01         mvi a, 1
6529   27E7 C1            pop b
6530   27E8 C9            ret
6531   27E9             l30788:
6532   27E9             ;11 if(m != '?' && m != *fileName) return 0;  
6533   27E9 FE 3F         cpi 63
6534   27EB CA F9 27      jz l30797
6535   27EE 2A BE 34      lhld compareMask1_1
6536   27F1 7E            mov a, m
6537   27F2 B8            cmp b
6538   27F3 CA F9 27      jz l30797
6539   27F6             ;11 return 0;  
6540   27F6 AF            xra a
6541   27F7 C1            pop b
6542   27F8 C9            ret
6543   27F9             l30797:
6544   27F9             ;12 --i;
6545   27F9 3A C2 34      lda compareMask1_3
6546   27FC 3D            dcr a
6547   27FD             ;13 if(i==0) return 1;
6548   27FD B7            ora a
6549   27FE 32 C2 34      sta compareMask1_3
6550   2801 C2 08 28      jnz l30798
6551   2804             ;13 return 1;
6552   2804 3E 01         mvi a, 1
6553   2806 C1            pop b
6554   2807 C9            ret
6555   2808             l30798:
6556   2808             ;14 ++mask, ++fileName;
6557   2808 2A C0 34      lhld compareMask1_2
6558   280B 23            inx h
6559   280C 22 C0 34      shld compareMask1_2
6560   280F 2A BE 34      lhld compareMask1_1
6561   2812 23            inx h
6562   2813 22 BE 34      shld compareMask1_1
6563   2816 C3 DB 27      jmp l125
6564   2819             l123:
6565   2819 C1            pop b
6566   281A C9            ret
6567   281B             ; --------------------------------------------------------------
6568   281B             fs_cursor:
6569   281B             ;182 directCursor(8+x, 3+y);
6570   281B 32 C5 34      sta fs_cursor_2
6571   281E 3A C4 34      lda fs_cursor_1
6572   2821 C6 08         adi 8
6573   2823 32 FB 33      sta directCursor_1
6574   2826 3A C5 34      lda fs_cursor_2
6575   2829 C6 03         adi 3
6576   282B CD FF 1E      call directCursor
6577   282E C9            ret
6578   282F             ; --------------------------------------------------------------
6579   282F             set32:
6580   282F             ;4 asm {
6581   282F 22 C8 34      shld set32_2
6582   2832 EB              xchg ; de = set32_2
6583   2833 2A C6 34        lhld set32_1
6584   2836 1A              ldax d
6585   2837 77              mov m, a
6586   2838 23              inx h
6587   2839 13              inx d
6588   283A 1A              ldax d
6589   283B 77              mov m, a
6590   283C 23              inx h
6591   283D 13              inx d
6592   283E 1A              ldax d
6593   283F 77              mov m, a
6594   2840 23              inx h
6595   2841 13              inx d
6596   2842 1A              ldax d
6597   2843 77              mov m, a
6598   2844               
6599   2844 C9            ret
6600   2845             ; --------------------------------------------------------------
6601   2845             div32_16:
6602   2845             ;9 ((ushort*)a)[1] = ((ushort*)a)[1] / b;
6603   2845 22 CC 34      shld div32_16_2
6604   2848 EB            xchg
6605   2849 2A CA 34      lhld div32_16_1
6606   284C 23            inx h
6607   284D 23            inx h
6608   284E 7E            mov a, m
6609   284F 23            inx h
6610   2850 66            mov h, m
6611   2851 6F            mov l, a
6612   2852 CD FC 29      call op_div16_swap
6613   2855 EB            xchg
6614   2856 2A CA 34      lhld div32_16_1
6615   2859 23            inx h
6616   285A 23            inx h
6617   285B 73            mov m, e
6618   285C 23            inx h
6619   285D 72            mov m, d
6620   285E             ;11 ((uchar*)&div32_16_tmp)[1] = op_div16_mod;
6621   285E 3A F9 29      lda op_div16_mod
6622   2861             ;12 ((uchar*)&div32_16_tmp)[0] = ((uchar*)a)[1];
6623   2861 2A CA 34      lhld div32_16_1
6624   2864 23            inx h
6625   2865 32 1D 31      sta (div32_16_tmp)+(1)
6626   2868 7E            mov a, m
6627   2869             ;13 ((uchar*)a)[1] = div32_16_tmp / b;
6628   2869 2A CC 34      lhld div32_16_2
6629   286C EB            xchg
6630   286D 32 1C 31      sta div32_16_tmp
6631   2870 2A 1C 31      lhld div32_16_tmp
6632   2873 CD FC 29      call op_div16_swap
6633   2876 7D            mov a, l
6634   2877 2A CA 34      lhld div32_16_1
6635   287A 23            inx h
6636   287B 77            mov m, a
6637   287C             ;15 ((uchar*)&div32_16_tmp)[1] = op_div16_mod;
6638   287C 3A F9 29      lda op_div16_mod
6639   287F             ;16 ((uchar*)&div32_16_tmp)[0] = ((uchar*)a)[0];
6640   287F 2A CA 34      lhld div32_16_1
6641   2882 32 1D 31      sta (div32_16_tmp)+(1)
6642   2885 7E            mov a, m
6643   2886             ;17 ((uchar*)a)[0] = div32_16_tmp / b;
6644   2886 E5            push h
6645   2887 2A CC 34      lhld div32_16_2
6646   288A EB            xchg
6647   288B 32 1C 31      sta div32_16_tmp
6648   288E 2A 1C 31      lhld div32_16_tmp
6649   2891 CD FC 29      call op_div16_swap
6650   2894 7D            mov a, l
6651   2895 D1            pop d
6652   2896 12            stax d
6653   2897 C9            ret
6654   2898             ; --------------------------------------------------------------
6655   2898             fs_create:
6656   2898             ;1 { ((ushort*)a)[0] = (b&0xFFFF); ((ushort*)a)[1] = (b>>16); }
6657   2898 22 CE 34      shld fs_create_1
6658   289B 21 80 A9      lxi h, 43392
6659   289E             ;1 ((ushort*)a)[1] = (b>>16); }
6660   289E 22 14 31      shld readEmuSize
6661   28A1 21 03 00      lxi h, 3
6662   28A4             ;277 return 0;
6663   28A4 AF            xra a
6664   28A5 22 16 31      shld (readEmuSize)+(2)
6665   28A8 C9            ret
6666   28A9             ; --------------------------------------------------------------
6667   28A9             fs_write:
6668   28A9 C5            push b
6669   28AA             ;245 for(j=100; j; --j);
6670   28AA 01 64 00      lxi b, 100
6671   28AD 22 D2 34      shld fs_write_2
6672   28B0             l157:
6673   28B0             l156:
6674   28B0 0B            dcx b
6675   28B1 60            mov h, b
6676   28B2 69            mov l, c
6677   28B3 7C            mov a, h
6678   28B4 B5            ora l
6679   28B5 C2 B0 28      jnz l157
6680   28B8             ;246 return 0;
6681   28B8 AF            xra a
6682   28B9 C1            pop b
6683   28BA C9            ret
6684   28BB             ; --------------------------------------------------------------
6685   28BB             applyMask1:
6686   28BB C5            push b
6687   28BC             ;80 for(;;) {
6688   28BC 32 DC 34      sta applyMask1_3
6689   28BF             l103:
6690   28BF             l102:
6691   28BF             ;80 {
6692   28BF 2A DA 34      lhld applyMask1_2
6693   28C2 7E            mov a, m
6694   28C3             ;82 if(m == '*') return;
6695   28C3 FE 2A         cpi 42
6696   28C5 C2 CA 28      jnz l30799
6697   28C8             ;82 return;
6698   28C8 C1            pop b
6699   28C9 C9            ret
6700   28CA             l30799:
6701   28CA             ;83 if(m != '?') *dest = m;
6702   28CA FE 3F         cpi 63
6703   28CC CA D3 28      jz l30808
6704   28CF             ;83 *dest = m;
6705   28CF 2A D8 34      lhld applyMask1_1
6706   28D2 77            mov m, a
6707   28D3             l30808:
6708   28D3             ;84 --i;
6709   28D3 47            mov b, a
6710   28D4 3A DC 34      lda applyMask1_3
6711   28D7 3D            dcr a
6712   28D8             ;85 if(i==0) return;
6713   28D8 B7            ora a
6714   28D9 C2 DE 28      jnz l30811
6715   28DC             ;85 return;
6716   28DC C1            pop b
6717   28DD C9            ret
6718   28DE             l30811:
6719   28DE             ;86 ++mask, ++dest;
6720   28DE 2A DA 34      lhld applyMask1_2
6721   28E1 23            inx h
6722   28E2 22 DA 34      shld applyMask1_2
6723   28E5 2A D8 34      lhld applyMask1_1
6724   28E8 23            inx h
6725   28E9 22 D8 34      shld applyMask1_1
6726   28EC 32 DC 34      sta applyMask1_3
6727   28EF C3 BF 28      jmp l103
6728   28F2             l101:
6729   28F2 C1            pop b
6730   28F3 C9            ret
6731   28F4             ; --------------------------------------------------------------
6732   28F4             fs_getsize:
6733   28F4             ;300 set32(&fs_result, &readEmuSize);
6734   28F4 21 0D 31      lxi h, fs_low
6735   28F7 22 C6 34      shld set32_1
6736   28FA 21 14 31      lxi h, readEmuSize
6737   28FD CD 2F 28      call set32
6738   2900             ;301 return 0; 
6739   2900 AF            xra a
6740   2901 C9            ret
6741   2902             ; --------------------------------------------------------------
6742   2902             drawWindowProgress:
6743   2902             ;279 if(n == 0) return;
6744   2902 32 E1 34      sta drawWindowProgress_4
6745   2905 3A E0 34      lda drawWindowProgress_3
6746   2908 B7            ora a
6747   2909 C8            rz
6748   290A             ;279 return;
6749   290A             l30812:
6750   290A             ;280 fs_print(windowX+ox+2, windowY+oy+2, n, "", chr);
6751   290A 2A DE 34      lhld drawWindowProgress_1
6752   290D 26 00         mvi h, 0
6753   290F EB            xchg
6754   2910 2A F7 30      lhld windowX
6755   2913 26 00         mvi h, 0
6756   2915 19            dad d
6757   2916 23            inx h
6758   2917 23            inx h
6759   2918 7D            mov a, l
6760   2919 32 7C 31      sta fs_print_1
6761   291C 2A DF 34      lhld drawWindowProgress_2
6762   291F 26 00         mvi h, 0
6763   2921 EB            xchg
6764   2922 2A F8 30      lhld windowY
6765   2925 26 00         mvi h, 0
6766   2927 19            dad d
6767   2928 23            inx h
6768   2929 23            inx h
6769   292A 7D            mov a, l
6770   292B 32 7D 31      sta fs_print_2
6771   292E 3A E0 34      lda drawWindowProgress_3
6772   2931 32 7E 31      sta fs_print_3
6773   2934 21 5C 2A      lxi h, str15
6774   2937 22 7F 31      shld fs_print_4
6775   293A 3A E1 34      lda drawWindowProgress_4
6776   293D CD FE 0A      call fs_print
6777   2940 C9            ret
6778   2941             ; --------------------------------------------------------------
6779   2941             fs_swap:
6780   2941             ;236 set32(&tmp, &readEmuSize);
6781   2941 21 E2 34      lxi h, fs_swap_tmp
6782   2944 22 C6 34      shld set32_1
6783   2947 21 14 31      lxi h, readEmuSize
6784   294A CD 2F 28      call set32
6785   294D             ;237 set32(&readEmuSize, &readEmuSize2);
6786   294D 21 14 31      lxi h, readEmuSize
6787   2950 22 C6 34      shld set32_1
6788   2953 21 18 31      lxi h, readEmuSize2
6789   2956 CD 2F 28      call set32
6790   2959             ;238 set32(&readEmuSize2, &tmp);
6791   2959 21 18 31      lxi h, readEmuSize2
6792   295C 22 C6 34      shld set32_1
6793   295F 21 E2 34      lxi h, fs_swap_tmp
6794   2962 CD 2F 28      call set32
6795   2965             ;239 return 0;
6796   2965 AF            xra a
6797   2966 C9            ret
6798   2967             ; --------------------------------------------------------------
6799   2967             add32_16:
6800   2967             ;4 asm {
6801   2967 22 E8 34      shld add32_16_2
6802   296A                 ; de = *to
6803   296A 2A E6 34        lhld add32_16_1
6804   296D 5E              mov e, m
6805   296E 23              inx h
6806   296F 56              mov d, m
6807   2970             
6808   2970                 ; hl = de + from
6809   2970 2A E8 34        lhld add32_16_2
6810   2973 19              dad d
6811   2974             
6812   2974                 ; *hl = de
6813   2974 EB              xchg
6814   2975 2A E6 34        lhld add32_16_1
6815   2978 73              mov m, e
6816   2979 23              inx h
6817   297A 72              mov m, d     
6818   297B             
6819   297B                 ; …б«Ё ЇҐаҐЇ®«­Ґ­ЁҐ, в® гўҐ«ЁзЁў Ґ¬ ўҐае­Ё© а §ап¤
6820   297B D0              rnc
6821   297C 23              inx h
6822   297D 34              inr m    
6823   297E             
6824   297E                 ; …б«Ё ЇҐаҐЇ®«­Ґ­ЁҐ, в® гўҐ«ЁзЁў Ґ¬ ўҐае­Ё© а §ап¤
6825   297E C0              rnz
6826   297F 23              inx h
6827   2980 34              inr m
6828   2981               
6829   2981 C9            ret
6830   2982             ; --------------------------------------------------------------
6831   2982             cmp32_32:
6832   2982             ;4 asm {
6833   2982 22 EC 34      shld cmp32_32_2
6834   2985 2A EA 34        lhld cmp32_32_1
6835   2988 23              inx h
6836   2989 23              inx h
6837   298A 23              inx h
6838   298B EB              xchg
6839   298C             
6840   298C 2A EC 34        lhld cmp32_32_2
6841   298F 23              inx h
6842   2990 23              inx h
6843   2991 23              inx h
6844   2992               
6845   2992 1A              ldax d
6846   2993 BE              cmp m
6847   2994 C2 AA 29        jnz cmp32_32_l0
6848   2997                
6849   2997 2B              dcx h
6850   2998 1B              dcx d
6851   2999 1A              ldax d
6852   299A BE              cmp m
6853   299B C2 AA 29        jnz cmp32_32_l0
6854   299E                 
6855   299E 2B              dcx h
6856   299F 1B              dcx d
6857   29A0 1A              ldax d
6858   29A1 BE              cmp m
6859   29A2 C2 AA 29        jnz cmp32_32_l0
6860   29A5             
6861   29A5 2B              dcx h
6862   29A6 1B              dcx d
6863   29A7 1A              ldax d
6864   29A8 BE              cmp m
6865   29A9 C8              rz
6866   29AA             
6867   29AA             cmp32_32_l0:   
6868   29AA 3F              cmc
6869   29AB 9F              sbb a
6870   29AC F6 01           ori 1
6871   29AE C9              ret
6872   29AF               
6873   29AF C9            ret
6874   29B0             ; --------------------------------------------------------------
6875   29B0             sub32_32:
6876   29B0             ;4 asm {
6877   29B0 22 F0 34      shld sub32_32_2
6878   29B3 2A EE 34        lhld sub32_32_1
6879   29B6 EB              xchg
6880   29B7 2A F0 34        lhld sub32_32_2
6881   29BA               
6882   29BA 1A              ldax d
6883   29BB 96              sub m
6884   29BC 12              stax d
6885   29BD                
6886   29BD 23              inx h
6887   29BE 13              inx d
6888   29BF 1A              ldax d
6889   29C0 9E              sbb m
6890   29C1 12              stax d
6891   29C2                 
6892   29C2 23              inx h
6893   29C3 13              inx d
6894   29C4 1A              ldax d
6895   29C5 9E              sbb m
6896   29C6 12              stax d
6897   29C7             
6898   29C7 23              inx h
6899   29C8 13              inx d
6900   29C9 1A              ldax d
6901   29CA 9E              sbb m
6902   29CB 12              stax d
6903   29CC               
6904   29CC C9            ret
6905   29CD             ; --------------------------------------------------------------
6906   29CD             ; STDLIB
6907   29CD             ; --------------------------------------------------------------
6908   29CD             op_cmp16:
6909   29CD 7C              mov a, h
6910   29CE BA              cmp d
6911   29CF C0              rnz
6912   29D0 7D              mov a, l
6913   29D1 BB              cmp e
6914   29D2 C9              ret
6915   29D3             ; Умножение HL на DE, результат в HL. BC портить нельзя
6916   29D3             
6917   29D3             op_mul16:
6918   29D3 C5            push b
6919   29D4 44            mov b, h
6920   29D5 4D            mov c, l
6921   29D6 21 00 00      lxi h, 0
6922   29D9 3E 11         mvi a, 17
6923   29DB             op_mul16_1:
6924   29DB 3D            dcr a
6925   29DC CA F7 29      jz op_mul16_4
6926   29DF 29            dad h
6927   29E0 EB            xchg
6928   29E1 D2 E9 29      jnc op_mul16_2
6929   29E4 29            dad h
6930   29E5 23            inx h
6931   29E6 C3 EA 29      jmp op_mul16_3
6932   29E9             op_mul16_2:
6933   29E9 29            dad h
6934   29EA             op_mul16_3:
6935   29EA EB            xchg
6936   29EB D2 DB 29      jnc op_mul16_1
6937   29EE 09            dad b
6938   29EF D2 DB 29      jnc op_mul16_1
6939   29F2 13            inx d
6940   29F3 C3 DB 29      jmp op_mul16_1
6941   29F6 C9            ret
6942   29F7             op_mul16_4:
6943   29F7 C1            pop b
6944   29F8 C9            ret
6945   29F9 00 00       op_div16_mod: .dw 0
6946   29FB             
6947   29FB             op_div16:
6948   29FB EB                  xchg
6949   29FC             op_div16_swap:
6950   29FC C5                  PUSH B ; HL делится на DE, результат в HL, остаток в DE
6951   29FD EB                  XCHG
6952   29FE CD 08 2A            CALL _DIV0
6953   2A01 EB                  XCHG
6954   2A02 22 F9 29            SHLD op_div16_mod
6955   2A05 EB                  XCHG
6956   2A06 C1                  POP B
6957   2A07 C9                  RET
6958   2A08             
6959   2A08             _DIV0:
6960   2A08 7C          _DIV:	MOV A,H
6961   2A09 B5          	ORA L
6962   2A0A C8          	RZ
6963   2A0B 01 00 00    	LXI B,0000
6964   2A0E C5          	PUSH B
6965   2A0F 7B          _DIV1:	MOV A,E
6966   2A10 95          	SUB L
6967   2A11 7A          	MOV A,D
6968   2A12 9C          	SBB H
6969   2A13 DA 1B 2A    	JC _DIV2
6970   2A16 E5          	PUSH H
6971   2A17 29          	DAD H
6972   2A18 D2 0F 2A    	JNC _DIV1
6973   2A1B 21 00 00    _DIV2:	LXI H,0000
6974   2A1E C1          _DIV3:	POP B
6975   2A1F 78          	MOV A,B
6976   2A20 B1          	ORA C
6977   2A21 C8          	RZ
6978   2A22 29          	DAD H
6979   2A23 D5          	PUSH D
6980   2A24 7B          	MOV A,E
6981   2A25 91          	SUB C
6982   2A26 5F          	MOV E,A
6983   2A27 7A          	MOV A,D
6984   2A28 98          	SBB B
6985   2A29 57          	MOV D,A
6986   2A2A DA 32 2A    	JC _DIV4
6987   2A2D 23          	INX H
6988   2A2E C1          	POP B
6989   2A2F C3 1E 2A    	JMP _DIV3
6990   2A32 D1          _DIV4:	POP D
6991   2A33 C3 1E 2A    	JMP _DIV3  
6992   2A36 C9                  RET
6993   2A37             
6994   2A37             op_mod16:
6995   2A37 EB                  xchg
6996   2A38             op_mod16_swap:
6997   2A38 CD FB 29            call op_div16
6998   2A3B 2A F9 29            lhld op_div16_mod
6999   2A3E C9                  ret
7000   2A3F             op_sub16:
7001   2A3F EB              xchg
7002   2A40             op_sub16_swap:
7003   2A40 7D              mov a, l
7004   2A41 93              sub e
7005   2A42 6F              mov l, a
7006   2A43 7C              mov a, h
7007   2A44 9A              sbb d
7008   2A45 67              mov h, a
7009   2A46 C9              ret
7010   2A47             ; Сдвиг HL на DE, результат в HL. BC портить нельзя
7011   2A47             
7012   2A47             op_shr16:
7013   2A47 EB            xchg
7014   2A48             op_shr16_swap:
7015   2A48 1C            inr e
7016   2A49             op_shr16_l:
7017   2A49 1D            dcr e
7018   2A4A C8            rz
7019   2A4B 97            sub a
7020   2A4C B4            ora h 
7021   2A4D 1F            rar
7022   2A4E 67            mov h, a
7023   2A4F 7D            mov a, l
7024   2A50 1F            rar
7025   2A51 6F            mov l, a
7026   2A52 C3 49 2A      jmp op_shr16_l
7027   2A55             op_and16:
7028   2A55 7C              mov a, h
7029   2A56 A2              ana d
7030   2A57 67              mov h, a
7031   2A58 7D              mov a, l
7032   2A59 A3              ana e
7033   2A5A 6F              mov l, a
7034   2A5B C9              ret
7035   2A5C             ; --------------------------------------------------------------
7036   2A5C             ; STRINGS
7037   2A5C             ; --------------------------------------------------------------
7038   2A5C 00          str15: .db "", 0
7039   2A5D 04 00       str44: .db "", 0
7040   2A5F 10 00       str45: .db "", 0
7041   2A61 17 00       str22: .db "", 0
7042   2A63 1B 1C 04 1C str58: .db "", 0
7042   2A67 10 06 11 02 
7042   2A6B 1C 01 00 
7043   2A6E 20 00       str46: .db " ", 0
7044   2A70 20 20 20 00 str60: .db "   ", 0
7045   2A74 20 20 20 20 str54: .db "     <DIR>", 0
7045   2A78 20 3C 44 49 
7045   2A7C 52 3E 00 
7046   2A7F 20 6B 6F 70 str18: .db " kopirowanie ", 0
7046   2A83 69 72 6F 77 
7046   2A87 61 6E 69 65 
7046   2A8B 20 00 
7047   2A8D 20 6B 6F 70 str24: .db " kopirowatx ", 0
7047   2A91 69 72 6F 77 
7047   2A95 61 74 78 20 
7047   2A99 00 
7048   2A9A 20 6D 62 00 str32: .db " mb", 0
7049   2A9E 20 6E 61 6B str33: .db " nakopitelx ", 0
7049   2AA2 6F 70 69 74 
7049   2AA6 65 6C 78 20 
7049   2AAA 00 
7050   2AAB 20 6F 7B 69 str1: .db " o{ibka ", 0
7050   2AAF 62 6B 61 20 
7050   2AB3 00 
7051   2AB4 20 70 65 72 str26: .db " pereimenowanie/pereme}enie ", 0
7051   2AB8 65 69 6D 65 
7051   2ABC 6E 6F 77 61 
7051   2AC0 6E 69 65 2F 
7051   2AC4 70 65 72 65 
7051   2AC8 6D 65 7D 65 
7051   2ACC 6E 69 65 20 
7051   2AD0 00 
7052   2AD1 20 70 65 72 str25: .db " pereimenowatx/peremestitx ", 0
7052   2AD5 65 69 6D 65 
7052   2AD9 6E 6F 77 61 
7052   2ADD 74 78 2F 70 
7052   2AE1 65 72 65 6D 
7052   2AE5 65 73 74 69 
7052   2AE9 74 78 20 00 
7053   2AED 20 70 6F 6D str43: .db " pometitx fajly ", 0
7053   2AF1 65 74 69 74 
7053   2AF5 78 20 66 61 
7053   2AF9 6A 6C 79 20 
7053   2AFD 00 
7054   2AFE 20 73 6F 7A str30: .db " sozdatx fajl ", 0
7054   2B02 64 61 74 78 
7054   2B06 20 66 61 6A 
7054   2B0A 6C 20 00 
7055   2B0D 20 73 6F 7A str29: .db " sozdatx papku ", 0
7055   2B11 64 61 74 78 
7055   2B15 20 70 61 70 
7055   2B19 6B 75 20 00 
7056   2B1D 20 75 64 61 str38: .db " udalenie ", 0
7056   2B21 6C 65 6E 69 
7056   2B25 65 20 00 
7057   2B28 20 75 64 61 str39: .db " udalitx ", 0
7057   2B2C 6C 69 74 78 
7057   2B30 20 00 
7058   2B32 2A 2E 2A 00 str42: .db "*.*", 0
7059   2B36 2E 49 4E 00 str17: .db ".IN", 0
7060   2B3A 2E 52 4B 00 str16: .db ".RK", 0
7061   2B3E 2F 00       str23: .db "/", 0
7062   2B40 30 31 32 33 str66: .db "0123456789ABCDEF", 0
7062   2B44 34 35 36 37 
7062   2B48 38 39 41 42 
7062   2B4C 43 44 45 46 
7062   2B50 00 
7063   2B51 31 20 46 52 str53: .db "1 FREE 2 NEW  3 VIEW  4 EDIT 5 COPY 6 REN  7 DIR  8 DEL", 0
7063   2B55 45 45 20 32 
7063   2B59 20 4E 45 57 
7063   2B5D 20 20 33 20 
7063   2B61 56 49 45 57 
7063   2B65 20 20 34 20 
7063   2B69 45 44 49 54 
7063   2B6D 20 35 20 43 
7063   2B71 4F 50 59 20 
7063   2B75 36 20 52 45 
7063   2B79 4E 20 20 37 
7063   2B7D 20 44 49 52 
7063   2B81 20 20 38 20 
7063   2B85 44 45 4C 00 
7064   2B89 3A 00       str63: .db ":", 0
7065   2B8B 3E 00       str55: .db ">", 0
7066   2B8D 46 49 4C 45 str61: .db "FILE    TXT", 0
7066   2B91 20 20 20 20 
7066   2B95 54 58 54 00 
7067   2B99 46 4F 4C 44 str59: .db "FOLDER     ", 0
7067   2B9D 45 52 20 20 
7067   2BA1 20 20 20 00 
7068   2BA5 46 4F 4C 44 str64: .db "FOLDER01", 0
7068   2BA9 45 52 30 31 
7068   2BAD 00 
7069   2BAE 46 4F 4C 44 str65: .db "FOLDER01/FOLDER04", 0
7069   2BB2 45 52 30 31 
7069   2BB6 2F 46 4F 4C 
7069   2BBA 44 45 52 30 
7069   2BBE 34 00 
7070   2BC0 54 58 54 00 str62: .db "TXT", 0
7071   2BC4 5B 00       str47: .db "[", 0
7072   2BC6 5B 20 6F 6B str56: .db "[ ok ]", 0
7072   2BCA 20 5D 00 
7073   2BCD 5B 20 6F 6B str13: .db "[ ok ]  [ otmena ]", 0
7073   2BD1 20 5D 20 20 
7073   2BD5 5B 20 6F 74 
7073   2BD9 6D 65 6E 61 
7073   2BDD 20 5D 00 
7074   2BE0 5B 20 73 74 str57: .db "[ stop ]", 0
7074   2BE4 6F 70 20 5D 
7074   2BE8 00 
7075   2BE9 5B 20 77 6B str14: .db "[ wk - ok ]  [ ar2 - otmena ]", 0
7075   2BED 20 2D 20 6F 
7075   2BF1 6B 20 5D 20 
7075   2BF5 20 5B 20 61 
7075   2BF9 72 32 20 2D 
7075   2BFD 20 6F 74 6D 
7075   2C01 65 6E 61 20 
7075   2C05 5D 00 
7076   2C07 5D 00       str48: .db "]", 0
7077   2C09 62 61 6A 74 str49: .db "bajt w    ", 0
7077   2C0D 20 77 20 20 
7077   2C11 20 20 00 
7078   2C14 64 69 73 6B str8: .db "disk zapolnen", 0
7078   2C18 20 7A 61 70 
7078   2C1C 6F 6C 6E 65 
7078   2C20 6E 00 
7079   2C22 66 61 69 6C str9: .db "fail su}estwuet", 0
7079   2C26 20 73 75 7D 
7079   2C2A 65 73 74 77 
7079   2C2E 75 65 74 00 
7080   2C32 66 61 6A 6C str5: .db "fajl ne otkryt", 0
7080   2C36 20 6E 65 20 
7080   2C3A 6F 74 6B 72 
7080   2C3E 79 74 00 
7081   2C41 66 61 6A 6C str51: .db "fajlah ", 0
7081   2C45 61 68 20 00 
7082   2C49 66 61 6A 6C str50: .db "fajle ", 0
7082   2C4D 65 20 00 
7083   2C50 69 6D 71 00 str52: .db "imq", 0
7084   2C54 69 6D 71 3A str12: .db "imq:", 0
7084   2C58 00 
7085   2C59 69 7A 3A 00 str19: .db "iz:", 0
7086   2C5D 6D 61 6B 73 str7: .db "maksimum fajlow w papke", 0
7086   2C61 69 6D 75 6D 
7086   2C65 20 66 61 6A 
7086   2C69 6C 6F 77 20 
7086   2C6D 77 20 70 61 
7086   2C71 70 6B 65 00 
7087   2C75 6E 65 74 20 str2: .db "net fajlowoj sistemy", 0
7087   2C79 66 61 6A 6C 
7087   2C7D 6F 77 6F 6A 
7087   2C81 20 73 69 73 
7087   2C85 74 65 6D 79 
7087   2C89 00 
7088   2C8A 6F 7B 69 62 str27: .db "o{ibka kopirowaniq", 0
7088   2C8E 6B 61 20 6B 
7088   2C92 6F 70 69 72 
7088   2C96 6F 77 61 6E 
7088   2C9A 69 71 00 
7089   2C9D 6F 7B 69 62 str3: .db "o{ibka nakopitelq", 0
7089   2CA1 6B 61 20 6E 
7089   2CA5 61 6B 6F 70 
7089   2CA9 69 74 65 6C 
7089   2CAD 71 00 
7090   2CAF 6F 7B 69 62 str28: .db "o{ibka pereme}eniq", 0
7090   2CB3 6B 61 20 70 
7090   2CB7 65 72 65 6D 
7090   2CBB 65 7D 65 6E 
7090   2CBF 69 71 00 
7091   2CC2 6F 7B 69 62 str31: .db "o{ibka sozdaniq papki", 0
7091   2CC6 6B 61 20 73 
7091   2CCA 6F 7A 64 61 
7091   2CCE 6E 69 71 20 
7091   2CD2 70 61 70 6B 
7091   2CD6 69 00 
7092   2CD8 6F 7B 69 62 str41: .db "o{ibka udaleniq", 0
7092   2CDC 6B 61 20 75 
7092   2CE0 64 61 6C 65 
7092   2CE4 6E 69 71 00 
7093   2CE8 6F 7B 69 62 str35: .db "o{ibka ~teniq", 0
7093   2CEC 6B 61 20 7E 
7093   2CF0 74 65 6E 69 
7093   2CF4 71 00 
7094   2CF6 70 61 70 6B str4: .db "papka ne pusta", 0
7094   2CFA 61 20 6E 65 
7094   2CFE 20 70 75 73 
7094   2D02 74 61 00 
7095   2D05 70 72 65 72 str10: .db "prerwano polxzowatelem", 0
7095   2D09 77 61 6E 6F 
7095   2D0D 20 70 6F 6C 
7095   2D11 78 7A 6F 77 
7095   2D15 61 74 65 6C 
7095   2D19 65 6D 00 
7096   2D1C 70 72 6F 77 str34: .db "prowerka...", 0
7096   2D20 65 72 6B 61 
7096   2D24 2E 2E 2E 00 
7097   2D28 70 75 74 78 str11: .db "putx bolx{e 255 simwolow", 0
7097   2D2C 20 62 6F 6C 
7097   2D30 78 7B 65 20 
7097   2D34 32 35 35 20 
7097   2D38 73 69 6D 77 
7097   2D3C 6F 6C 6F 77 
7097   2D40 00 
7098   2D41 70 75 74 78 str6: .db "putx ne najden", 0
7098   2D45 20 6E 65 20 
7098   2D49 6E 61 6A 64 
7098   2D4D 65 6E 00 
7099   2D50 73 6B 6F 70 str21: .db "skopirowano           /           bajt", 0
7099   2D54 69 72 6F 77 
7099   2D58 61 6E 6F 20 
7099   2D5C 20 20 20 20 
7099   2D60 20 20 20 20 
7099   2D64 20 20 2F 20 
7099   2D68 20 20 20 20 
7099   2D6C 20 20 20 20 
7099   2D70 20 20 62 61 
7099   2D74 6A 74 00 
7100   2D77 73 77 6F 62 str36: .db "swobodno: ", 0
7100   2D7B 6F 64 6E 6F 
7100   2D7F 3A 20 00 
7101   2D82 77 3A 00    str20: .db "w:", 0
7102   2D85 77 73 65 67 str37: .db "wsego:", 0
7102   2D89 6F 3A 00 
7103   2D8C 77 79 20 68 str40: .db "wy hotite udalitx fail(y)?", 0
7103   2D90 6F 74 69 74 
7103   2D94 65 20 75 64 
7103   2D98 61 6C 69 74 
7103   2D9C 78 20 66 61 
7103   2DA0 69 6C 28 79 
7103   2DA4 29 3F 00 
7104   2DA7             ; --------------------------------------------------------------
7105   2DA7             ; GLOBAL VARS
7106   2DA7             ; --------------------------------------------------------------
7107   2DA7 42 4F 4F 54 editorApp: .db 66, 79, 79, 84, 47, 69, 68, 73, 84, 46, 82, 75, 0
7107   2DAB 2F 45 44 49 
7107   2DAF 54 2E 52 4B 
7107   2DB3 00 
7108   2DB4 42 4F 4F 54 viewerApp: .db 66, 79, 79, 84, 47, 86, 73, 69, 87, 46, 82, 75, 0
7108   2DB8 2F 56 49 45 
7108   2DBC 57 2E 52 4B 
7108   2DC0 00 
7109   2DC1             panelA: .ds 266
7110   2ECB             panelB: .ds 266
7111   2FD5             cmdline: .ds 256
7112   30D5             maxFiles: .ds 2
7113   30D7 10          rowsCnt: .db 16
7114   30D8 2E 2E 20 20 parentDir: .db 46, 46, 32, 32, 32, 32, 32, 32, 32, 32, 32, 16, 0, 0, 0, 0
7114   30DC 20 20 20 20 
7114   30E0 20 20 20 10 
7114   30E4 00 00 00 00 
7115   30E8 00 00 00 00  .db 0, 0, 0, 0
7116   30EC             nextSelectedCnt: .ds 2
7117   30EE F0 30       nextSelectedFile: .dw $+2
7118   30F0              .ds 2
7119   30F2             activePanel: .ds 1
7120   30F3             activePanelN: .ds 1
7121   30F4             activePanel0: .ds 1
7122   30F5             fileCursorX: .ds 1
7123   30F6             fileCursorY: .ds 1
7124   30F7             windowX: .ds 1
7125   30F8             windowY: .ds 1
7126   30F9             onePanel: .ds 1
7127   30FA FC 30       window: .dw $+2
7128   30FC              .ds 2
7129   30FE 00 31       fs_cmdLine: .dw $+2
7130   3100 00           .db 0
7131   3101              .ds 1
7132   3102 04 31       fs_selfName: .dw $+2
7133   3104 53 48 45 4C  .db 83, 72, 69, 76, 76, 46, 82, 75, 0
7133   3108 4C 2E 52 4B 
7133   310C 00 
7134   310D             fs_low: .ds 2
7135   310F             fs_high: .ds 2
7136   3111             fs_screenWidth: .ds 1
7137   3112             fs_screenHeight: .ds 1
7138   3113             fs_colors: .ds 1
7139   3114             readEmuSize: .ds 4
7140   3118             readEmuSize2: .ds 4
7141   311C             div32_16_tmp: .ds 2
7142   311E FA          rand_seed: .db 250
7143   311F             ; --------------------------------------------------------------
7144   311F             ; FUNCTION VARS
7145   311F             ; --------------------------------------------------------------
7146   311F             main_c: .ds 1
7147   3120             drawCmdLineWithPath_o: .ds 2
7148   3122             drawCmdLineWithPath_l: .ds 2
7149   3124             drawCmdLineWithPath_old: .ds 2
7150   3126             drawCmdLineWithPath_max: .ds 1
7151   3127             loadState_i: .ds 2
7152   3129             getFiles_f: .ds 2
7153   312B             getFiles_st: .ds 2
7154   312D             getFiles_n: .ds 2
7155   312F             getFiles_i: .ds 1
7156   3130             getFiles_j: .ds 2
7157   3132             getFiles_dir: .ds 20
7158   3146             dupFiles_1: .ds 1
7159   3147             selectFile_1: .ds 2
7160   3149             selectFile_l: .ds 2
7161   314B             selectFile_f: .ds 2
7162   314D             fs_bioskey_1: .ds 1
7163   314E             cmd_freespace_e: .ds 1
7164   314F             cmd_new_1: .ds 1
7165   3150             cmd_editview_1: .ds 2
7166   3152             cmd_editview_f: .ds 2
7167   3154             cmd_enter_d: .ds 2
7168   3156             cmd_enter_i: .ds 1
7169   3157             cmd_enter_f: .ds 2
7170   3159             cmd_enter_l: .ds 2
7171   315B             cmd_enter_o: .ds 2
7172   315D             cursor_right_w: .ds 2
7173   315F             cmd_copymove_1: .ds 1
7174   3160             cmd_copymove_2: .ds 1
7175   3161             cmd_delete_e: .ds 1
7176   3162             cmd_delete_needRefresh2: .ds 1
7177   3163             cmd_inverseOne_f: .ds 2
7178   3165             cmd_inverseAll_f: .ds 2
7179   3167             cmd_inverseAll_i: .ds 2
7180   3169             cmd_sel_1: .ds 1
7181   316A             cmd_sel_f: .ds 2
7182   316C             cmd_sel_i: .ds 2
7183   316E             cmd_sel_buf: .ds 11
7184   3179             processInput_1: .ds 1
7185   317A             processInput_cmdline_pos: .ds 2
7186   317C             fs_print_1: .ds 1
7187   317D             fs_print_2: .ds 1
7188   317E             fs_print_3: .ds 1
7189   317F             fs_print_4: .ds 2
7190   3181             fs_print_5: .ds 1
7191   3182             drawPanelTitle_1: .ds 1
7192   3183             drawPanelTitle_2: .ds 2
7193   3185             drawPanelTitle_l: .ds 2
7194   3187             drawPanelTitle_x: .ds 1
7195   3188             strlen_1: .ds 2
7196   318A             strcmp_1: .ds 2
7197   318C             strcmp_2: .ds 2
7198   318E             strcmp_a: .ds 1
7199   318F             strcmp_b: .ds 1
7200   3190             strcpy_1: .ds 2
7201   3192             strcpy_2: .ds 2
7202   3194             fs_open_1: .ds 2
7203   3196             fs_read_1: .ds 2
7204   3198             fs_read_2: .ds 2
7205   319A             memcpy_1: .ds 2
7206   319C             memcpy_2: .ds 2
7207   319E             memcpy_3: .ds 2
7208   31A0             fs_findfirst_1: .ds 2
7209   31A2             fs_findfirst_2: .ds 2
7210   31A4             fs_findfirst_3: .ds 2
7211   31A6             fs_findfirst_i: .ds 1
7212   31A7             fs_findfirst_xx: .ds 1
7213   31A8             sort_1: .ds 2
7214   31AA             sort_2: .ds 2
7215   31AC             sort_i: .ds 2
7216   31AE             sort_j: .ds 2
7217   31B0             sort_x: .ds 2
7218   31B2             sort_st_: .ds 128
7219   3232             sort_st: .ds 2
7220   3234             sort_stc: .ds 1
7221   3235             getSel_n: .ds 2
7222   3237             memcmp_1: .ds 2
7223   3239             memcmp_2: .ds 2
7224   323B             memcmp_3: .ds 2
7225   323D             drawFilesCount_total: .ds 4
7226   3241             drawFilesCount_i: .ds 2
7227   3243             drawFilesCount_filesCnt: .ds 2
7228   3245             drawFilesCount_p: .ds 2
7229   3247             drawFileInfo_f: .ds 2
7230   3249             drawFileInfo_buf: .ds 18
7231   325B             drawWindow_1: .ds 2
7232   325D             drawWindow_i: .ds 1
7233   325E             drawWindowText_1: .ds 1
7234   325F             drawWindowText_2: .ds 1
7235   3260             drawWindowText_3: .ds 2
7236   3262             drawError_1: .ds 2
7237   3264             drawError_2: .ds 1
7238   3265             drawError_buf: .ds 4
7239   3269             cmd_freespace_1_1: .ds 1
7240   326A             cmd_freespace_1_2: .ds 2
7241   326C             cmd_freespace_1_buf: .ds 17
7242   327D             cmd_new1_1: .ds 1
7243   327E             unpackName_1: .ds 2
7244   3280             unpackName_2: .ds 2
7245   3282             unpackName_i: .ds 1
7246   3283             absolutePath_1: .ds 2
7247   3285             absolutePath_l: .ds 2
7248   3287             run_1: .ds 2
7249   3289             run_2: .ds 2
7250   328B             runCmdLine_cmdLine2: .ds 2
7251   328D             getSelNoBack_f: .ds 2
7252   328F             dropPath_buf: .ds 11
7253   329A             reloadFiles_1: .ds 2
7254   329C             cmd_copymove1_1: .ds 1
7255   329D             cmd_copymove1_2: .ds 1
7256   329E             cmd_copymove1_name: .ds 2
7257   32A0             cmd_copymove1_e: .ds 1
7258   32A1             cmd_copymove1_f: .ds 2
7259   32A3             cmd_copymove1_sourceFile: .ds 256
7260   33A3             cmd_copymove1_mask: .ds 11
7261   33AE             cmd_copymove1_forMask: .ds 11
7262   33B9             cmd_copymove1_type: .ds 1
7263   33BA             cmd_copymove1_i: .ds 2
7264   33BC             confirm_1: .ds 2
7265   33BE             confirm_2: .ds 2
7266   33C0             getFirstSelected_1: .ds 2
7267   33C2             getFirstSelected_type: .ds 1
7268   33C3             cmd_deleteFolder_level: .ds 1
7269   33C4             cmd_deleteFolder_e: .ds 1
7270   33C5             cmd_deleteFolder_p: .ds 2
7271   33C7             cmd_deleteFolder_i: .ds 2
7272   33C9             getNextSelected_1: .ds 2
7273   33CB             drawFile_1: .ds 1
7274   33CC             drawFile_2: .ds 1
7275   33CD             drawFile_3: .ds 2
7276   33CF             inputBox_1: .ds 2
7277   33D1             inputBox_c: .ds 1
7278   33D2             inputBox_clearFlag: .ds 1
7279   33D3             packName_1: .ds 2
7280   33D5             packName_2: .ds 2
7281   33D7             packName_c: .ds 1
7282   33D8             packName_f: .ds 1
7283   33D9             packName_i: .ds 1
7284   33DA             compareMask_1: .ds 2
7285   33DC             compareMask_2: .ds 2
7286   33DE             drawInput_1: .ds 1
7287   33DF             drawInput_2: .ds 1
7288   33E0             drawInput_3: .ds 1
7289   33E1             drawInput_c: .ds 2
7290   33E3             drawInput_c1: .ds 2
7291   33E5             drawInput_old: .ds 2
7292   33E7             drawInput_cmdline_offset: .ds 2
7293   33E9             drawInput_cmdline_pos: .ds 2
7294   33EB             drawRect_1: .ds 1
7295   33EC             drawRect_2: .ds 1
7296   33ED             drawRect_3: .ds 1
7297   33EE             drawRect_4: .ds 1
7298   33EF             drawRect_5: .ds 1
7299   33F0             drawRect_x1: .ds 1
7300   33F1             sub32_16_1: .ds 2
7301   33F3             sub32_16_2: .ds 2
7302   33F5             memswap_1: .ds 2
7303   33F7             memswap_2: .ds 2
7304   33F9             memswap_3: .ds 2
7305   33FB             directCursor_1: .ds 1
7306   33FC             directCursor_2: .ds 1
7307   33FD             i2s_1: .ds 2
7308   33FF             i2s_2: .ds 2
7309   3401             i2s_3: .ds 2
7310   3403             i2s_4: .ds 1
7311   3404             cmpFileInfo_1: .ds 2
7312   3406             cmpFileInfo_2: .ds 2
7313   3408             cmpFileInfo_i: .ds 1
7314   3409             cmpFileInfo_j: .ds 1
7315   340A             drawColumn_1: .ds 1
7316   340B             drawColumn_y: .ds 1
7317   340C             drawColumn_xx: .ds 1
7318   340D             drawColumn_yy: .ds 1
7319   340E             drawColumn_n: .ds 2
7320   3410             drawColumn_f: .ds 2
7321   3412             add32_32_1: .ds 2
7322   3414             add32_32_2: .ds 2
7323   3416             drawFilesCountInt_1: .ds 2
7324   3418             drawFilesCountInt_2: .ds 2
7325   341A             drawFilesCountInt_v: .ds 1
7326   341B             drawFilesCountInt_x: .ds 1
7327   341C             drawFilesCountInt_y: .ds 1
7328   341D             drawFilesCountInt_buf: .ds 12
7329   3429             i2s32_1: .ds 2
7330   342B             i2s32_2: .ds 2
7331   342D             i2s32_3: .ds 2
7332   342F             i2s32_4: .ds 1
7333   3430             i2s32_v: .ds 4
7334   3434             drawFileInfo1_1: .ds 2
7335   3436             drawFileInfo2_1: .ds 2
7336   3438             drawWindowTextCenter_1: .ds 1
7337   3439             drawWindowTextCenter_2: .ds 2
7338   343B             memcpy_back_1: .ds 2
7339   343D             memcpy_back_2: .ds 2
7340   343F             memcpy_back_3: .ds 2
7341   3441             fs_mkdir_1: .ds 2
7342   3443             fs_mkdir_i: .ds 2
7343   3445             fs_exec_1: .ds 2
7344   3447             fs_exec_2: .ds 2
7345   3449             strchr_1: .ds 2
7346   344B             strchr_2: .ds 1
7347   344C             dropPathInt_1: .ds 2
7348   344E             dropPathInt_2: .ds 2
7349   3450             dropPathInt_p: .ds 2
7350   3452             getName_1: .ds 2
7351   3454             getName_p: .ds 2
7352   3456             applyMask_1: .ds 2
7353   3458             applyMask_2: .ds 2
7354   345A             catPathAndUnpack_1: .ds 2
7355   345C             catPathAndUnpack_2: .ds 2
7356   345E             catPathAndUnpack_len: .ds 2
7357   3460             cmd_copyFolder_1: .ds 2
7358   3462             cmd_copyFolder_2: .ds 2
7359   3464             cmd_copyFolder_e: .ds 1
7360   3465             cmd_copyFolder_i: .ds 2
7361   3467             cmd_copyFolder_level: .ds 1
7362   3468             cmd_copyFolder_stack: .ds 16
7363   3478             cmd_copyFolder_f: .ds 2
7364   347A             cmd_copyFile_1: .ds 2
7365   347C             cmd_copyFile_2: .ds 2
7366   347E             cmd_copyFile_buf: .ds 16
7367   348E             cmd_copyFile_e: .ds 1
7368   348F             cmd_copyFile_progress_i: .ds 1
7369   3490             cmd_copyFile_progress: .ds 4
7370   3494             cmd_copyFile_progress_x: .ds 4
7371   3498             cmd_copyFile_progress_step: .ds 4
7372   349C             fs_move_1: .ds 2
7373   349E             fs_move_2: .ds 2
7374   34A0             fs_move_i: .ds 2
7375   34A2             fs_delete_1: .ds 2
7376   34A4             fs_delete_i: .ds 2
7377   34A6             drawFile2_1: .ds 1
7378   34A7             drawFile2_2: .ds 1
7379   34A8             drawFile2_3: .ds 2
7380   34AA             drawFile2_buf: .ds 12
7381   34B6             drawWindowInput_1: .ds 1
7382   34B7             drawWindowInput_2: .ds 1
7383   34B8             drawWindowInput_3: .ds 1
7384   34B9             memset_1: .ds 2
7385   34BB             memset_2: .ds 1
7386   34BC             memset_3: .ds 2
7387   34BE             compareMask1_1: .ds 2
7388   34C0             compareMask1_2: .ds 2
7389   34C2             compareMask1_3: .ds 1
7390   34C3             compareMask1_m: .ds 1
7391   34C4             fs_cursor_1: .ds 1
7392   34C5             fs_cursor_2: .ds 1
7393   34C6             set32_1: .ds 2
7394   34C8             set32_2: .ds 2
7395   34CA             div32_16_1: .ds 2
7396   34CC             div32_16_2: .ds 2
7397   34CE             fs_create_1: .ds 2
7398   34D0             fs_write_1: .ds 2
7399   34D2             fs_write_2: .ds 2
7400   34D4             fs_write_j: .ds 2
7401   34D6             fs_write_k: .ds 2
7402   34D8             applyMask1_1: .ds 2
7403   34DA             applyMask1_2: .ds 2
7404   34DC             applyMask1_3: .ds 1
7405   34DD             applyMask1_m: .ds 1
7406   34DE             drawWindowProgress_1: .ds 1
7407   34DF             drawWindowProgress_2: .ds 1
7408   34E0             drawWindowProgress_3: .ds 1
7409   34E1             drawWindowProgress_4: .ds 1
7410   34E2             fs_swap_tmp: .ds 4
7411   34E6             add32_16_1: .ds 2
7412   34E8             add32_16_2: .ds 2
7413   34EA             cmp32_32_1: .ds 2
7414   34EC             cmp32_32_2: .ds 2
7415   34EE             sub32_32_1: .ds 2
7416   34F0             sub32_32_2: .ds 2
7417   34F2             .endtasm: Number of errors = 0
